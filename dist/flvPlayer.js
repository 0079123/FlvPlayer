/*!
 * flvPlayer.js v1.0.0
 * Github: https://github.com/zhw2590582/flv-player#readme
 * (c) 2017-2019 Harvey Zack
 * Released under the MIT License.
 */

!function(e,_){"object"==typeof exports&&"undefined"!=typeof module?module.exports=_():"function"==typeof define&&define.amd?define(_):(e=e||self).FlvPlayer=_()}(this,function(){"use strict";var s=function(e,_){if(!(e instanceof _))throw new TypeError("Cannot call a class as a function")};function r(e,_){for(var t=0;t<_.length;t++){var r=_[t];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var _=function(e,_,t){return _&&r(e.prototype,_),t&&r(e,t),e};function e(e,_){return e(_={exports:{}},_.exports),_.exports}var t=e(function(_){function t(e){return(t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function r(e){return"function"==typeof Symbol&&"symbol"===t(Symbol.iterator)?_.exports=r=function(e){return t(e)}:_.exports=r=function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":t(e)},r(e)}_.exports=r});var a=function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e};var n=function(e,_){return!_||"object"!==t(_)&&"function"!=typeof _?a(e):_},l=e(function(_){function t(e){return _.exports=t=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},t(e)}_.exports=t}),o=e(function(t){function r(e,_){return t.exports=r=Object.setPrototypeOf||function(e,_){return e.__proto__=_,e},r(e,_)}t.exports=r});var u=function(e,_){if("function"!=typeof _&&null!==_)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(_&&_.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),_&&o(e,_)};function f(){}f.prototype={on:function(e,_,t){var r=this.e||(this.e={});return(r[e]||(r[e]=[])).push({fn:_,ctx:t}),this},once:function(e,_,t){var r=this;function i(){r.off(e,i),_.apply(t,arguments)}return i._=_,this.on(e,i,t)},emit:function(e){for(var _=[].slice.call(arguments,1),t=((this.e||(this.e={}))[e]||[]).slice(),r=0,i=t.length;r<i;r++)t[r].fn.apply(t[r].ctx,_);return this},off:function(e,_){var t=this.e||(this.e={}),r=t[e],i=[];if(r&&_)for(var a=0,s=r.length;a<s;a++)r[a].fn!==_&&r[a].fn._!==_&&i.push(r[a]);return i.length?t[e]=i:delete t[e],this}};var p=f,d=f;p.TinyEmitter=d;var c=function(e){if(Array.isArray(e)){for(var _=0,t=new Array(e.length);_<e.length;_++)t[_]=e[_];return t}};var m=function(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)};var h=function(){throw new TypeError("Invalid attempt to spread non-iterable instance")};var g=function(e){return c(e)||m(e)||h()};var y=function(e){return-1!==Function.toString.call(e).indexOf("[native code]")},b=e(function(r){function i(e,_,t){return!function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}()?r.exports=i=function(e,_,t){var r=[null];r.push.apply(r,_);var i=new(Function.bind.apply(e,r));return t&&o(i,t.prototype),i}:r.exports=i=Reflect.construct,i.apply(null,arguments)}r.exports=i}),x=function(e){function r(e,_){var t;return s(this,r),t=n(this,l(r).call(this,e)),"function"==typeof Error.captureStackTrace&&Error.captureStackTrace(a(t),_||t.constructor),t.name="FlvPlayerError",t}return u(r,e),r}(e(function(_){function r(e){var t="function"==typeof Map?new Map:void 0;return _.exports=r=function(e){if(null===e||!y(e))return e;if("function"!=typeof e)throw new TypeError("Super expression must either be null or a function");if(void 0!==t){if(t.has(e))return t.get(e);t.set(e,_)}function _(){return b(e,arguments,l(this).constructor)}return _.prototype=Object.create(e.prototype,{constructor:{value:_,enumerable:!1,writable:!0,configurable:!0}}),o(_,e)},r(e)}_.exports=r})(Error));function w(e,_){if(!e)throw new x(_);return e}function S(r){var i=0;function a(e){for(var _=new Uint8Array(e),t=0;t<e;t+=1)_[t]=r[i],i+=1;return a.index=i,_}return a.index=0,a}function L(){for(var e=arguments.length,_=new Array(e),t=0;t<e;t++)_[t]=arguments[t];var r=_[0].constructor;return _.reduce(function(e,_){var t=new r((0|e.byteLength)+(0|_.byteLength));return t.set(e,0),t.set(_,0|e.byteLength),t},new r)}function R(e){var t=new DataView(new ArrayBuffer(e.length));return e.forEach(function(e,_){t.setUint8(_,e)}),t.getFloat64(0)}function q(e){var _;return(_=String.fromCharCode).call.apply(_,[String].concat(g(e)))}function I(r){var i=!(1<arguments.length&&void 0!==arguments[1])||arguments[1];return r.reduce(function(e,_,t){return e+(i?_:_-128)*Math.pow(256,r.length-t-1)},0)}function A(e){s(this,A);var a=e.options.debug;this.log=function(e){if(a){for(var _,t=arguments.length,r=new Array(1<t?t-1:0),i=1;i<t;i++)r[i-1]=arguments[i];(_=console).log.apply(_,["FlvPlayer: [".concat(e,"]")].concat(r))}},this.warn=function(e){if(!e&&a){for(var _,t=arguments.length,r=new Array(1<t?t-1:0),i=1;i<t;i++)r[i-1]=arguments[i];(_=console).warn.apply(_,r)}},this.error=function(e,_){if(!e)throw new x(_)}}function E(i){var a=this;s(this,E);var e=(this.flv=i).options;e.container.classList.add("flv-player-container"),this.canvas=document.createElement("canvas"),this.canvas.classList.add("flv-player-canvas"),this.canvas.width=e.width,this.canvas.height=e.height,this.context=this.canvas.getContext("2d"),this.context.fillStyle="#000",this.context.fillRect(0,0,e.width,e.height),e.container.appendChild(this.canvas),i.on("scripMeta",function(e){var _=e.amf2.metaData,t=_.width,r=_.height;i.debug.error(t&&r,"[amf2]: Missing length or height"),a.canvas.width=t,a.canvas.height=r,a.context=a.canvas.getContext("2d"),a.context.fillStyle="#000",a.context.fillRect(0,0,t,r)}),this.videoFrames=[],i.on("videoFrame",function(e){a.videoFrames.push(e),a.context.putImageData(e,0,0)})}var F=new Uint8Array([0,0,0,1]),O=function(){function i(_){var t=this;s(this,i);var e=(this.flv=_).options,r=_.debug;this.scripMeta=null,this.AVCDecoderConfigurationRecord=null,this.AudioSpecificConfig=null,this.uint8=new Uint8Array(0),this.index=0,this.header=null,this.loaded=!1,_.on("streamStart",function(){r.log("stream-start",e.url)}),_.on("streaming",function(e){t.uint8=L(t.uint8,e),t.parse()}),_.on("streamEnd",function(e){r.log("stream-end"),e&&(t.uint8=e,t.index=0,t.header=null,t.parse()),t.loaded=!0,_.emit("parseDone"),r.log("parse-done")})}return _(i,[{key:"parse",value:function(){var e=this.flv.debug;if(!this.header&&this.readable(13)){var _=Object.create(null);_.signature=q(this.read(3)),_.version=this.read(1)[0],e.error("FLV"===_.signature&&1===_.version,"FLV header not found"),_.flags=this.read(1)[0],_.headersize=I(this.read(4)),this.header=_;var t=I(this.read(4));e.error(0===t,"PrevTagSize0 should be equal to 0, but got ".concat(t)),this.flv.emit("parseHeader",this.header),e.log("parse-header",this.header)}for(;this.index<this.uint8.length;){var r=this.index,i=Object.create(null);if(!this.readable(11)){this.index=r;break}i.tagType=this.read(1)[0],i.dataSize=I(this.read(3));var a=this.read(1),s=this.read(1),n=this.read(1),l=this.read(1);if(i.timestamp=n|s<<8|a<<16|l<<24,i.streamID=I(this.read(3)),e.error(0===i.streamID,"streamID should be equal to 0, but got ".concat(i.streamID)),!this.readable(i.dataSize+4)){this.index=r;break}i.body=this.read(i.dataSize);var o=I(this.read(4));switch(e.error(o===i.dataSize+11,"Invalid PrevTagSize: ".concat(o)),i.tagType){case 18:this.demuxerScripTag(i);break;case 9:this.demuxerVideoTag(i);break;case 8:this.demuxerAudioTag(i);break;default:e.error(!1,"unknown tag type: ".concat(i.tagType))}}}},{key:"readable",value:function(e){return this.uint8.length-this.index>=e}},{key:"read",value:function(e){for(var _=new Uint8Array(e),t=0;t<e;t+=1)_[t]=this.uint8[this.index],this.index+=1;return _}},{key:"demuxerScripTag",value:function(e){var m=this.flv.debug,h=S(e.body),_=Object.create(null),t=Object.create(null);function g(e){var _=null;if(void 0!==e)switch(e){case 0:_=R(h(8));break;case 1:_=function(e){return 0!==e[0]}(h(1));break;case 2:var t=I(h(2));_=q(h(t));break;case 3:_=Object.create(null);for(var r=-1;9!==r;){var i=I(h(2)),a=q(h(i)),s=h(1)[0];a&&(_[a]=g(s)),r=s}break;case 5:_=null;break;case 6:_=void 0;break;case 7:_="Reference #".concat(h.index),h(2);break;case 8:_=Object.create(null);for(var n=-1;9!==n;){var l=I(h(2)),o=q(h(l)),u=h(1)[0];o&&(_[o]=g(u)),n=u}break;case 10:var f=I(h(4));_=[];for(var p=0;p<f;p+=1){var d=h(1)[0];_.push(g(d))}break;case 11:_=R(h(2));break;case 12:var c=I(h(4));_=q(h(c));break;default:m.error(!1,"AMF: Unknown metaData type: ".concat(e))}return _}for(_.type=h(1)[0],m.error(2===_.type,"AMF: [amf1] type expect 2, but got ".concat(_.type)),_.size=I(h(2)),_.string=q(h(_.size)),t.type=h(1)[0],m.error(8===t.type,"AMF: [amf2] type expect 8, but got ".concat(t.type)),t.size=I(h(4)),t.metaData=Object.create(null);h.index<e.body.length;){var r=I(h(2)),i=q(h(r)),a=h(1)[0];i&&(t.metaData[i]=g(a))}m.error(h.index===e.body.length,"AMF: Seems to be incompletely parsed"),m.error(t.size===Object.keys(t.metaData).length,"AMF: [amf2] length does not match"),this.scripMeta={amf1:_,amf2:t},this.flv.emit("scripMeta",this.scripMeta),m.log("scrip-meta",this.scripMeta)}},{key:"demuxerVideoTag",value:function(e){var _=this.flv.debug;_.error(1<e.body.length,"Invalid video packet");var t={frameType:(240&e.body[0])>>4,codecID:15&e.body[0]};_.error(7===t.codecID,"[videoTrack] Unsupported codec in video frame: ".concat(t.codecID));var r=e.body.slice(1,5);_.error(4<=r.length,"[H264] Invalid AVC packet, missing AVCPacketType or/and CompositionTime");var i=new DataView(r.buffer),a=i.getUint8(0),s=((16777215&i.getUint32(0))<<8>>8)+e.timestamp,n=e.body.subarray(5);if(0===a){_.warn(!this.AVCDecoderConfigurationRecord,"[h264] Find another one AVCDecoderConfigurationRecord"),_.error(7<=n.length,"[H264] AVCDecoderConfigurationRecord parse length is not enough");var l=S(n),o={};o.configurationVersion=l(1)[0],_.error(1===o.configurationVersion,"[H264] Invalid configurationVersion: ".concat(o.configurationVersion)),o.AVCProfileIndication=l(1)[0],_.error(0!==o.AVCProfileIndication,"[H264] Invalid AVCProfileIndication: ".concat(o.AVCProfileIndication)),o.profile_compatibility=l(1)[0],o.AVCLevelIndication=l(1)[0],o.lengthSizeMinusOne=1+(3&l(1)[0]),_.error(4===o.lengthSizeMinusOne||3!==o.lengthSizeMinusOne,"[H264] Invalid lengthSizeMinusOne: ".concat(o.lengthSizeMinusOne)),o.numOfSequenceParameterSets=31&l(1)[0],_.error(0!==o.numOfSequenceParameterSets,"[H264] Invalid numOfSequenceParameterSets: ".concat(o.numOfSequenceParameterSets)),_.warn(1===o.numOfSequenceParameterSets,"[H264] Strange numOfSequenceParameterSets: ".concat(o.numOfSequenceParameterSets));for(var u=0;u<o.numOfSequenceParameterSets;u+=1)if(o.sequenceParameterSetLength=I(l(2)),0<o.sequenceParameterSetLength){var f=l(o.sequenceParameterSetLength);this.flv.emit("videoData",L(F,f))}o.numOfPictureParameterSets=l(1)[0],_.error(0!==o.numOfPictureParameterSets,"[H264] Invalid numOfPictureParameterSets: ".concat(o.numOfPictureParameterSets)),_.warn(1===o.numOfPictureParameterSets,"[H264] Strange numOfPictureParameterSets: ".concat(o.numOfPictureParameterSets));for(var p=0;p<o.numOfPictureParameterSets;p+=1)if(o.pictureParameterSetLength=I(l(2)),0<o.pictureParameterSetLength){var d=l(o.pictureParameterSetLength);this.flv.emit("videoData",L(F,d),s)}this.AVCDecoderConfigurationRecord=o,this.flv.emit("AVCDecoderConfigurationRecord",o),_.log("avc-decoder-configuration-record",o)}else if(1===a)for(var c=this.AVCDecoderConfigurationRecord.lengthSizeMinusOne,m=S(n);m.index<n.length;){var h=I(m(c));this.flv.emit("videoData",L(F,m(h)),s)}else _.error(2===a,"[H264] Invalid video packet type ".concat(a))}},{key:"demuxerAudioTag",value:function(e){var _=this.flv.debug;_.error(1<e.body.length,"Invalid audio packet");var t={soundFormat:(240&e.body[0])>>4,soundRate:(12&e.body[0])>>2,soundSize:(2&e.body[0])>>1,soundType:(1&e.body[0])>>0};_.error(10===t.soundFormat,"[audioTrack] unsupported audio format: ".concat(t.soundFormat));var r=e.body.subarray(1);if(0===r[0]){var i=r.subarray(1);_.warn(!this.AudioSpecificConfig,"[aac] Find another one AudioSpecificConfig"),_.error(2<=i.length,"[aac] AudioSpecificConfig parse length is not enough");var a={};a.audioObjectType=(248&i[0])>>3,a.samplingFrequencyIndex=((7&i[0])<<1)+((128&i[1])>>7&1),a.channelConfiguration=(127&i[1])>>3,this.AudioSpecificConfig=a,this.flv.emit("AudioSpecificConfig",a),_.log("audio-specific-config",a)}else{var s=this.AudioSpecificConfig,n=s.audioObjectType,l=s.samplingFrequencyIndex,o=s.channelConfiguration,u=e.dataSize-2+7,f=new Uint8Array(7);f[0]=255,f[1]=240,f[1]|=0,f[1]|=0,f[1]|=1,f[2]=n-1<<6,f[2]|=(15&l)<<2,f[2]|=0,f[2]|=(4&o)>>2,f[3]=(3&o)<<6,f[3]|=0,f[3]|=0,f[3]|=0,f[3]|=0,f[3]|=(6144&u)>>11,f[4]=(2040&u)>>3,f[5]=(7&u)<<5,f[5]|=31,f[6]=252;var p=L(f,e.body.subarray(2));this.flv.emit("audioData",p,e.timestamp)}}}]),i}(),N=[];function T(e){this.buffer=e,this.length=e instanceof Array?e.length:e.byteLength,this.bytepos=0,this.bits=0;for(var _=this.nbits=0;0==this.buffer[this.length-1-_];)_++;for(var t=0;0==(this.buffer[this.length-1-_]&1<<t)&&t<8;)t++;this.stopbit=8*(this.length-_)-t,this.load=function(){for(;this.nbits<=24&&this.bytepos<this.length;){var e=this.buffer[this.bytepos++];this.bits|=e<<24-this.nbits,this.nbits+=8}},this.bitpos=function(){return 8*this.bytepos-this.nbits},this.bitsleft=function(){return 8*this.length-this.bitpos()},this.u=function(e){for(var _=0;e;){_<<=e;var t=24<e?24:e;this.load(),_|=this.bits>>>32-t,this.bits<<=t,this.nbits-=t,e-=t}return _>>>0},this.s=function(e){var _=this.u(e);return this.u(1)?-_:_},this.ue=function(){this.load();for(var e=1|this.bits,_=0;!(e&1<<31);)e<<=1,_++;return this.bits<<=_,this.nbits-=_,this.u(_+1)-1},this.se=function(){var e=this.ue(),_=e+1>>1;return 1&e?_:-_},this.uvlc=function(){for(var e=0;!this.u(1);)++e;return 32<=e?0:this.u(e)+(1<<e)-1},this.le=function(e){for(var _=0,t=0;t<e;++t)_+=bs.u(8)<<8*t;return _},this.leb128=function(){for(var e=0,_=0;_<8;++_){var t=this.u(8);if(e|=(127&t)<<7*_,!(128&t))break}return e},this.ns=function(e){var _=M(e),t=(1<<_)-e,r=this.u(_-1);return r<t?r:(r<<1)-t+this.u(1)},this.su=function(e){var _=this.u(e),t=1<<e-1;return _&t?_-2*t:_}}function D(e,_,t,r,i){var a=e.toString(_),s=Array(t-a.length+1).join(r);return i?a+s:s+a}function M(e){for(var _=1;1<<_<e;)_++;return _}function P(e){return e.bitpos()+1<e.stopbit}function C(e){for(var _="",t=0;t<e.length;t++)_+=String.fromCharCode(e[t]);return _}function z(e,_){return e[_+1]<<8|e[_+0]}function V(e,_){return e[_+3]<<24|e[_+2]<<16|e[_+1]<<8|e[_]}function U(e,_){return-1<_.indexOf(e)?1:0}function H(e,_,t){return e<=_?_:t<=e?t:e}function B(e){e["@id"]=N.length,N.push(e)}function W(){this.parser=null,this.buffer=new Uint8Array(1048576),this.recv=0,this.addr=0,this.next_header_idx=0,this.next=function(){return this.next_header_idx<N.length?N[this.next_header_idx++]:null},this.get=function(e){return e<N.length?N[e]:null}}function Q(){W.call(this),this.ivf_header_length=null,this.ivf_header=null,this.frame_size=null,this.num_needed_bytes=8}function Y(e){W.call(this),this.code=4294967295,this.first=!0,"H264"==e?this.parser=new Z:"H265"==e&&(this.parser=new J)}function G(){this.frame_num=0}function K(){this.frame_num=0}function X(){this.obu_types=["Reserved","OBU_SEQUENCE_HEADER","OBU_TEMPORAL_DELIMITER","OBU_FRAME_HEADER","OBU_TILE_GROUP","OBU_METADATA","OBU_FRAME","OBU_REDUNDANT_FRAME_HEADER","OBU_TILE_LIST","Reserved","Reserved","Reserved","Reserved","Reserved","Reserved","OBU_PADDING"],this.frame_type={KEY_FRAME:0,INTER_FRAME:1,INTRA_ONLY_FRAME:2,SWITCH_FRAME:3},this.ref_frame_type={NONE:-1,INTRA_FRAME:0,LAST_FRAME:1,LAST2_FRAME:2,LAST3_FRAME:3,GOLDEN_FRAME:4,BWDREF_FRAME:5,ALTREF2_FRAME:6,ALTREF_FRAME:7},this.NUM_REF_FRAMES=8,this.REFS_PER_FRAME=7,this.SELECT_SCREEN_CONTENT_TOOLS=2,this.SELECT_INTEGER_MV=2,this.PRIMARY_REF_NONE=7,this.MAX_SEGMENTS=8,this.IDENTITY=0,this.TRANSLATION=1,this.ROTZOOM=2,this.AFFINE=3,this.WARPEDMODEL_PREC_BITS=16,this.SeenFrameHeader=0,this.FeatureEnabled=Array.from(Array(8),function(){return new Array(8).fill(0)}),this.FeatureData=Array.from(Array(8),function(){return new Array(8).fill(0)}),this.frame_num=0,this.seq_header=null}function Z(){this.nal_unit_type=["Unknown","Slice","DP A","DP B","DP C","IDR","SEI","SPS","PPS","AUD","End of sequence","End of stream","Filler data","SPS extension","Prefix NAL unit","Subset SPS","Reserved","Reserved","Reserved","Auxiliary slice","Slice extension","Slice multiview","Reserved","Reserved","Unknown","Unknown","Unknown","Unknown","Unknown","Unknown","Unknown","Unknown"],this.sei_payload_type=["buffering_period","pic_timing","pan_scan_rect","filler_payload","user_data_registered_itu_t_t35","user_data_unregistered","recovery_point","dec_ref_pic_marking_repetition"],this.frame_num=0}function J(){this.nal_unit_type=["TRAIL_N","TRAIL_R","TSA_N","TSA_R","STSA_N","STSA_R","RADL_N","RADL_R","RASL_N","RASL_R","RSV_VCL_N10","RSV_VCL_N12","RSV_VCL_N14","RSV_VCL_R11","RSV_VCL_R13","RSV_VCL_R15","BLA_W_LP","BLA_W_RADL","BLA_N_LP","IDR_W_RADL","IDR_N_LP","CRA_NUT","RSV_IRAP_VCL22","RSV_IRAP_VCL23","RSV_VCL24","RSV_VCL25","RSV_VCL26","RSV_VCL27","RSV_VCL28","RSV_VCL29","RSV_VCL30","RSV_VCL31","VPS","SPS","PPS","AUD","EOS","EOB","FD_NUT","PREFIX SEI","SUFFIX SEI","RSV_NVCL41","RSV_NVCL47","UNSPEC48","UNSPEC63"],this.frame_num=0}(Q.prototype=new W).parse=function(e){if(null!=e)for(var _=0;_<e.length;){for(var t=Math.min(this.num_needed_bytes,e.length-_),r=0;r<t;++r)this.buffer[this.recv++]=e[_++];if(this.num_needed_bytes-=t,!this.num_needed_bytes)if(null!=this.ivf_header_length){if(null==this.ivf_header){this.ivf_header=this.parse_ivf_header(this.buffer,this.addr);var i=this.ivf_header.fourcc;"VP80"==i?this.parser=new G:"VP90"==i?this.parser=new K:"AV01"==i?this.parser=new X:"H264"==i?this.parser=new Y("H264"):0<=["H265","HEVC"].indexOf(i)?this.parser=new Y("H265"):alert("Unknown FourCC "+i),B(this.ivf_header),this.num_needed_bytes=12}else null==this.frame_size?this.frame_size=this.num_needed_bytes=this.buffer[3]<<24|this.buffer[2]<<16|this.buffer[1]<<8|this.buffer[0]:null!=this.parser&&(this.parser.parse(this.buffer.slice(0,this.recv),this.addr),this.num_needed_bytes=12,this.frame_size=null);this.addr+=this.recv,this.recv=0}else this.ivf_header_length=this.buffer[7]<<8|this.buffer[6],this.num_needed_bytes=this.ivf_header_length-this.recv}},Q.prototype.parse_ivf_header=function(e,_){var t={};return t.signature=C(e.slice(0,4)),t.version=z(e,4),t.length=z(e,6),t.fourcc=C(e.slice(8,12)),t.width=z(e,12),t.height=z(e,14),t["frame rate"]=V(e,16),t["time scale"]=V(e,20),t["num frames"]=V(e,24),t["@addr"]=_,t["@type"]="IVF",t["@length"]=t.length,t["@extra"]=t.fourcc+" "+t.width+"x"+t.height,t},(Y.prototype=new W).parse=function(e,_){if(null==e)!this.first&&0<this.recv&&(this.parser.parse(this.buffer.slice(0,this.recv),this.addr),this.code=4294967295,this.first=!0,this.recv=0);else{var t=0;if(this.first)for(;t<e.length;){var r=e[t++];if(this.addr++,this.code=16777215&(this.code<<8|r),1==this.code){this.first=!1;break}}for(var i=0;t<e.length;){1==this.code&&void 0!==_&&(this.addr=_+t);r=e[t++];this.code=16777215&(this.code<<8|r),3==this.code?i++:(this.buffer[this.recv++]=r,1==this.code&&(this.recv-=3,this.parser.parse(this.buffer.slice(0,this.recv),this.addr),this.addr+=this.recv+i,i=this.recv=0))}}},G.prototype.parse=function(e,_){var t=new T(e),r={},i=t.u(8);r.frame_type=1&i,r.version=i>>1&7,r.show_frame=i>>4&1,r.partition_length=(i|t.u(8)<<8|t.u(8)<<16)>>5,0==r.frame_type&&(r.sync_code="0x"+D(t.u(24),16,6,0,0),r.width=16383&(t.u(8)|t.u(8)<<8),r.height=16383&(t.u(8)|t.u(8)<<8)),r["@addr"]=_,r["@type"]=0==r.frame_type?"I":"P",r["@length"]=e.length,r["@keyframe"]=1-r.frame_type,r["@frame_num"]=this.frame_num++,B(r)},K.prototype.parse=function(e,_){var t=new T(e),r={},i=0;if(r.frame_marker=t.u(2),r.profile=t.u(1)+(t.u(1)<<1),3==r.profile&&(r.reserved_zero=t.u(1)),r.show_existing_frames=t.u(1),r.show_existing_frames&&(r.frame_to_show_map_idx=t.u(3)),r.frame_type=t.u(1),r.show_frame=t.u(1),r.error_resilient_mode=t.u(1),0==r.frame_type)r.frame_sync_bytes=t.u(8)+", "+t.u(8)+", "+t.u(8),this.color_config(r,t),r.frame_width_minus_1=t.u(16),r.frame_height_minus_1=t.u(16),r.render_and_frame_size_different=t.u(1),1==r.render_and_frame_size_different&&(r.render_width_minus_1=t.u(16),r.render_height_minus_1=t.u(16));else if(0==r.show_frame&&(r.intra_only=t.u(1)),0==r.error_resilient_mode&&(r.reset_frame_context=t.u(2)),r.intra_only)r.frame_sync_bytes=t.u(8)+", "+t.u(8)+", "+t.u(8),0<r.profile&&(this.color_config(r,t),r.refresh_frame_flags=t.u(8),r.frame_width_minus_1=t.u(16),r.frame_height_minus_1=t.u(16),r.render_and_frame_size_different=t.u(1),1==r.render_and_frame_size_different&&(r.render_width_minus_1=t.u(16),r.render_height_minus_1=t.u(16)));else{r.refresh_frame_flags=t.u(8);for(var a=0;a<3;a++)r["ref_frame_idx["+a+"]"]=t.u(3),r["ref_frame_sign_bias["+a+"]"]=t.u(1);for(i=0;i<3&&(r.size_in_refs=t.u(1),!r.size_in_refs);i++);0==r.size_in_refs&&(r.frame_width_minus_1=t.u(16),r.frame_height_minus_1=t.u(16)),r.render_and_frame_size_different=t.u(1),1==r.render_and_frame_size_different&&(r.render_width_minus_1=t.u(16),r.render_height_minus_1=t.u(16)),r.allow_high_precision_mv=t.u(1),r.is_filter_switchable=t.u(1),0==r.is_filter_switchable&&(r.raw_interpolation_filter=t.u(2))}if(0==r.error_resilient_mode&&(r.refresh_frame_context=t.u(1),r.frame_parallel_decoding_mode=t.u(1)),r.frame_context_idx=t.u(2),r.loop_filter_level=t.u(6),r.loop_filter_sharpness=t.u(3),r.loop_filter_delta_enabled=t.u(1),1==r.loop_filter_delta_enabled&&(r.loop_filter_delta_update=t.u(1),1==r.loop_filter_delta_update)){for(a=0;a<4;a++)r["update_ref_delta["+a+"]"]=t.u(1),1==r["update_ref_delta["+a+"]"]&&(r["loop_filter_ref_deltas["+a+"]"]=t.s(6));for(a=0;a<2;a++)r["update_mode_delta["+a+"]"]=t.u(1),1==r["update_mode_delta["+a+"]"]&&(r["loop_filter_mode_deltas[["+a+"]"]=t.s(6))}r.base_q_idx=t.u(8);for(a=0;a<3;a++)r["delta_coded["+a+"]"]=t.u(1),r["delta_coded["+a+"]"]&&(r["delta_q["+a+"]"]=t.s(4));if("frame_width_minus_1"in r)r["#FrameWidth"]=r.frame_width_minus_1+1,r["#FrameHeight"]=r.frame_height_minus_1+1;else{var s=this.find_ref(r["ref_frame_idx["+i+"]"]);r["#FrameWidth"]=s["#FrameWidth"],r["#FrameHeight"]=s["#FrameHeight"]}for(var n=7+(r["#FrameWidth"]+7>>3)>>3,l=0;64<<l<n;)l++;for(var o=0;4<=n>>o+1;)o++;var u=l;for(a=0;u<o&&(r["increment_tile_cols_log2["+a+"]"]=t.u(1),r["increment_tile_cols_log2["+a+"]"]);a++)u++;if(r.tile_rows_log2=t.u(1),r.tile_rows_log2&&(r.increment_tile_rows_log2=t.u(1)),r.header_size_in_bytes=t.u(16),r["@addr"]=_,r["@type"]=0==r.frame_type?"I":"P",r["@length"]=e.length,r["@keyframe"]=1-r.frame_type,r["@extra"]=D(r["#FrameWidth"],10,4," ",0)+"x"+D(r["#FrameHeight"],10,4," ",1)+" QP "+D(r.base_q_idx,10,3," ",0),r["@extra"]+=" upd "+("refresh_frame_flags"in r?D(r.refresh_frame_flags,2,8,"0",0):"11111111"),"ref_frame_idx[0]"in r){var f=1<<r["ref_frame_idx[0]"]|1<<r["ref_frame_idx[1]"]|1<<r["ref_frame_idx[2]"];r["@extra"]+=" ref "+D(f,2,8,"0",0)}r["@frame_num"]=this.frame_num++,B(r)},K.prototype.color_config=function(e,_){2<=e.profile&&(e.ten_or_twelve_bit=_.u(1)),e.color_space={0:"CS_UNKNOWN",1:"CS_BT_601",2:"CS_BT_709",3:"CS_SMPTE_170",4:"CS_SMPTE_240",5:"CS_BT_2020",6:"CS_RESERVED",7:"CS_BT_601"}[_.u(3)],"CS_RGB"!=e.color_space&&(e.color_range=_.u(1)),1!=e.profile&&3!=e.profile||("CS_RGB"!=e.color_space&&(e.subsampling_x=_.u(1),e.subsampling_y=_.u(1)),e.reserved_zero=_.u(1))},K.prototype.find_ref=function(e){for(var _=N.length-1;0<=_;_--){var t=N[_];if(!("refresh_frame_flags"in t)||t.refresh_frame_flags&1<<e)return N[_]}return null},X.prototype.parse=function(e,_){for(var t=new T(e);t.bitsleft()>>3;){var r=t.bitpos(),i=this.parse_obu_header(t),a=t.bitpos();if(1==i.obu_type?(this.sequence_header_obu(t,i),(this.seq_header=i)["@extra"]=i.max_frame_width_minus_1+1+"x"+(i.max_frame_height_minus_1+1)):2==i.obu_type?this.SeenFrameHeader=0:6==i.obu_type&&(this.frame_obu(t,i),i["@keyframe"]=i["#FrameIsIntra"],i["@frame_num"]=this.frame_num++),i["@addr"]=_+(r>>3),i["@type"]=this.obu_types[i.obu_type],"obu_size"in i){var s=t.bitpos()-a,n=8*i.obu_size-s;0<n&&t.u(n),i["@length"]=i.obu_size+(a-r>>3)}else i["@length"]=e.length;if(B(i),!("obu_size"in i))break}},X.prototype.find_ref=function(e){for(var _=N.length-1;0<=_;_--){var t=N[_];if(!("refresh_frame_flags"in t)||t.refresh_frame_flags&1<<e)return N[_]}return null},X.prototype.parse_obu_header=function(e){var _={};return _.obu_forbidden_bit=e.u(1),_.obu_type=e.u(4),_.obu_extension_flag=e.u(1),_.obu_has_size_field=e.u(1),_.obu_reserved_1bit=e.u(1),_.obu_extension_flag&&(_.temporal_id=e.u(3),_.spatial_id=e.u(2),_.extension_header_reserved_3bits=e.u(3)),_.obu_has_size_field&&(_.obu_size=e.leb128()),_},X.prototype.sequence_header_obu=function(e,_){if(_.seq_profile=e.u(3),_.still_picture=e.u(1),_.reduced_still_picture_header=e.u(1),_.reduced_still_picture_header)_.timing_info_present_flag=0,_.decoder_model_info_present_flag=0,_.initial_display_delay_present_flag=0,_.operating_points_cnt_minus_1=0,_["operating_point_idc[0]"]=0,_["seq_level_idx[0]"]=e.u(5),_["seq_tier[0]"]=0,_["decoder_model_present_for_this_op[0]"]=0,_["initial_display_delay_present_for_this_op[0]"]=0;else{_.timing_info_present_flag=e.u(1),_.timing_info_present_flag?(_.num_units_in_display_tick=e.u(32),_.time_scale=e.u(32),_.equal_picture_interval=e.u(1),_.equal_picture_interval&&(_.num_ticks_per_picture_minus_1=e.uvlc()),_.decoder_model_info_present_flag=e.u(1),_.decoder_model_info_present_flag&&(_.buffer_delay_length_minus_1=e.u(5),_.num_units_in_decoding_tick=e.u(32),_.buffer_removal_time_length_minus_1=e.u(5),_.frame_presentation_time_length_minus_1=e.u(5))):_.decoder_model_info_present_flag=0,_.initial_display_delay_present_flag=e.u(1),_.operating_points_cnt_minus_1=e.u(5);for(var t=0;t<=_.operating_points_cnt_minus_1;t++){if(_["operating_point_idc["+t+"]"]=e.u(12),_["seq_level_idx["+t+"]"]=e.u(5),7<_["seq_level_idx["+t+"]"]?_["seq_tier["+t+"]"]=e.u(1):_["seq_tier["+t+"]"]=0,_.decoder_model_info_present_flag){if(_["decoder_model_present_for_this_op["+t+"]"]=e.u(1),_["decoder_model_present_for_this_op["+t+"]"]){var r=_.buffer_delay_length_minus_1+1;_["decoder_buffer_delay["+t+"]"]=e.u(r),_["encoder_buffer_delay["+t+"]"]=e.u(r),_["low_delay_mode_flag["+t+"]"]=e.u(1)}}else _["decoder_model_present_for_this_op["+t+"]"]=0;_.initial_display_delay_present_flag&&(_["initial_display_delay_present_for_this_op["+t+"]"]=e.u(1),_["initial_display_delay_present_for_this_op["+t+"]"]&&(_["initial_display_delay_minus_1["+t+"]"]=e.u(4)))}}return _.frame_width_bits_minus_1=e.u(4),_.frame_height_bits_minus_1=e.u(4),_.max_frame_width_minus_1=e.u(_.frame_width_bits_minus_1+1),_.max_frame_height_minus_1=e.u(_.frame_height_bits_minus_1+1),_.reduced_still_picture_header?_.frame_id_numbers_present_flag=0:_.frame_id_numbers_present_flag=e.u(1),_.frame_id_numbers_present_flag&&(_.delta_frame_id_length_minus_2=e.u(4),_.additional_frame_id_length_minus_1=e.u(3)),_.use_128x128_superblock=e.u(1),_.enable_filter_intra=e.u(1),_.enable_intra_edge_filter=e.u(1),_.reduced_still_picture_header?(_.enable_interintra_compound=0,_.enable_masked_compound=0,_.enable_warped_motion=0,_.enable_dual_filter=0,_.enable_order_hint=0,_.enable_jnt_comp=0,_.enable_ref_frame_mvs=0,_.seq_force_screen_content_tools=this.SELECT_SCREEN_CONTENT_TOOLS,_.seq_force_integer_mv=1,_["#OrderHintBits"]=0):(_.enable_interintra_compound=e.u(1),_.enable_masked_compound=e.u(1),_.enable_warped_motion=e.u(1),_.enable_dual_filter=e.u(1),_.enable_order_hint=e.u(1),_.enable_order_hint&&(_.enable_jnt_comp=e.u(1),_.enable_ref_frame_mvs=e.u(1)),_.seq_choose_screen_content_tools=e.u(1),_.seq_choose_screen_content_tools?_.seq_force_screen_content_tools=this.SELECT_SCREEN_CONTENT_TOOLS:_.seq_force_screen_content_tools=e.u(1),0<_.seq_force_screen_content_tools&&(_.seq_choose_integer_mv=e.u(1),_.seq_choose_integer_mv?_.seq_force_integer_mv=1:_.seq_force_integer_mv=e.u(1)),_.enable_order_hint?(_.order_hint_bits_minus_1=e.u(3),_["#OrderHintBits"]=_.order_hint_bits_minus_1+1):_["#OrderHintBits"]=0),_.enable_superres=e.u(1),_.enable_cdef=e.u(1),_.enable_restoration=e.u(1),this.color_config(e,_),_.film_grain_params_present=e.u(1),_},X.prototype.color_config=function(e,_){if(_.high_bitdepth=e.u(1),2==_.seq_profile&&_.high_bitdepth&&(_.twelve_bit=e.u(1)),1==_.seq_profile?_.mono_chrome=0:_.mono_chrome=e.u(1),_.color_description_present_flag=e.u(1),_.color_description_present_flag?(_.color_primaries=e.u(8),_.transfer_characteristics=e.u(8),_.matrix_coefficients=e.u(8)):(_.color_primaries=2,_.transfer_characteristics=2,_.matrix_coefficients=2),_.mono_chrome)return _.color_range=e.u(1),_.subsampling_x=0,_.subsampling_y=0,void(_.separate_uv_delta_q=0);1==_.color_primaries&&13==_.transfer_characteristics&&0==_.matrix_coefficients?(_.color_range=1,_.subsampling_x=0,_.subsampling_y=0):(_.color_range=e.u(1),0==_.seq_profile?(_.subsampling_x=1,_.subsampling_y=1):1==_.seq_profile?(_.subsampling_x=0,_.subsampling_y=0):"twelve_bit"in _&&_.twelve_bit?(_.subsampling_x=e.u(1),_.subsampling_x&&(_.subsampling_y=e.u(1))):(_.subsampling_x=1,_.subsampling_y=0),_.subsampling_x&&_.subsampling_y&&(_.chroma_sample_position=e.u(2))),_.separate_uv_delta_q=e.u(1)},X.prototype.frame_header_obu=function(e,_){this.uncompressed_header(e,_)},X.prototype.frame_obu=function(e,_){this.frame_header_obu(e,_)},X.prototype.uncompressed_header=function(e,_){var t;this.seq_header.frame_id_numbers_present_flag&&(t=this.seq_header.additional_frame_id_length_minus_1+this.seq_header.delta_frame_id_length_minus_2+3);var r=(1<<this.NUM_REF_FRAMES)-1;if(this.seq_header.reduced_still_picture_header)_.show_existing_frame=0,_.frame_type=this.frame_type.KEY_FRAME,_["#FrameIsIntra"]=1,_.show_frame=1,_.showable_frame=0;else{if(_.show_existing_frame=e.u(1),1==_.show_existing_frame){if(_.frame_to_show_map_idx=e.u(3),this.seq_header.decoder_model_info_present_flag&&!this.seq_header.equal_picture_interval){var i=frame_presentation_time_length_minus_1+1;_.frame_presentation_time=e.u(i)}_.refresh_frame_flags=0,this.seq_header.frame_id_numbers_present_flag&&(_.display_frame_id=e.u(t));var a=this.find_ref(_["frame_to_show_map_idx["+ref_idx+"]"]);return _.frame_type=a.frame_type,void(_.frame_type==this.frame_type.KEY_FRAME&&(_.refresh_frame_flags=r))}if(_.frame_type=e.u(2),_["#FrameIsIntra"]=_.frame_type==this.frame_type.INTRA_ONLY_FRAME||_.frame_type==this.frame_type.KEY_FRAME,_.show_frame=e.u(1),_.show_frame&&this.seq_header.decoder_model_info_present_flag&&!equal_picture_interval){i=this.seq_header.frame_presentation_time_length_minus_1+1;_.frame_presentation_time=e.u(i)}_.show_frame?_.showable_frame=_.frame_type!=this.frame_type.KEY_FRAME:_.showable_frame=e.u(1),_.frame_type==this.frame_type.SWITCH_FRAME||_.frame_type==this.frame_type.KEY_FRAME&&_.show_frame?_.error_resilient_mode=1:_.error_resilient_mode=e.u(1)}if(_.disable_cdf_update=e.u(1),this.seq_header.seq_force_screen_content_tools==this.SELECT_SCREEN_CONTENT_TOOLS?_.allow_screen_content_tools=e.u(1):_.allow_screen_content_tools=this.seq_header.seq_force_screen_content_tools,this.seq_header.allow_screen_content_tools?this.seq_header.seq_force_integer_mv==this.SELECT_INTEGER_MV?_.force_integer_mv=e.u(1):_.force_integer_mv=this.seq_header.seq_force_integer_mv:_.force_integer_mv=0,_["#FrameIsIntra"]&&(_.force_integer_mv=1),this.seq_header.frame_id_numbers_present_flag?_.current_frame_id=e.u(t):_.current_frame_id=0,_.frame_type==this.frame_type.SWITCH_FRAME?_.frame_size_override_flag=1:this.seq_header.reduced_still_picture_header?_.frame_size_override_flag=0:_.frame_size_override_flag=e.u(1),_.order_hint=e.u(this.seq_header["#OrderHintBits"]),_["#FrameIsIntra"]||this.seq_header.error_resilient_mode?_.primary_ref_frame=this.PRIMARY_REF_NONE:_.primary_ref_frame=e.u(3),this.seq_header.decoder_model_info_present_flag&&(_.buffer_removal_time_present_flag=e.u(1),_.buffer_removal_time_present_flag))for(var s=0;s<=this.seq_header.operating_points_cnt_minus_1;s++)if(this.seq_header["decoder_model_present_for_this_op["+s+"]"]){var n=this.seq_header["operating_point_idc["+s+" ]"],l=n>>_.temporal_id&1,o=n>>_.spatial_id+8&1;if(0==n||l&&o){i=this.seq_header.buffer_removal_time_length_minus_1+1;_["buffer_removal_time["+s+"]"]=e.u(i)}}if(_.allow_high_precision_mv=0,_.use_ref_frame_mvs=0,_.allow_intrabc=0,_.frame_type==this.frame_type.SWITCH_FRAME||_.frame_type==this.frame_type.KEY_FRAME&&_.show_frame?_.refresh_frame_flags=r:_.refresh_frame_flags=e.u(8),(!_["#FrameIsIntra"]||_.refresh_frame_flags!=r)&&this.seq_header.error_resilient_mode&&this.seq_header.enable_order_hint)for(s=0;s<this.NUM_REF_FRAMES;s++)_["ref_order_hint["+s+"]"]=e.u(this.seq_header["#OrderHintBits"]);if(_.frame_type==this.frame_type.KEY_FRAME||_.frame_type==this.frame_type.INTRA_ONLY_FRAME)this.frame_size(e,_),this.render_size(e,_),this.seq_header.allow_screen_content_tools&&_["#UpscaledWidth"]==_["#FrameWidth"]&&(_.allow_intrabc=e.u(1));else{for(_.enable_order_hint?(_.frame_refs_short_signaling=e.u(1),_.frame_refs_short_signaling&&(_.last_frame_idx=e.u(3),_.gold_frame_idx=e.u(3))):_.frame_refs_short_signaling=0,s=0;s<this.REFS_PER_FRAME;s++)if(_.frame_refs_short_signaling||(_["ref_frame_idx["+s+"]"]=e.u(3)),this.seq_header.frame_id_numbers_present_flag){i=this.seq_header.delta_frame_id_length_minus_2+2;_.delta_frame_id_minus_1=e.u(i)}if(this.seq_header.frame_size_override_flag&&!this.seq_header.error_resilient_mode)for(s=0;s<this.REFS_PER_FRAME;s++)if(_["found_ref["+s+"]"]=e.u(1),_["found_ref["+s+"]"]){var u=this.find_ref(_["ref_frame_idx["+s+"]"]);_["#UpscaledWidth"]=u["#UpscaledWidth"],_["#FrameWidth"]=_["#UpscaledWidth"],_["#FrameHeight"]=u["#FrameHeight"],_["#RenderWidth"]=u["#RenderWidth"],_["#RenderHeight"]=u["#RenderHeight"],this.superres_params(e,_);break}"#FrameWidth"in _||(this.frame_size(e,_),this.render_size(e,_)),_.force_integer_mv?_.allow_high_precision_mv=0:_.allow_high_precision_mv=e.u(1),_.is_filter_switchable=e.u(1),1==_.is_filter_switchable?_.interpolation_filter=4:_.interpolation_filter=e.u(2),_.is_motion_mode_switchable=e.u(1),this.seq_header.error_resilient_mode||!this.seq_header.enable_ref_frame_mvs?_.use_ref_frame_mvs=0:_.use_ref_frame_mvs=e.u(1)}this.seq_header.reduced_still_picture_header||_.disable_cdf_update?_.disable_frame_end_update_cdf=1:_.disable_frame_end_update_cdf=e.u(1),_.primary_ref_frame==this.PRIMARY_REF_NONE?this.setup_past_independence(_):this.load_previous(_),this.tile_info(e,_),this.quantization_params(e,_),this.segmentation_params(e,_),this.delta_q_params(e,_),this.delta_lf_params(e,_),_["#CodedLossless"]=1;for(var f=0;f<this.MAX_SEGMENTS;f++)_["qindex["+f+"]"]=this.get_qindex(_,1,f),_["#LosslessArray["+f+"]"]=0==_["qindex["+f+"]"]&&0==_["#DeltaQYDc"]&&0==_["#DeltaQUAc"]&&0==_["#DeltaQUDc"]&&0==_["#DeltaQVAc"]&&0==_["#DeltaQVDc"],_["#LosslessArray["+f+"]"]||(_["#CodedLossless"]=0);_["#AllLossless"]=_["#CodedLossless"]&&_["#FrameWidth"]==_["#UpscaledWidth"],this.loop_filter_params(e,_),this.cdef_params(e,_),this.lr_params(e,_),_.tx_mode_select=_["#CodedLossless"]?0:e.u(1),_.reference_select=_["#FrameIsIntra"]?0:e.u(1),this.skip_mode_params(e,_),_["#FrameIsIntra"]||this.seq_header.error_resilient_mode||!this.seq_header.enable_warped_motion?_.allow_warped_motion=0:_.allow_warped_motion=e.u(1),_.reduced_tx_set=e.u(1),this.global_motion_params(e,_),this.film_grain_params(e,_)},X.prototype.frame_size=function(e,_){if(_.frame_size_override_flag){var t=frame_width_bits_minus_1+1;_.frame_width_minus_1=e.u(t),t=frame_height_bits_minus_1+1,_.frame_height_minus_1=e.u(t),_["#FrameWidth"]=_.frame_width_minus_1+1,_["#FrameHeight"]=_.frame_height_minus_1+1}else _["#FrameWidth"]=this.seq_header.max_frame_width_minus_1+1,_["#FrameHeight"]=this.seq_header.max_frame_height_minus_1+1;this.superres_params(e,_)},X.prototype.superres_params=function(e,_){this.seq_header.enable_superres?_.use_superres=e.u(1):_.use_superres=0,_.use_superres?(_.coded_denom=e.u(3),_["#SuperresDenom"]=_.coded_denom+9):_["#SuperresDenom"]=8,_["#UpscaledWidth"]=_["#FrameWidth"],_["#FrameWidth"]=(8*_["#UpscaledWidth"]+(_["#SuperresDenom"]>>1))/_["#SuperresDenom"]>>>0},X.prototype.render_size=function(e,_){_.render_and_frame_size_different=e.u(1),1==_.render_and_frame_size_different?(_.render_width_minus_1=e.u(16),_.render_height_minus_1=e.u(16),_["#RenderWidth"]=_.render_width_minus_1+1,_["#RenderHeight"]=_.render_height_minus_1+1):(_["#RenderWidth"]=_["#UpscaledWidth"],_["#RenderHeight"]=_["#FrameHeight"])},X.prototype.get_relative_dist=function(e,_){if(!this.seq_header.enable_order_hint)return 0;var t=e-_,r=1<<this.seq_header["#OrderHintBits"]-1;return t=(t&r-1)-(t&r)},X.prototype.setup_past_independence=function(e){for(var _=this.ref_frame_type.LAST_FRAME;_<=this.ref_frame_type.ALTREF_FRAME;++_)for(var t=0;t<=5;++t)e["#PrevGmParams["+_+"]["+t+"]"]=t%3==2?65536:8},X.prototype.load_previous=function(e){for(var _=this.find_ref(e["ref_frame_idx["+e.primary_ref_frame+"]"]),t=this.ref_frame_type.LAST_FRAME;t<=this.ref_frame_type.ALTREF_FRAME;++t)for(var r=0;r<=5;++r)e["#PrevGmParams["+t+"]["+r+"]"]=_["#gm_params["+t+"]["+r+"]"]},X.prototype.tile_info=function(e,_){var t=2*(_["#FrameWidth"]+7>>3),r=2*(_["#FrameHeight"]+7>>3),i=this.seq_header.use_128x128_superblock?31+t>>5:15+t>>4,a=this.seq_header.use_128x128_superblock?31+r>>5:15+r>>4,s=2+(this.seq_header.use_128x128_superblock?5:4),n=4096>>s,l=9437184>>2*s,o=this.tile_log2(n,i),u=this.tile_log2(1,Math.min(i,64)),f=this.tile_log2(1,Math.min(a,64)),p=Math.max(o,this.tile_log2(l,a*i));if(_.uniform_tile_spacing_flag=e.u(1),_.uniform_tile_spacing_flag){for(_.tile_cols_log2=o;_.tile_cols_log2<u&&e.u(1);)_.tile_cols_log2++;for(_.tile_rows_log2=Math.max(p-_.tile_cols_log2,0);_.tile_rows_log2<f&&e.u(1);)_.tile_rows_log2++}else{var d=0,c=0;for(g=0;c<i;g++){var m=Math.min(i-c,n);_.width_in_sbs_minus_1=e.ns(m);var h=_.width_in_sbs_minus_1+1;d=Math.max(h,d),c+=h}_.tile_cols_log2=this.tile_log2(1,g),l=0<p?a*i>>p+1:a*i;var g,y=Math.max(l/d>>>0,1);c=0;for(g=0;c<a;g++){var v=Math.min(a-c,y);_.height_in_sbs_minus_1=e.ns(v),c+=_.height_in_sbs_minus_1+1}_.tile_rows_log2=this.tile_log2(1,g)}0<_.tile_cols_log2||0<_.tile_rows_log2?(_.context_update_tile_id=e.u(_.tile_rows_log2+_.tile_cols_log2),_.tile_size_bytes_minus_1=e.u(2)):_.context_update_tile_id=0},X.prototype.tile_log2=function(e,_){for(var t=0;e<<t<_;)t++;return t},X.prototype.quantization_params=function(e,_){_.base_q_idx=e.u(8),_["#DeltaQYDc"]=this.read_delta_q(e,_),this.seq_header.mono_chrome?(_["#DeltaQUDc"]=0,_["#DeltaQUAc"]=0,_["#DeltaQVDc"]=0,_["#DeltaQVAc"]=0):(this.seq_header.separate_uv_delta_q?_.diff_uv_delta=e.u(1):_.diff_uv_delta=0,_["#DeltaQUDc"]=this.read_delta_q(e,_),_["#DeltaQUAc"]=this.read_delta_q(e,_),_.diff_uv_delta?(_["#DeltaQVAc"]=this.read_delta_q(e,_),_["#DeltaQVDc"]=this.read_delta_q(e,_)):(_["#DeltaQVAa"]=_["#DeltaQUDc"],_["#DeltaQVAc"]=_["#DeltaQUAc"])),_.using_qmatrix=e.u(1),_.using_qmatrix&&(_.qm_y=e.u(4),_.qm_u=e.u(4),this.seq_header.separate_uv_delta_q?_.qm_v=e.u(4):_.qm_v=_.qm_u)},X.prototype.read_delta_q=function(e,_){var t=0;return e.u(1)&&(t=e.su(7)),t},X.prototype.segmentation_params=function(e,_){var t=[8,6,6,6,6,3,0,0],r=[1,1,1,1,1,0,0,0],a=[255,63,63,63,63,7,0,0];if(_.segmentation_enabled=e.u(1),1==_.segmentation_enabled){if(_.primary_ref_frame==this.PRIMARY_REF_NONE?(_.segmentation_update_map=1,_.segmentation_temporal_update=0,_.segmentation_update_data=1):(_.segmentation_update_map=e.u(1),1==_.segmentation_update_map&&(_.segmentation_temporal_update=e.u(1)),_.segmentation_update_data=e.u(1)),1==_.segmentation_update_data)for(i=0;i<8;i++)for(j=0;j<8;j++){var s=_["feature_enabled["+i+"]["+j+"]"]=e.u(1);if(this.FeatureEnabled[i][j]=s){var n=t[j],l=a[j],o=0;o=1==r[j]?(_["feature_value["+i+"]["+j+"]"]=e.su(1+n),H(_["feature_value["+i+"]["+j+"]"],-l,l)):(_["feature_value["+i+"]["+j+"]"]=e.u(n),H(_["feature_value["+i+"]["+j+"]"],0,_["feature_value["+i+"]["+j+"]"])),this.FeatureData[i][j]=o}}}else this.FeatureEnabled.fill(0),this.FeatureData.fill(0)},X.prototype.delta_q_params=function(e,_){_.delta_q_res=0,(_.delta_q_present=0)<_.base_q_idx&&(_.delta_q_present=e.u(1)),_.delta_q_present&&(_.delta_q_res=e.u(2))},X.prototype.delta_lf_params=function(e,_){_.delta_lf_present=0,_.delta_lf_res=0,_.delta_lf_multi=0,_.delta_q_present&&(_.allow_intrabc||(_.delta_lf_present=e.u(1)),_.delta_lf_present&&(_.delta_lf_res=e.u(2),_.delta_lf_multi=e.u(1)))},X.prototype.get_qindex=function(e,_,t){var r=e.base_q_idx;return e.segmentation_enabled&&this.FeatureEnabled[t][0]&&(r+=this.FeatureData[t][0]),H(r,0,255)},X.prototype.loop_filter_params=function(e,_){if(!_["#CodedLossless"]&&!_.allow_intrabc&&(_["loop_filter_level[0]"]=e.u(6),_["loop_filter_level[1]"]=e.u(6),this.seq_header.mono_chrome||(_["loop_filter_level[0]"]||_["loop_filter_level[1]"])&&(_["loop_filter_level[2]"]=e.u(6),_["loop_filter_level[3]"]=e.u(6)),_.loop_filter_sharpness=e.u(3),_.loop_filter_delta_enabled=e.u(1),_.loop_filter_delta_enabled&&(_.loop_filter_delta_update=e.u(1),_.loop_filter_delta_update))){for(var t=0;t<8;t++)_.update_ref_delta=e.u(1),_.update_ref_delta&&(_["loop_filter_ref_deltas["+t+"]"]=e.su(7));for(t=0;t<2;t++)_.update_mode_delta=e.u(1),_.update_mode_delta&&(_["loop_filter_mode_deltas["+t+"]"]=e.su(7))}},X.prototype.cdef_params=function(e,_){if(!_["#CodedLossless"]&&!_.allow_intrabc&&this.seq_header.enable_cdef){_.cdef_damping_minus_3=e.u(2),_.cdef_bits=e.u(2);for(var t=0;t<1<<_.cdef_bits;t++)_["cdef_y_pri_strength["+t+"]"]=e.u(4),_["cdef_y_sec_strength["+t+"]"]=e.u(2),3==_["cdef_y_sec_strength["+t+"]"]&&(_["cdef_y_sec_strength["+t+"]"]+=1),this.seq_header.mono_chrome||(_["cdef_uv_pri_strength["+t+"]"]=e.u(4),_["cdef_uv_sec_strength["+t+"]"]=e.u(2),3==_["cdef_uv_sec_strength["+t+"]"]&&(_["cdef_uv_sec_strength["+t+"]"]+=1))}},X.prototype.lr_params=function(e,_){if(!_["#AllLossless"]&&!_.allow_intrabc&&this.seq_header.enable_restoration){for(var t=this.seq_header.mono_chrome?1:3,r=0;r<t;r++)_["lr_type["+r+"]"]=e.u(2);_["lr_type[0]"]&&(this.seq_header.use_128x128_superblock?_.lr_unit_shift=e.u(1):(_.lr_unit_shift=e.u(1),_.lr_unit_shift&&(_.lr_unit_extra_shift=e.u(1))),this.seq_header.subsampling_x&&this.seq_header.subsampling_y)}},X.prototype.skip_mode_params=function(e,_){var t;if(!_["#FrameIsIntra"]&&_.reference_select&&_.enable_order_hint){for(var r=-1,i=-1,a=-1,s=Math.pow(2,32)-1,n=0;n<this.NUM_REF_FRAMES;n++){var l=this.find_ref(_["ref_frame_idx["+n+"]"]).order_hint;this.get_relative_dist(l,_.order_hint)<0?(r<0||0<this.get_relative_dist(l,a))&&(r=n,a=l):0<this.get_relative_dist(l,_.order_hint)&&(i<0||this.get_relative_dist(l,s)<0)&&(i=n,s=l)}if(r<0)t=0;else if(0<=i)t=1;else{var o=-1,u=-1;for(n=0;n<this.NUM_REF_FRAMES;n++){l=this.find_ref(_["ref_frame_idx["+n+"]"]).order_hint;this.get_relative_dist(l,a)<0&&(o<0||0<this.get_relative_dist(l,u))&&(o=n,u=l)}t=o<0?0:1}}else t=0;_.skip_mode_present=t?e.u(1):0},X.prototype.global_motion_params=function(e,_){for(var t=this.ref_frame_type.LAST_FRAME;t<=this.ref_frame_type.ALTREF_FRAME;t++)for(i=0;i<6;i++)_["#gm_params["+t+"]["+i+"]"]=i%3==2?65536:0;if(!_["#FrameIsIntra"])for(t=this.ref_frame_type.LAST_FRAME;t<=this.ref_frame_type.ALTREF_FRAME;t++){var r;_["is_global["+t+"]"]=e.u(1),(r=_["is_global["+t+"]"]?(_["is_rot_zoom["+t+"]"]=e.u(1),_["is_rot_zoom["+t+"]"]?this.ROTZOOM:(_["is_translation["+t+"]"]=e.u(1),_["is_translation["+t+"]"]?this.TRANSLATION:this.AFFINE)):this.IDENTITY)>=this.ROTZOOM&&(this.read_global_param(e,_,r,t,2),this.read_global_param(e,_,r,t,3),r==this.AFFINE?(this.read_global_param(e,_,r,t,4),this.read_global_param(e,_,r,t,5)):(_["#gm_params["+t+"][4]"]=-_["#gm_params["+t+"][3]"],_["#gm_params["+t+"][5]"]=_["#gm_params["+t+"][2]"])),r>=this.TRANSLATION&&(this.read_global_param(e,_,r,t,0),this.read_global_param(e,_,r,t,1))}},X.prototype.read_global_param=function(e,_,t,r,i){var a=12,s=15;i<2&&(s=t==this.TRANSLATION?(a=9-!_.allow_high_precision_mv,3-!_.allow_high_precision_mv):(a=12,6));var n=16-s,l=i%3==2?65536:0,o=i%3==2?1<<s:0,u=1<<a,f=(_["#PrevGmParams["+r+"]["+i+"]"]>>n)-o;_["#gm_params["+r+"]["+i+"]"]=(this.decode_signed_subexp_with_ref(e,_,-u,1+u,f)<<n)+l},X.prototype.decode_signed_subexp_with_ref=function(e,_,t,r,i){return this.decode_unsigned_subexp_with_ref(e,_,r-t,i-t)+t},X.prototype.decode_unsigned_subexp_with_ref=function(e,_,t,r){return v=this.decode_subexp(e,_,t),r<<1<=t?this.inverse_recenter(r,v):t-1-this.inverse_recenter(t-1-r,v)},X.prototype.decode_subexp=function(e,_,t){for(var r=0,i=0,a=0;;){var s=r?3+r-1:3,n=1<<s;if(t<=i+3*n)return _["subexp_final_bits["+a+"]"]=e.ns(t-i),subexp_final_bits+i;if(_["subexp_more_bits["+a+"]"]=e.u(1),!_["subexp_more_bits["+a+"]"])return _["subexp_bits["+a+"]"]=e.u(s),_["subexp_bits["+a+"]"]+i;r++,i+=n,++a}},X.prototype.inverse_recenter=function(e,_){return 2*e<_?_:1&_?e-(_+1>>1):e+(_>>1)},X.prototype.film_grain_params=function(e,_){if(this.seq_header.film_grain_params_present&&(_.show_frame||_.showable_frame)&&(_.apply_grain=e.u(1),_.apply_grain))if(_.grain_seed=e.u(16),_.frame_type==this.frame_type.INTER_FRAME?_.update_grain=e.u(1):_.update_grain=1,_.update_grain){for(_.num_y_points=e.u(4),t=0;t<num_y_points;t++)_["point_y_value[ i ]"]=e.u(8),_["point_y_scaling[ i ]"]=e.u(8);if(this.seq_header.mono_chrome?_.chroma_scaling_from_luma=0:_.chroma_scaling_from_luma=e.u(1),this.seq_header.mono_chrome||this.seq_header.chroma_scaling_from_luma||1==this.seq_header.subsampling_x&&1==this.seq_header.subsampling_y&&0==_.num_y_points)_.num_cb_points=0,_.num_cr_points=0;else{_.num_cb_points=e.u(4);for(var t=0;t<num_cb_points;t++)_["point_cb_value[ i ]"]=e.u(8),_["point_cb_scaling[ i ]"]=e.u(8);_.num_cr_points=e.u(4);for(t=0;t<num_cr_points;t++)_["point_cr_value[ i ]"]=e.u(8),_["point_cr_scaling[ i ]"]=e.u(8)}_.grain_scaling_minus_8=e.u(2),_.ar_coeff_lag=e.u(2);var r=2*_.ar_coeff_lag*(_.ar_coeff_lag+1),i=r;if(_.num_y_points){i=1+r;for(t=0;t<r;t++)_["ar_coeffs_y_plus_128["+t+"]"]=e.u(8)}if(_.chroma_scaling_from_luma||_.num_cb_points)for(t=0;t<i;t++)_["ar_coeffs_cb_plus_128["+t+"]"]=e.u(8);if(_.chroma_scaling_from_luma||_.num_cr_points)for(t=0;t<i;t++)_["ar_coeffs_cr_plus_128["+t+"]"]=e.u(8);_.ar_coeff_shift_minus_6=e.u(2),_.grain_scale_shift=e.u(2),_.num_cb_points&&(_.cb_mult=e.u(8),_.cb_luma_mult=e.u(8),_.cb_offset=e.u(9)),_.num_cr_points&&(_.cr_mult=e.u(8),_.cr_luma_mult=e.u(8),_.cr_offset=e.u(9)),_.overlap_flag=e.u(1),_.clip_to_restricted_range=e.u(1)}else _.film_grain_params_ref_idx=e.u(3)},Z.prototype.parse=function(e,_){var t=new T(e),r=this.parse_nalu(t);6==r.nal_unit_type?this.parse_sei(t,r):7==r.nal_unit_type?(this.parse_sps(t,r),r["@extra"]=16*(r.pic_width_in_mbs_minus1+1)+"x"+(2-r.frame_mbs_only_flag)*(r.pic_height_in_map_units_minus1+1)*16,r["@extra"]+=" "+this.profile(r),r["@extra"]+=" "+r.level_idc/10):8==r.nal_unit_type?(this.parse_pps(t,r),r["@extra"]=r.entropy_coding_mode_flag?"CABAC":"CAVLC"):U(r.nal_unit_type,[1,5,20])&&(this.parse_slice(t,r),r["@keyframe"]=5==r.nal_unit_type||r.idr_flag||0,r["@keyframe"]?r["@type"]="IDR":r["@type"]=["P","B","I","SP","SI"][r.slice_type%5],r["@extra"]="frame_num "+r.frame_num,0==r.first_mb_in_slice&&(r["@frame_num"]=this.frame_num++)),"@type"in r||(r["@type"]=this.nal_unit_type[r.nal_unit_type]),r["@addr"]=_,r["@length"]=e.length,r["@data"]=e,B(r)},Z.prototype.find_nalu=function(e,_,t){for(var r=N.length-1;0<=r;r--){var i=N[r];if("nal_unit_type"in i&&U(i.nal_unit_type,e)&&(null==_||i[_]==t))return i}return null},Z.prototype.profile=function(e){var _={66:"Baseline",77:"Main",88:"Extended",100:"High",110:"High 10",122:"High 4:2:2",244:"High 4:4:4 Predictive",83:"Scalable Baseline",86:"Scalable High"},t=e.profile_idc in _?_[e.profile_idc]:"Unknown";return 66==e.profile_idc?1==e.constraint_set0_flag&&(t="Constrained "+t):100==e.profile_idc?1==e.constraint_set4_flag&&1==e.constraint_set5_flag&&(t="Constrained "+t):110==e.profile_idc?1==e.constraint_set3_flag&&(t+=" Intra"):83==e.profile_idc?1==e.constraint_set5_flag&&(t="Scalable Constrained Baseline"):86==e.profile_idc&&1==e.constraint_set5_flag&&(t="Scalable Constrained High"),t},Z.prototype.parse_nalu=function(e){var _={};return _.forbidden_zero_bit=e.u(1),_.nal_ref_idc=e.u(2),_.nal_unit_type=e.u(5),U(_.nal_unit_type,[14,20,30])&&(_.svc_extension_flag=e.u(1),_.svc_extension_flag&&(_.idr_flag=e.u(1),_.priority_id=e.u(6),_.no_inter_layer_pred_flag=e.u(1),_.dependency_id=e.u(3),_.quality_id=e.u(4),_.temporal_id=e.u(3),_.use_ref_base_pic_flag=e.u(1),_.discardable_flag=e.u(1),_.output_flag=e.u(1),_.reserved_three_2bits=D(e.u(2),2,2,"0",0))),_},Z.prototype.parse_sps=function(e,_){if(_.profile_idc=e.u(8),_.constraint_set0_flag=e.u(1),_.constraint_set1_flag=e.u(1),_.constraint_set2_flag=e.u(1),_.constraint_set3_flag=e.u(1),_.constraint_set4_flag=e.u(1),_.constraint_set5_flag=e.u(1),_.reserved_zero_2bits=D(e.u(2),2,2,"0",0),_.level_idc=e.u(8),_.seq_parameter_set_id=e.ue(),U(_.profile_idc,[100,110,122,244,44,83,86,118,128])&&(_.chroma_format_idc=e.ue(),3==_.chroma_format_idc&&(_.separate_colour_plane_flag=e.u(1)),_.bit_depth_luma_minus8=e.ue(),_.bit_depth_chroma_minus8=e.ue(),_.qpprime_y_zero_transform_bypass_flag=e.u(1),_.seq_scaling_matrix_present_flag=e.u(1),_.seq_scaling_matrix_present_flag))for(var t=0;t<(3!=_.chroma_format_idc?8:12);t++)if(_["seq_scaling_list_present_flag["+t+"]"]=e.u(1),_["seq_scaling_list_present_flag["+t+"]"]){var r=t<6?4:8;_["seq_scaling_list_present_flag["+t+"]"]=this.scaling_list(e,r*r)}if(_.log2_max_frame_num_minus4=e.ue(),_.pic_order_cnt_type=e.ue(),0==_.pic_order_cnt_type)_.log2_max_pic_order_cnt_lsb_minus4=e.ue();else if(1==_.pic_order_cnt_type){_.delta_pic_order_always_zero_flag=e.u(1),_.offset_for_non_ref_pic=e.se(),_.offset_for_top_to_bottom_field=e.se(),_.num_ref_frames_in_pic_order_cnt_cycle=e.ue();for(t=0;t<_.num_ref_frames_in_pic_order_cnt_cycle;t++)_["offset_for_ref_frame["+t+"]"]=e.se()}_.max_num_ref_frames=e.ue(),_.gaps_in_frame_num_value_allowed_flag=e.u(1),_.pic_width_in_mbs_minus1=e.ue(),_.pic_height_in_map_units_minus1=e.ue(),_.frame_mbs_only_flag=e.u(1),0==_.frame_mbs_only_flag&&(_.mb_adaptive_frame_field_flag=e.u(1)),_.direct_8x8_inference_flag=e.u(1),_.frame_cropping_flag=e.u(1),_.frame_cropping_flag&&(_.frame_crop_left_offset=e.ue(),_.frame_crop_right_offset=e.ue(),_.frame_crop_top_offset=e.ue(),_.frame_crop_bottom_offset=e.ue()),_.vui_parameters_present_flag=e.u(1),_.vui_parameters_present_flag&&(_.aspect_ratio_info_present_flag=e.u(1),_.aspect_ratio_info_present_flag&&(_.aspect_ratio_idc=e.u(8),255==_.aspect_ratio_idc&&(_.sar_width=e.u(16),_.sar_height=e.u(16))),_.overscan_info_present_flag=e.u(1),_.overscan_info_present_flag&&(_.overscan_appropriate_flag=e.u(1)),_.video_signal_type_present_flag=e.u(1),_.video_signal_type_present_flag&&(_.video_format=e.u(3),_.video_full_range_flag=e.u(1),_.colour_description_present_flag=e.u(1),_.colour_description_present_flag&&(_.colour_primaries=e.u(8),_.transfer_characteristics=e.u(8),_.matrix_coefficients=e.u(8))),_.chroma_loc_info_present_flag=e.u(1),_.chroma_loc_info_present_flag&&(_.chroma_sample_loc_type_top_field=e.ue(),_.chroma_sample_loc_type_bottom_field=e.ue()),_.timing_info_present_flag=e.u(1),_.timing_info_present_flag&&(_.num_units_in_tick=e.u(32),_.time_scale=e.u(32),_.fixed_frame_rate_flag=e.u(1)),_.nal_hrd_parameters_present_flag=e.u(1),_.nal_hrd_parameters_present_flag&&(_.nal_hrd=this.parse_hrd(e)),_.vcl_hrd_parameters_present_flag=e.u(1),_.vcl_hrd_parameters_present_flag&&(_.vlc_hrd=this.parse_hrd(e)),(_.nal_hrd_parameters_present_flag||_.vcl_hrd_parameters_present_flag)&&(_.low_delay_hrd_flag=e.u(1)),_.pic_struct_present_flag=e.u(1),_.bitstream_restriction_flag=e.u(1),_.bitstream_restriction_flag&&(_.motion_vectors_over_pic_boundaries_flag=e.u(1),_.max_bytes_per_pic_denom=e.ue(),_.max_bits_per_mb_denom=e.ue(),_.log2_max_mv_length_horizontal=e.ue(),_.log2_max_mv_length_vertical=e.ue(),_.max_num_reorder_frames=e.ue(),_.max_dec_frame_buffering=e.ue()))},Z.prototype.parse_hrd=function(e){var _={};_.cpb_cnt_minus1=e.ue(),_.bit_rate_scale=e.u(4),_.cpb_size_scale=e.u(4);for(var t=0;t<_.cpb_cnt_minus1+1;t++)_["bit_rate_value_minus1["+t+"]"]=e.ue(),_["cpb_size_value_minus1["+t+"]"]=e.ue(),_["cbr_flag["+t+"]"]=e.u(1);return _.initial_cpb_removal_delay_length_minus1=e.u(5),_.cpb_removal_delay_length_minus1=e.u(5),_.dpb_output_delay_length_minus1=e.u(5),_.time_offset_length=e.u(5),_},Z.prototype.parse_pps=function(e,_){if(_.pic_parameter_set_id=e.ue(),_.seq_parameter_set_id=e.ue(),_.entropy_coding_mode_flag=e.u(1),_.bottom_field_pic_order_in_frame_present_flag=e.u(1),_.num_slice_groups_minus1=e.ue(),_.num_ref_idx_l0_default_active_minus1=e.ue(),_.num_ref_idx_l1_default_active_minus1=e.ue(),_.weighted_pred_flag=e.u(1),_.weighted_bipred_idc=e.u(2),_.pic_init_qp_minus26=e.se(),_.pic_init_qs_minus26=e.se(),_.chroma_qp_index_offset=e.se(),_.deblocking_filter_control_present_flag=e.u(1),_.constrained_intra_pred_flag=e.u(1),_.redundant_pic_cnt_present_flag=e.u(1),P(e)&&(_.transform_8x8_mode_flag=e.u(1),_.pic_scaling_matrix_present_flag=e.u(1),_.pic_scaling_matrix_present_flag)){sps=this.find_nalu([7,15],"seq_parameter_set_id",_.seq_parameter_set_id),nlists=6,sps&&(nlists+="chroma_format_idc"in sps&&3==sps.chroma_format_idc?6*_.transform_8x8_mode_flag:2*_.transform_8x8_mode_flag);for(var t=0;t<nlists;t++)if(_["pic_scaling_list_present_flag["+t+"]"]=e.u(1),_["pic_scaling_list_present_flag["+t+"]"]){var r=t<6?4:8;_["pic_scaling_list_present_flag["+t+"]"]=this.scaling_list(e,r*r)}}},Z.prototype.parse_slice=function(e,_){_.first_mb_in_slice=e.ue(),_.slice_type=e.ue(),_.pic_parameter_set_id=e.ue();var t=this.find_nalu([8],"pic_parameter_set_id",_.pic_parameter_set_id);if(null==t)return _;var r=this.find_nalu(20==_.nal_unit_type?[15]:[7],"seq_parameter_set_id",t.seq_parameter_set_id);if(null==r)return _;if("separate_colour_plane_flag"in r&&1==r.separate_colour_plane_flag&&(_.colour_plane_id=e.u(2)),_.frame_num=e.u(r.log2_max_frame_num_minus4+4),0==r.frame_mbs_only_flag&&(_.field_pic_flag=e.u(1),_.field_pic_flag&&(_.bottom_field_flag=e.u(1))),(5==_.nal_unit_type||"idr_flag"in _&&1==_.idr_flag)&&(_.idr_pic_id=e.ue()),0==r.pic_order_cnt_type?(_.pic_order_cnt_lsb=e.u(r.log2_max_pic_order_cnt_lsb_minus4+4),1!=t.bottom_field_pic_order_in_frame_present_flag||"field_pic_flag"in _&&0!=_.field_pic_flag||(_.delta_pic_order_cnt_bottom=e.se())):1==r.pic_order_cnt_type&&0==r.delta_pic_order_always_zero_flag&&(_["delta_pic_order_cnt[0]"]=e.se(),t.bottom_field_pic_order_in_frame_present_flag&&"field_pic_flag"in _&&0==_.field_pic_flag&&(_["delta_pic_order_cnt[1]"]=e.se())),1==t.redundant_pic_cnt_present_flag&&(_.redundant_pic_cnt=e.ue()),!("quality_id"in _)||0==_.quality_id){if(_.slice_type%5==1&&(_.direct_spatial_mv_pred_flag=e.u(1)),U(_.slice_type%5,[0,1,3])&&(_.num_ref_idx_active_override_flag=e.u(1),_.num_ref_idx_active_override_flag&&(_.num_ref_idx_l0_active_minus1=e.ue(),_.slice_type%5==1&&(_.num_ref_idx_l1_active_minus1=e.ue()))),!U(_.slice_type%5,[2,4]))for(var i=0;i<(_.slice_type%5==1?2:1);i++)if(_["ref_pic_list_modification_flag_l"+i]=e.u(1),_["ref_pic_list_modification_flag_l"+i])for(var a=0,s=0;3!=s;)s=e.ue(),U(_["modification_of_pic_nums_idc_l"+i+"["+a+"]"]=s,[0,1])?_["abs_diff_pic_num_minus1_l"+i+"["+a+"]"]=e.ue():2==s&&(_["long_term_pic_num_l"+i+"["+a+"]"]=e.ue()),a+=1;if(t.weighted_pred_flag&&U(_.slice_type%5,[0,3])||1==t.weighted_bipred_idc&&_.slice_type%5==1){_.luma_log2_weight_denom=e.ue(),"chroma_format_idc"in r&&0==r.chroma_format_idc||(_.chroma_log2_weight_denom=e.ue());for(i=0;i<(_.slice_type%5==1?2:1);i++){var n=t["num_ref_idx_l"+i+"_default_active_minus1"];if("num_ref_idx_l"+i+"_active_minus1"in _)n=_["num_ref_idx_l"+i+"_active_minus1"];for(a=0;a<=n;a++)if(_["luma_weight_l"+i+"_flag"]=e.u(1),_["luma_weight_l"+i+"_flag"]&&(_["luma_weight_l"+i+"["+a+"]"]=e.se(),_["luma_offset_l"+i+"["+a+"]"]=e.se()),"chroma_log2_weight_denom"in _&&(_["chroma_weight_l"+i+"_flag"]=e.u(1),_["chroma_weight_l"+i+"_flag"]))for(var l=0;l<2;l++)_["chroma_weight_l"+i+"["+a+"]["+l+"]"]=e.se(),_["chroma_offset_l"+i+"["+a+"]["+l+"]"]=e.se()}}if(0!=_.nal_ref_idc){if(5==_.nal_unit_type||"idr_flag"in _&&1==_.idr_flag)_.no_output_of_prior_pics_flag=e.u(1),_.long_term_reference_flag=e.u(1);else if(_.adaptive_ref_pic_marking_mode_flag=e.u(1),_.adaptive_ref_pic_marking_mode_flag){a=0;for(var o=1;0!=o;)o=e.ue(),U(_["memory_management_control_operation["+a+"]"]=o,[1,3])&&(_["difference_of_pic_nums_minus1["+a+"]"]=e.ue()),2==o&&(_["long_term_pic_num["+a+"]"]=e.ue()),U(o,[3,6])&&(_["long_term_frame_idx["+a+"]"]=e.ue()),4==o&&(_["max_long_term_frame_idx_plus1["+a+"]"]=e.ue()),a+=1}if("slice_header_restriction_flag"in r&&0==r.slice_header_restriction_flag&&(_.store_ref_base_pic_flag=e.u(1),(_.use_ref_base_pic_flag||_.store_ref_base_pic_flag&&0==_.idr_flag)&&(_.adaptive_ref_base_pic_marking_mode_flag=e.u(1),_.adaptive_ref_base_pic_marking_mode_flag))){a=0;for(var u=1;0!=u;)u=e.ue(),1==(_["memory_management_base_control_operation["+a+"]"]=o)&&(_["difference_of_base_pic_nums_minus1["+a+"]"]=e.ue()),2==o&&(_["long_term_base_pic_num["+a+"]"]=e.ue()),a+=1}}}t.entropy_coding_mode_flag&&!U(_.slice_type%5,[2,4])&&(_.cabac_init_idc=e.ue()),_.slice_qp_delta=e.se(),U(_.slice_type,[3,4])&&(3==_.slice_type&&(_.sp_for_switch_flag=e.u(1)),_.slice_qs_delta=e.se()),t.deblocking_filter_control_present_flag&&(_.disable_deblocking_filter_idc=e.ue(),1!=_.disable_deblocking_filter_idc&&(_.slice_alpha_c0_offset_div2=e.se(),_.slice_beta_offset_div2=e.se())),20==_.nal_unit_type&&(0==_.no_inter_layer_pred_flag&&0==_.quality_id&&(_.ref_layer_dq_id=e.ue(),r.inter_layer_deblocking_filter_control_present_flag&&(_.disable_inter_layer_deblocking_filter_idc=e.ue(),1!=_.disable_inter_layer_deblocking_filter_idc&&(_.inter_layer_slice_alpha_c0_offset_div2=e.se(),_.inter_layer_slice_beta_offset_div2=e.se())),_.constrained_intra_resampling_flag=e.u(1),2==r.extended_spatial_scalability_idc&&("chroma_format_idc"in r&&0<r.chroma_format_idc&&(_.ref_layer_chroma_phase_x_plus1_flag=e.u(1),_.ref_layer_chroma_phase_y_plus1=e.u(2)),_.scaled_ref_layer_left_offset=e.se(),_.scaled_ref_layer_top_offset=e.se(),_.scaled_ref_layer_right_offset=e.se(),_.scaled_ref_layer_bottom_offset=e.se())),0==_.no_inter_layer_pred_flag&&(_.slice_skip_flag=e.u(1),_.slice_skip_flag?_.num_mbs_in_slice_minus1=e.ue():(_.adaptive_base_mode_flag=e.u(1),0==_.adaptive_base_mode_flag&&(_.default_base_mode_flag=e.u(1)),_.adaptive_motion_prediction_flag=e.u(1),0==_.adaptive_motion_prediction_flag&&(_.default_motion_prediction_flag=e.u(1)),_.adaptive_residual_prediction_flag=e.u(1),0==_.adaptive_residual_prediction_flag&&(_.default_residual_prediction_flag=e.u(1))),"adaptive_tcoeff_level_prediction_flag"in r&&1==r.adaptive_tcoeff_level_prediction_flag&&(_.default_residual_prediction_flag=e.u(1))),0!=r.slice_header_restriction_flag||"slice_skip_flag"in _&&0!=_.slice_skip_flag||(_.scan_idx_start=e.u(4),_.scan_idx_end=e.u(4)))},Z.prototype.parse_sei=function(e,_){var t=0;do{for(var r=0;0!=(r+=e.u(8))&&r%255==0;);for(var i=0;0!=(i+=e.u(8))&&i%255==0;);_["payload_type["+t+"]"]=r,_["payload_size["+t+"]"]=i,r<this.sei_payload_type.length&&(_["payload_type["+t+"]"]+=" "+this.sei_payload_type[r]),e.u(8*i),++t}while(P(e))},J.prototype.parse=function(e,_){var t=new T(e),r=this.parse_nalu(t);32==r.nal_unit_type?this.parse_vps(t,r):33==r.nal_unit_type?(this.parse_sps(t,r),r["@extra"]=r.pic_width_in_luma_samples+"x"+r.pic_height_in_luma_samples,r["@extra"]+=" "+this.profile(r),r["@extra"]+=" "+r.general_level_idc):34==r.nal_unit_type?this.parse_pps(t,r):0<=[0,1,2,3,4,5,6,7,8,9,16,17,18,19,20,21].indexOf(r.nal_unit_type)&&(this.slice_segment_header(t,r),r["@keyframe"]=0<=[19,20].indexOf(r.nal_unit_type)?1:0,r["@keyframe"]?r["@type"]="IDR":r["@type"]=["B","P","I"][r.slice_type],r["@extra"]=this.nal_unit_type[r.nal_unit_type],r["@extra"]+=" "+(r["@keyframe"]?0:r.slice_pic_order_cnt_lsb),r["@poc"]=r["@keyframe"]?0:r.slice_pic_order_cnt_lsb,r.first_slice_segment_in_pic_flag&&(r["@frame_num"]=this.frame_num++)),r["@addr"]=_,"@type"in r||(r["@type"]=this.nal_unit_type[r.nal_unit_type]),r["@length"]=e.length,B(r)},J.prototype.find_nalu=function(e,_,t){for(var r=N.length-1;0<=r;r--){var i=N[r];if("nal_unit_type"in i&&U(i.nal_unit_type,e)&&(null==_||i[_]==t))return i}return null},J.prototype.parse_nalu=function(e){var _={};return _.forbidden_zero_bit=e.u(1),_.nal_unit_type=e.u(6),_.nuh_layer_id=e.u(6),_.nuh_temporal_id_plus1=e.u(3),_},J.prototype.profile=function(e){return 1==e.general_profile_idc||e["general_profile_compatibility_flag[1]"]?"Main":2==e.general_profile_idc||e["general_profile_compatibility_flag[2]"]?"Main 10":3==e.general_profile_idc||e["general_profile_compatibility_flag[3]"]?"Main Still Picture":void 0},J.prototype.profile_tier_level=function(e,_,t,r,i){t&&(i["general_profile_space"+_]=e.u(2),i["general_tier_flag"+_]=e.u(1),i["general_profile_idc"+_]=e.u(5),i["general_profile_compatibility_flags"+_]=D(e.u(32),2,32,"0",0),i["general_progressive_source_flag"+_]=e.u(1),i["general_interlaced_source_flag"+_]=e.u(1),i["general_non_packed_constraint_flag"+_]=e.u(1),i["general_frame_only_constraint_flag"+_]=e.u(1),U(i["general_profile_idc"+_],[4,5,6,7])||240&i["general_profile_compatibility_flags"+_]?(i["general_max_12bit_constraint_flag"+_]=e.u(1),i["general_max_10bit_constraint_flag"+_]=e.u(1),i["general_max_8bit_constraint_flag"+_]=e.u(1),i["general_max_422chroma_constraint_flag"+_]=e.u(1),i["general_max_420chroma_constraint_flag"+_]=e.u(1),i["general_max_monochrome_constraint_flag"+_]=e.u(1),i["general_intra_constraint_flag"+_]=e.u(1),i["general_one_picture_only_constraint_flag"+_]=e.u(1),i["general_lower_bit_rate_constraint_flag"+_]=e.u(1),i["general_reserved_zero_34bits"+_]=e.u(34)):i["general_reserved_zero_43bits"+_]=e.u(43),1<=i["general_profile_idc"+_]&&i["general_profile_idc"+_]<=5||62&i["general_profile_compatibility_flags"+_]?i["general_inbld_flag"+_]=e.u(1):i["general_reserved_zero_bit"+_]=e.u(1)),i["general_level_idc"+_]=e.u(8);for(var a=0;a<r;a++)i["sub_layer_profile_present_flag"+_+"["+a+"]"]=e.u(1),i["sub_layer_level_present_flag"+_+"["+a+"]"]=e.u(1);if(0<r)for(a=r;a<8;a++)i["reserved_zero_2bits"+_+"["+a+"]"]=e.u(2);for(a=0;a<r;a++)i["sub_layer_profile_present_flag"+_+"["+a+"]"]&&(i["sub_layer_profile_space"+_+"["+a+"]"]=e.u(2),i["sub_layer_tier_flag"+_+"["+a+"]"]=e.u(1),i["sub_layer_profile_idc"+_+"["+a+"]"]=e.u(5),i["sub_layer_profile_compatibility_flag"+_+"["+a+"]"]=e.u(32),i["sub_layer_progressive_source_flag"+_+"["+a+"]"]=e.u(1),i["sub_layer_interlaced_source_flag"+_+"["+a+"]"]=e.u(1),i["sub_layer_non_packed_constraint_flag"+_+"["+a+"]"]=e.u(1),i["sub_layer_frame_only_constraint_flag"+_+"["+a+"]"]=e.u(1),U(i["sub_layer_profile_idc"+_+"["+a+"]"],[4,5,6,7])||240&i["sub_layer_profile_compatibility_flag"+_+"["+a+"]"]?(i["sub_layer_max_12bit_constraint_flag"+_+"["+a+"]"]=e.u(1),i["sub_layer_max_10bit_constraint_flag"+_+"["+a+"]"]=e.u(1),i["sub_layer_max_8bit_constraint_flag"+_+"["+a+"]"]=e.u(1),i["sub_layer_max_422chroma_constraint_flag"+_+"["+a+"]"]=e.u(1),i["sub_layer_max_420chroma_constraint_flag"+_+"["+a+"]"]=e.u(1),i["sub_layer_max_monochrome_constraint_flag"+_+"["+a+"]"]=e.u(1),i["sub_layer_intra_constraint_flag"+_+"["+a+"]"]=e.u(1),i["sub_layer_one_picture_only_constraint_flag"+_+"["+a+"]"]=e.u(1),i["sub_layer_lower_bit_rate_constraint_flag"+_+"["+a+"]"]=e.u(1),i["sub_layer_reserved_zero_34bits"+_+"["+a+"]"]=e.u(34)):i["sub_layer_reserved_zero_43bits"+_+"["+a+"]"]=e.u(43),1<=i["sub_layer_profile_idc"+_+"["+a+"]"]&&i["sub_layer_profile_idc"+_+"["+a+"]"]<=5||62&i["sub_layer_profile_idc"+_+"["+a+"]"]?i["sub_layer_inbld_flag"+_+"["+a+"]"]=e.u(1):i["sub_layer_reserved_zero_bit"+_+"["+a+"]"]=e.u(1)),i["sub_layer_level_present_flag"+_+"["+a+"]"]&&(i["sub_layer_level_idc"+_+"["+a+"]"]=e.u(8))},J.prototype.hrd_parameters=function(e,_,t,r,a){var s=""==_?"":"["+_+"]";for(t&&(a["nal_hrd_parameters_present_flag"+s]=e.u(1),a["vcl_hrd_parameters_present_flag"+s]=e.u(1),(a["nal_hrd_parameters_present_flag"+s]||a["vcl_hrd_parameters_present_flag"+s])&&(a["sub_pic_hrd_params_present_flag"+s]=e.u(1),a["sub_pic_hrd_params_present_flag"+s]&&(a["tick_divisor_minus2"+s]=e.u(8),a["du_cpb_removal_delay_increment_length_minus1"+s]=e.u(5),a["sub_pic_cpb_params_in_pic_timing_sei_flag"+s]=e.u(1),a["dpb_output_delay_du_length_minus1"+s]=e.u(5)),a["bit_rate_scale"+s]=e.u(4),a["cpb_size_scale"+s]=e.u(4),a["sub_pic_hrd_params_present_flag"+s]&&(a["cpb_size_du_scale"+s]=e.u(4)),a["initial_cpb_removal_delay_length_minus1"+s]=e.u(5),a["au_cpb_removal_delay_length_minus1"+s]=e.u(5),a["dpb_output_delay_length_minus1"+s]=e.u(5))),i=0;i<=r;i++){if(a["fixed_pic_rate_general_flag"+s+"["+i+"]"]=e.u(1),a["fixed_pic_rate_general_flag"+s+"["+i+"]"]||(a["fixed_pic_rate_within_cvs_flag"+s+"["+i+"]"]=e.u(1)),a["fixed_pic_rate_within_cvs_flag"+s+"["+i+"]"]?a["elemental_duration_in_tc_minus1"+s+"["+i+"]"]=e.ue():a["low_delay_hrd_flag"+s+"["+i+"]"]=e.u(1),a["low_delay_hrd_flag"+s+"["+i+"]"]||(a["cpb_cnt_minus1"+s+"["+i+"]"]=e.ue()),a["nal_hrd_parameters_present_flag"+s])for(var n=0;n<=i;n++)a["nal_bit_rate_value_minus1"+s+"["+i+"]["+n+"]"]=e.ue(),a["nal_cpb_size_value_minus1"+s+"["+i+"]["+n+"]"]=e.ue(),a["nal_sub_pic_hrd_params_present_flag"+s]&&(a["nal_cpb_size_du_value_minus1"+s+"["+i+"]["+n+"]"]=e.ue(),a["nal_bit_rate_du_value_minus1"+s+"["+i+"]["+n+"]"]=e.ue()),a["nal_cbr_flag"+s+"["+i+"]["+n+"]"]=e.u(1);if(a["vcl_hrd_parameters_present_flag"+s])for(n=0;n<=i;n++)a["vlc_bit_rate_value_minus1"+s+"["+i+"]["+n+"]"]=e.ue(),a["vlc_cpb_size_value_minus1"+s+"["+i+"]["+n+"]"]=e.ue(),a["vlc_sub_pic_hrd_params_present_flag"+s]&&(a["vlc_cpb_size_du_value_minus1"+s+"["+i+"]["+n+"]"]=e.ue(),a["vlc_bit_rate_du_value_minus1"+s+"["+i+"]["+n+"]"]=e.ue()),a["vlc_cbr_flag"+s+"["+i+"]["+n+"]"]=e.u(1)}},J.prototype.rep_format=function(e,_,t){var r="["+_+"]";t["pic_width_vps_in_luma_samples"+r]=e.u(16),t["pic_height_vps_in_luma_samples"+r]=e.u(16),t["chroma_and_bit_depth_vps_present_flag"+r]=e.u(1),t["chroma_and_bit_depth_vps_present_flag"+r]&&(t["chroma_format_vps_idc"+r]=e.u(2),3==t["chroma_format_vps_idc"+r]&&(t["separate_colour_plane_vps_flag"+r]=e.u(1)),t["bit_depth_vps_luma_minus8"+r]=e.u(4),t["bit_depth_vps_chroma_minus8"+r]=e.u(4)),t["conformance_window_vps_flag"+r]=e.u(1),t["conformance_window_vps_flag"+r]&&(t["conf_win_vps_left_offset"+r]=e.ue(),t["conf_win_vps_right_offset"+r]=e.ue(),t["conf_win_vps_top_offset"+r]=e.ue(),t["conf_win_vps_bottom_offset"+r]=e.ue())},J.prototype.dpb_size=function(e,_,t){for(_=1;_<t["#NumOutputLayerSets"];_++){currLsIdx=t["#OlsIdxToLsIdx["+_+"]"],t["sub_layer_flag_info_present_flag["+_+"]"]=e.u(1);for(var r=0;r<=t["#MaxSubLayersInLayerSetMinus1["+currLsIdx+"]"];r++)if(0<r&&t["sub_layer_flag_info_present_flag["+_+"]"]&&(t["sub_layer_dpb_info_present_flag["+_+"]["+r+"]"]=e.u(1)),t["sub_layer_dpb_info_present_flag["+_+"]["+r+"]"]){for(k=0;k<t["#NumLayersInIdList["+currLsIdx+"]"];k++)t["#NecessaryLayerFlag["+_+"]["+k+"]"]&&(t.vps_base_layer_internal_flag||0!=t["#LayerSetLayerIdList["+currLsIdx+"]["+k+"]"])&&(t["max_vps_dec_pic_buffering_minus1["+_+"]["+k+"]["+r+"]"]=e.ue());t["max_vps_num_reorder_pics["+_+"]["+r+"]"]=e.ue(),t["max_vps_latency_increase_plus1["+_+"]["+r+"]"]=e.ue()}}},J.prototype.vps_vui_bsp_hrd_params=function(e,_){_.vps_num_add_hrd_params=e.ue();for(var t=_.vps_num_hrd_parameters;t<_.vps_num_hrd_parameters+_.vps_num_add_hrd_params;t++)0<t&&(_["cprms_add_present_flag["+t+"]"]=e.u(1)),_["num_sub_layer_hrd_minus1["+t+"]"]=e.ue(),this.hrd_parameters(e,t,_["cprms_add_present_flag["+t+"]"],_["num_sub_layer_hrd_minus1["+t+"]"],_);if(0<_.vps_num_hrd_parameters+_.vps_num_add_hrd_params)for(var r=1;r<_["#NumOutputLayerSets"];r++){_["num_signalled_partitioning_schemes["+r+"]"]=e.ue();for(var i=1;i<_["num_signalled_partitioning_schemes["+r+"]"]+1;i++){_["num_partitions_in_scheme_minus1["+r+"]["+i+"]"]=e.ue();for(var a=0;a<=_["num_partitions_in_scheme_minus1["+r+"]["+i+"]"];a++)for(var s=0;s<_["#NumLayersInIdList["+_["#OlsIdxToLsIdx["+r+"]"]+"]"];s++)_["layer_included_in_partition_flag["+r+"]["+i+"]["+a+"]["+s+"]"]=e.u(1)}for(t=0;t<_["num_signalled_partitioning_schemes["+r+"]"]+1;t++)for(var n=0;n<=_["#MaxSubLayersInLayerSetMinus1["+_["#OlsIdxToLsIdx["+r+"]"]+"]"];n++){_["num_bsp_schedules_minus1["+r+"]["+t+"]["+n+"]"]=e.ue();for(i=0;i<=_["num_bsp_schedules_minus1["+r+"]["+t+"]["+n+"]"];i++)for(a=0;a<=_["num_partitions_in_scheme_minus1["+r+"]["+t+"]"];a++)1<_.vps_num_hrd_parameters+_.vps_num_add_hrd_params&&(_["bsp_hrd_idx["+r+"]["+t+"]["+n+"]["+i+"]["+a+"]"]=e.u(this.cntbits(_.vps_num_hrd_parameters+_.vps_num_add_hrd_params))),_["bsp_sched_idx["+r+"]["+t+"]["+n+"]["+i+"]["+a+"]"]=e.ue()}}},J.prototype.vps_vui=function(e,_){if(_.cross_layer_pic_type_aligned_flag=e.u(1),_.cross_layer_pic_type_aligned_flag||(_.cross_layer_irap_aligned_flag=e.u(1)),_.cross_layer_irap_aligned_flag&&(_.all_layers_idr_aligned_flag=e.u(1)),_.bit_rate_present_vps_flag=e.u(1),_.pic_rate_present_vps_flag=e.u(1),_.bit_rate_present_vps_flag||_.pic_rate_present_vps_flag)for(var t=_.vps_base_layer_internal_flag?0:1;t<_["#NumLayerSets"];t++)for(var r=0;r<=_["#MaxSubLayersInLayerSetMinus1["+t+"]"];r++)_.bit_rate_present_vps_flag&&(_["bit_rate_present_flag["+t+"]["+r+"]"]=e.u(1)),_.pic_rate_present_vps_flag&&(_["pic_rate_present_flag["+t+"]["+r+"]"]=e.u(1)),_["bit_rate_present_flag["+t+"]["+r+"]"]&&(_["avg_bit_rate["+t+"]["+r+"]"]=e.u(16),_["max_bit_rate["+t+"]["+r+"]"]=e.u(16)),_["pic_rate_present_flag["+t+"]["+r+"]"]&&(_["constant_pic_rate_idc["+t+"]["+r+"]"]=e.u(2),_["avg_pic_rate["+t+"]["+r+"]"]=e.u(16));_.video_signal_info_idx_present_flag=e.u(1),_.video_signal_info_idx_present_flag&&(_.vps_num_video_signal_info_minus1=e.u(4));for(t=0;t<=_.vps_num_video_signal_info_minus1;t++)_["video_vps_format["+t+"]"]=e.u(3),_["video_full_range_vps_flag["+t+"]"]=e.u(1),_["colour_primaries_vps["+t+"]"]=e.u(8),_["transfer_characteristics_vps["+t+"]"]=e.u(8),_["matrix_coeffs_vps["+t+"]"]=e.u(8);if(_.video_signal_info_idx_present_flag&&0<_.vps_num_video_signal_info_minus1)for(t=_.vps_base_layer_internal_flag?0:1;t<=_.vps_max_layers_minus1;t++)_["vps_video_signal_info_idx["+t+"]"]=e.u(4);if(_.tiles_not_in_use_flag=e.u(1),!_.tiles_not_in_use_flag){for(t=_.vps_base_layer_internal_flag?0:1;t<=_.vps_max_layers_minus1;t++)_["tiles_in_use_flag["+t+"]"]=e.u(1),_["tiles_in_use_flag["+t+"]"]&&(_["loop_filter_not_across_tiles_flag["+t+"]"]=e.u(1));for(t=_.vps_base_layer_internal_flag?1:2;t<=_.vps_max_layers_minus1;t++)for(r=0;r<_["#NumDirectRefLayers["+_["layer_id_in_nuh["+t+"]"]+"]"];r++){var i=_["#LayerIdxInVps["+_["#IdDirectRefLayer["+_["layer_id_in_nuh["+t+"]"]]+"]["+r+"]"];_["tiles_in_use_flag["+t+"]"]&&_["tiles_in_use_flag["+i+"]"]&&(_["tile_boundaries_aligned_flag["+t+"]["+r+"]"]=e.u(1))}}if(_.wpp_not_in_use_flag=e.u(1),!_.wpp_not_in_use_flag)for(t=_.vps_base_layer_internal_flag?0:1;t<=_.vps_max_layers_minus1;t++)_["wpp_in_use_flag["+t+"]"]=e.u(1);if(_.single_layer_for_non_irap_flag=e.u(1),_.higher_layer_irap_skip_flag=e.u(1),_.ilp_restricted_ref_layers_flag=e.u(1),_.ilp_restricted_ref_layers_flag)for(t=1;t<=_.vps_max_layers_minus1;t++)for(r=0;r<_["#NumDirectRefLayers["+_["layer_id_in_nuh["+t+"]"]+"]"];r++)(_.vps_base_layer_internal_flag||0<_["#IdDirectRefLayer["+_["layer_id_in_nuh["+t+"]"]+"]["+r+"]"])&&(_["min_spatial_segment_offset_plus1["+t+"]["+r+"]"]=e.ue(),0<_["min_spatial_segment_offset_plus1["+t+"]["+r+"]"]&&(_["ctu_based_offset_enabled_flag["+t+"]["+r+"]"]=e.u(1),_["ctu_based_offset_enabled_flag["+t+"]["+r+"]"]&&(_["min_horizontal_ctu_offset_plus1["+t+"]["+r+"]"]=e.ue())));_.vps_vui_bsp_hrd_present_flag=e.u(1),_.vps_vui_bsp_hrd_present_flag&&this.vps_vui_bsp_hrd_params(e,_);for(t=1;t<=_.vps_max_layers_minus1;t++)0==_["#NumDirectRefLayers["+_["layer_id_in_nuh["+t+"]"]+"]"]&&(_["base_layer_parameter_set_compatibility_flag["+t+"]"]=e.u(1))},J.prototype.vps_extension=function(e,_){0<_.vps_max_layers_minus1&&_.vps_base_layer_internal_flag&&this.profile_tier_level(e,1,0,_.vps_max_sub_layers_minus1,_),_.splitting_flag=e.u(1);for(var t=0,r=0;r<16;r++)_["scalability_mask_flag["+r+"]"]=e.u(1),t+=_["scalability_mask_flag["+r+"]"];for(var i=0;i<t-_.splitting_flag;i++)_["dimension_id_len_minus1["+i+"]"]=e.u(3);_.vps_nuh_layer_id_present_flag=e.u(1);for(r=1;r<=_.vps_max_layers_minus1;r++)if(_.vps_nuh_layer_id_present_flag&&(_["layer_id_in_nuh["+r+"]"]=e.u(6)),!_.splitting_flag)for(i=0;i<t;i++)_["dimension_id["+r+"]["+i+"]"]=e.u(_["dimension_id_len_minus1["+i+"]"]+1);_["#NumViews"]=1;for(r=0;r<=_.vps_max_layers_minus1;r++){var a=_["layer_id_in_nuh["+r+"]"],s=0;for(i=0;s<16;s++)_["scalability_mask_flag["+s+"]"]?(_["#ScalabilityId["+r+"]["+s+"]"]=_["dimension_id["+r+"]["+i+"]"],i++):_["#ScalabilityId["+r+"]["+s+"]"]=0;if(_["#DepthLayerFlag["+a+"]"]=_["#ScalabilityId["+r+"][0]"],_["#ViewOrderIdx["+a+"]"]=_["#ScalabilityId["+r+"][1]"],_["#DependencyId["+a+"]"]=_["#ScalabilityId["+r+"][2]"],_["#AuxId["+a+"]"]=_["#ScalabilityId["+r+"][3]"],0<r){var n=1;for(i=0;i<r;i++)_["#ViewOrderIdx["+a+"]"]==_["#ViewOrderIdx["+_["layer_id_in_nuh["+i+"]"]+"]"]&&(n=0);_["#NumViews"]+=n}}if(_.view_id_len=e.u(4),0<_.view_id_len)for(r=0;r<NumViews;r++)_["view_id_val["+r+"]"]=e.u(_.view_id_len);var l=new Uint8Array(63);for(r=1;r<=_.vps_max_layers_minus1;r++)l[r]=0;for(i=0;i<r;i++)_["direct_dependency_flag["+r+"]["+i+"]"]=e.u(1);for(l[i]+=_["direct_dependency_flag["+r+"]["+i+"]"],r=0;r<=_.vps_max_layers_minus1;r++)for(i=0;i<=_.vps_max_layers_minus1;i++)for(_["#DependencyFlag["+r+"]["+i+"]"]=_["direct_dependency_flag["+r+"]["+i+"]"],c=0;c<r;c++)_["direct_dependency_flag["+r+"]["+c+"]"]&&_["#DependencyFlag["+c+"]["+i+"]"]&&(_["#DependencyFlag["+r+"]["+i+"]"]=1);for(r=0;r<=_.vps_max_layers_minus1;r++){var o=_["layer_id_in_nuh["+r+"]"],u=0,f=0,p=0;for(i=0;i<=_.vps_max_layers_minus1;i++){var d=_["layer_id_in_nuh["+i+"]"];_["direct_dependency_flag["+r+"]["+i+"]"]&&(_["#IdDirectRefLayer["+o+"]["+u+"]"]=d),u++,_["#DependencyFlag["+r+"]["+i+"]"]&&(_["#IdRefLayer["+o+"]["+f+"]"]=d),f++,_["#DependencyFlag["+i+"]["+r+"]"]&&(_["#IdPredictedLayerr["+o+"]["+p+"]"]=d),p++}_["#NumDirectRefLayers["+o+"]"]=u,_["#NumRefLayers["+o+"]"]=f,_["#NumPredictedLayers["+o+"]"]=p,_["#LayerIdxInVps["+o+"]"]=r}for(r=0;r<=63;r++)_["#layerIdInListFlag["+r+"]"]=0;var c=0;for(r=0;r<=_.vps_max_layers_minus1;r++){if(0==_["#NumDirectRefLayers["+(o=_["layer_id_in_nuh["+r+"]"])+"]"]){_["#TreePartitionLayerIdList["+c+"][0]"]=o;i=0;for(var m=1;i<_["#NumPredictedLayers["+o+"]"];i++){var h=_["#IdPredictedLayer["+o+"]["+i+"]"];_["#layerIdInListFlag["+h+"]"]||(_["#TreePartitionLayerIdList["+c+"]["+m+"]"]=h,m++,_["#layerIdInListFlag["+h+"]"]=1)}_["#NumLayersInTreePartition["+c+"]"]=m,c++}}_["#NumIndependentLayers"]=c,1<_["#NumIndependentLayers"]&&(_.num_add_layer_sets=e.ue()),_["#NumLayerSets"]=_.vps_num_layer_sets_minus1+1+(_.num_add_layer_sets||0);var g=0;for(r=0;r<(_.num_add_layer_sets||0);r++){for(i=1;i<_["#NumIndependentLayers"];i++)_["highest_layer_idx_plus1["+r+"]["+i+"]"]=e.u(this.cntbits(_["#NumLayersInTreePartition["+i+"]"]+1));for(var y=0,v=_.vps_num_layer_sets_minus1+1+r,b=1;b<_["#NumIndependentLayers"];b++)for(var x=0;x<_["highest_layer_idx_plus1["+r+"]["+b+"]"];x++)_["#LayerSetLayerIdList["+v+"]["+y+"]"]=_["#TreePartitionLayerIdList["+b+"]["+x+"]"],_["#LayerSetLayerIdList["+v+"]["+ ++y+"]"]>g&&(g=_["#LayerSetLayerIdList["+v+"]["+y+"]"]);_["#NumLayersInIdList["+v+"]"]=y}if(_.vps_sub_layers_max_minus1_present_flag=e.u(1),_.vps_sub_layers_max_minus1_present_flag)for(r=0;r<=_.vps_max_layers_minus1;r++)_["sub_layers_vps_max_minus1["+r+"]"]=e.u(3);if(_.max_tid_ref_present_flag=e.u(1),_.max_tid_ref_present_flag)for(r=0;r<_.vps_max_layers_minus1;r++)for(i=r+1;i<=_.vps_max_layers_minus1;i++)_["direct_dependency_flag["+i+"]["+r+"]"]&&(_["max_tid_il_ref_pics_plus1["+r+"]["+i+"]"]=e.u(3));_.default_ref_layers_active_flag=e.u(1),_.vps_num_profile_tier_level_minus1=e.ue();for(r=_.vps_base_layer_internal_flag?2:1;r<=_.vps_num_profile_tier_level_minus1;r++)_["vps_profile_present_flag["+r+"]"]=e.u(1),this.profile_tier_level(e,r,_["vps_profile_present_flag["+r+"]"],_.vps_max_sub_layers_minus1,_);1<_["#NumLayerSets"]&&(_.num_add_olss=e.ue(),_.default_output_layer_idc=e.u(2));for(r=0;r<_["#NumLayerSets"];r++){var w=0;for(c=0;c<NumLayersInIdList[r];c++)a=_["#LayerSetLayerIdList["+r+"]["+c+"]"],w=Math.max(maxSLMinus1,_["sub_layers_vps_max_minus1["+_["#LayerIdxInVps["+a+"]"]+"]"]);_["#MaxSubLayersInLayerSetMinus1["+r+"]"]=w}_["#NumOutputLayerSets"]=(_.num_add_olss||0)+_["#NumLayerSets"];for(r=1;r<_["#NumOutputLayerSets"];r++){2<_["#NumLayerSets"]&&r>=_["#NumLayerSets"]&&(_["layer_set_idx_for_ols_minus1["+r+"]"]=e.u(this.cntbits(_["#NumLayerSets"]-1)));var S=_["#OlsIdxToLsIdx["+r+"]"]=r<_["#NumLayerSets"]?r:(_["layer_set_idx_for_ols_minus1["+r+"]"]||0)+1;if(r>_.vps_num_layer_sets_minus1||2==(_.default_output_layer_idc||0))for(i=0;i<_["#NumLayersInIdList["+S+"]"];i++)_["#OutputLayerFlag["+r+"]["+i+"]"]=_["output_layer_flag["+r+"]["+i+"]"]=e.u(1);else for(i=0;i<_["#NumLayersInIdList["+S+"]"];i++){var L=_.default_output_layer_idc||0;(0==L||1==L&&_["#LayerSetLayerIdList["+S+"]["+i+"]"]==g)&&(_["#OutputLayerFlag["+r+"]["+i+"]"]=1)}for(i=_["#NumOutputLayersInOutputLayerSet["+r+"]"]=0;i<_["#NumLayersInIdList["+S+"]"];i++)_["#NumOutputLayersInOutputLayerSet["+r+"]"]+=_["#OutputLayerFlag["+r+"]["+i+"]"],_["#OutputLayerFlag["+r+"]["+i+"]"]&&(_["#OlsHighestOutputLayerId["+r+"]"]=_["#LayerSetLayerIdList["+S+"]["+i+"]"]);for(i=0;i<_["#NumLayersInIdList["+S+"]"];i++){_["#NecessaryLayerFlag["+r+"]["+i+"]"]=_["#OutputLayerFlag["+r+"]["+i+"]"];for(var R=_["#LayerSetLayerIdList["+i+"]["+q+"]"],q=0;q<i;q++){var I=_["#LayerSetLayerIdList["+i+"]["+q+"]"];_["#DependencyFlag["+_["#LayerIdxInVps["+R+"]"]+"]["+_["#LayerIdxInVps["+I+"]"]+"]"]&&(_["#NecessaryLayerFlag["+r+"]["+i+"]"]=1)}}for(i=0;i<_["#NumLayersInIdList["+S+"]"];i++)_["#NecessaryLayerFlag["+r+"]["+i+"]"]&&0<_.vps_num_profile_tier_level_minus1&&(_["profile_tier_level_idx["+r+"]["+i+"]"]=e.u(this.cntbits(_.vps_num_profile_tier_level_minus1+1)));1==_["#NumOutputLayersInOutputLayerSet["+r+"]"]&&0<_["#NumDirectRefLayers["+_["#OlsHighestOutputLayerId["+r+"]"]+"]"]&&(_["alt_output_layer_flag["+r+"]"]=e.u(1))}_.vps_num_rep_formats_minus1=e.ue();for(r=0;r<=_.vps_num_rep_formats_minus1;r++)this.rep_format(e,r,_);if(0<_.vps_num_rep_formats_minus1&&(_.rep_format_idx_present_flag=e.u(1)),_.rep_format_idx_present_flag){var A=this.cntbits(_.vps_num_rep_formats_minus1+1);for(r=_.vps_base_layer_internal_flag?1:0;r<=_.vps_max_layers_minus1;r++)_["vps_rep_format_idx["+r+"]"]=e.u(A)}_.max_one_active_ref_layer_flag=e.u(1),_.vps_poc_lsb_aligned_flag=e.u(1);for(r=1;r<=_.vps_max_layers_minus1;r++)0==_["#NumDirectRefLayers["+(_["layer_id_in_nuh["+r+"]"]||0)+"]"]&&(_["poc_lsb_not_present_flag["+r+"]"]=e.u(1));if(this.dpb_size(e,_),_.direct_dep_type_len_minus2=e.ue(),_.direct_dependency_all_layers_flag=e.u(1),_.direct_dependency_all_layers_flag)_.direct_dependency_all_layers_type=e.u(_.direct_dep_type_len_minus2+2);else for(r=vvps.ps_base_layer_internal_flag?1:2;r<=_.vps_max_layers_minus1;r++)for(i=_.vps_base_layer_internal_flag?0:1;i<r;i++)_["direct_dependency_flag["+r+"]["+i+"]"]&&(_["direct_dependency_type["+r+"]["+i+"]"]=e.u(_.direct_dep_type_len_minus2+2));_.vps_non_vui_extension_length=e.ue();for(r=1;r<=_.vps_non_vui_extension_length;r++)_.vps_non_vui_extension_data_byte=e.u(8);if(_.vps_vui_present_flag=e.u(1),_.vps_vui_present_flag){for(;!e.bytealign();)e.u(1);this.vps_vui(e,_)}},J.prototype.vps_3d_extension=function(e,_){_.cp_precision=e.ue();for(var t=1;t<_["#NumViews"];t++)if(i=_["#ViewOIdxList["+t+"]"],_["num_cp["+i+"]"]=e.u(6),0<_["num_cp["+i+"]"]){_["cp_in_slice_segment_header_flag["+i+"]"]=e.u(1);for(var r=0;r<_["num_cp["+i+"]"];r++)if(_["cp_ref_voi["+i+"]["+r+"]"]=e.ue(),!_["cp_in_slice_segment_header_flag["+i+"]"]){var a=_["cp_ref_voi["+i+"]["+r+"]"];_["vps_cp_scale["+i+"]["+a+"]"]=e.se(),_["vps_cp_off["+i+"]["+a+"]"]=e.se(),_["vps_cp_inv_scale_plus_scale["+i+"]["+a+"]"]=e.se(),_["vps_cp_inv_off_plus_off["+i+"]["+a+"]"]=e.se()}}},J.prototype.parse_vps=function(e,_){_.vps_video_parameter_set_id=e.u(4),_.vps_base_layer_internal_flag=e.u(1),_["vps_base_layer_available_flag "]=e.u(1),_.vps_max_layers_minus1=e.u(6),_.vps_max_sub_layers_minus1=e.u(3),_.vps_temporal_id_nesting_flag=e.u(1),_.vps_reserved_0xffff_16bits=e.u(16),this.profile_tier_level(e,"",1,_.vps_max_sub_layers_minus1,_),_.vps_sub_layer_ordering_info_present_flag=e.u(1);for(var t=_.vps_sub_layer_ordering_info_present_flag?0:_.vps_max_sub_layers_minus1;t<=_.vps_max_sub_layers_minus1;t++)_["vps_max_dec_pic_buffering_minus1["+t+"]"]=e.ue(),_["vps_max_num_reorder_pics["+t+"]"]=e.ue(),_["vps_max_latency_increase_plus1["+t+"]"]=e.ue();_.vps_max_layer_id=e.u(6),_.vps_num_layer_sets_minus1=e.ue();for(t=1;t<=_.vps_num_layer_sets_minus1;t++)for(var r=0;r<=_.vps_max_layer_id;r++)_["layer_id_included_flag["+t+"]["+r+"]"]=e.u(1);if(_.vps_timing_info_present_flag=e.u(1),_.vps_timing_info_present_flag){_.vps_num_units_in_tick=e.u(32),_.vps_time_scale=e.u(32),_.vps_poc_proportional_to_timing_flag=e.u(1),_.vps_poc_proportional_to_timing_flag&&(_.vps_num_ticks_poc_diff_one_minus1=e.ue()),_.vps_num_hrd_parameters=e.ue();for(t=0;t<_.vps_num_hrd_parameters;t++)_["hrd_layer_set_idx["+t+"]"]=e.ue(),0<t&&(_["cprms_present_flag["+t+"]"]=e.u(1)),this.hrd_parameters(e,t,0==t||_["cprms_present_flag["+t+"]"],_.vps_max_sub_layers_minus1,_)}if(_.vps_extension_flag=e.u(1),_.vps_extension_flag){for(;!e.bytealign();)e.u(1);if(this.vps_extension(e,_),_.vps_extension2_flag=e.u(1),_.vps_extension2_flag){if(_.vps_3d_extension_flag=e.u(1),_.vps_3d_extension_flag){for(;!e.bytealign();)e.u(1);this.vps_3d_extension(e,vui)}if(_.vps_extension3_flag=e.u(1),_.vps_extension3_flag)for(t=0;P(e);t++)_["vps_extension_data_flag["+t+"]"]=e.u(1)}}return _},J.prototype.short_term_ref_pic_set=function(e,_,t,r,i){var a=_==t?"":"["+_+"]";if(0<_&&(r["inter_ref_pic_set_prediction_flag"+a]=e.u(1)),r["inter_ref_pic_set_prediction_flag"+a]){_==t&&(r["delta_idx_minus1"+a]=e.ue()),r["delta_rps_sign"+a]=e.u(1),r["abs_delta_rps_minus1"+a]=e.ue();for(var s=_-1-(_==t?r["delta_idx_minus1"+a]:0),n=(r["delta_rps_sign"+a],r["abs_delta_rps_minus1"+a],i["#NumDeltaPocs["+s+"]"]),l=0,o=0;o<=n;o++)r["used_by_curr_pic_flag"+a+"["+o+"]"]=e.u(1),0==r["used_by_curr_pic_flag"+a+"["+o+"]"]&&(r["use_delta_flag"+a+"["+o+"]"]=e.u(1)),(r["used_by_curr_pic_flag"+a+"["+o+"]"]||r["use_delta_flag"+a+"["+o+"]"])&&l++;r["#NumDeltaPocs"+a]=l}else{r["num_negative_pics"+a]=e.ue(),r["num_positive_pics"+a]=e.ue();for(o=0;o<r["num_negative_pics"+a];o++)r["delta_poc_s0_minus1"+a+"["+o+"]"]=e.ue(),r["used_by_curr_pic_s0_flag"+a+"["+o+"]"]=e.u(1);for(o=0;o<r["num_positive_pics"+a];o++)r["delta_poc_s1_minus1"+a+"["+o+"]"]=e.ue(),r["used_by_curr_pic_s1_flag"+a+"["+o+"]"]=e.u(1);r["#NumDeltaPocs"+a]=r["num_negative_pics"+a]+r["num_positive_pics"+a]}},J.prototype.scaling_list_data=function(e,_){for(var t=0;t<4;t++)for(var r=0;r<(3==t?2:6);r++)if(_["scaling_list_pred_mode_flag["+t+"]["+r+"]"]=e.u(1),_["scaling_list_pred_mode_flag["+t+"]["+r+"]"]){var i=8,a=Math.min(64,1<<4+(t<<1));if(1<t)i=e.se()+8;for(var s=new Array(a),n=0;n<a;n++){i=(i+e.se()+256)%256,s[n]=i}_["scaling_list_pred_mode_flag["+t+"]["+r+"]"]=s}else _["scaling_list_pred_matrix_id_delta["+t+"]["+r+"]"]=e.ue()},J.prototype.parse_sps=function(e,_){_.sps_video_parameter_set_id=e.u(4),_.sps_max_sub_layers_minus1=e.u(3),_.sps_temporal_id_nesting_flag=e.u(1),this.profile_tier_level(e,"",1,_.sps_max_sub_layers_minus1,_),_.sps_seq_parameter_set_id=e.ue(),_.chroma_format_idc=e.ue(),3==_.chroma_format_idc&&(_.separate_colour_plane_flag=e.u(1)),_.pic_width_in_luma_samples=e.ue(),_.pic_height_in_luma_samples=e.ue(),_.conformance_window_flag=e.u(1),_.conformance_window_flag&&(_.conf_win_left_offset=e.ue(),_.conf_win_right_offset=e.ue(),_.conf_win_top_offset=e.ue(),_.conf_win_bottom_offset=e.ue()),_.bit_depth_luma_minus8=e.ue(),_.bit_depth_chroma_minus8=e.ue(),_.log2_max_pic_order_cnt_lsb_minus4=e.ue(),_.sps_sub_layer_ordering_info_present_flag=e.u(1);for(var t=_.sps_sub_layer_ordering_info_present_flag?0:_.sps_max_sub_layers_minus1;t<=_.sps_max_sub_layers_minus1;t++)_["sps_max_dec_pic_buffering_minus1["+t+"]"]=e.ue(),_["sps_max_num_reorder_pics["+t+"]"]=e.ue(),_["sps_max_latency_increase_plus1["+t+"]"]=e.ue();_.log2_min_luma_coding_block_size_minus3=e.ue(),_.log2_diff_max_min_luma_coding_block_size=e.ue(),_.log2_min_transform_block_size_minus2=e.ue(),_.log2_diff_max_min_transform_block_size=e.ue(),_.max_transform_hierarchy_depth_inter=e.ue(),_.max_transform_hierarchy_depth_intra=e.ue(),_.scaling_list_enabled_flag=e.u(1),_.scaling_list_enabled_flag&&(_.sps_scaling_list_data_present_flag=e.u(1),_.sps_scaling_list_data_present_flag&&this.scaling_list_data(e,_)),_.amp_enabled_flag=e.u(1),_.sample_adaptive_offset_enabled_flag=e.u(1),_.pcm_enabled_flag=e.u(1),_.pcm_enabled_flag&&(_.pcm_sample_bit_depth_luma_minus1=e.u(4),_.pcm_sample_bit_depth_chroma_minus1=e.u(4),_.log2_min_pcm_luma_coding_block_size_minus3=e.ue(),_.log2_diff_max_min_pcm_luma_coding_block_size=e.ue(),_.pcm_loop_filter_disabled_flag=e.u(1)),_.num_short_term_ref_pic_sets=e.ue();for(t=0;t<_.num_short_term_ref_pic_sets;t++)this.short_term_ref_pic_set(e,t,_.num_short_term_ref_pic_sets,_,_);if(_.long_term_ref_pics_present_flag=e.u(1),_.long_term_ref_pics_present_flag){_.num_long_term_ref_pics_sps=e.ue();for(t=0;t<_.num_long_term_ref_pics_sps;t++)_["lt_ref_pic_poc_lsb_sps["+t+"]"]=e.u(_.log2_max_pic_order_cnt_lsb_minus4+4),_["used_by_curr_pic_lt_sps_flag["+t+"]"]=e.u(1)}if(_.sps_temporal_mvp_enabled_flag=e.u(1),_.strong_intra_smoothing_enabled_flag=e.u(1),_.vui_parameters_present_flag=e.u(1),_.vui_parameters_present_flag&&(_.aspect_ratio_info_present_flag=e.u(1),_.aspect_ratio_info_present_flag&&(_.aspect_ratio_idc=e.u(8),255==_.aspect_ratio_idc&&(_.sar_width=e.u(16),_.sar_height=e.u(16))),_.overscan_info_present_flag=e.u(1),_.overscan_info_present_flag&&(_.overscan_appropriate_flag=e.u(1)),_.video_signal_type_present_flag=e.u(1),_.video_signal_type_present_flag&&(_.video_format=e.u(3),_.video_full_range_flag=e.u(1),_.colour_description_present_flag=e.u(1),_.colour_description_present_flag&&(_.colour_primaries=e.u(8),_.transfer_characteristics=e.u(8),_.matrix_coeffs=e.u(8))),_.chroma_loc_info_present_flag=e.u(1),_.chroma_loc_info_present_flag&&(_.chroma_sample_loc_type_top_field=e.ue(),_.chroma_sample_loc_type_bottom_field=e.ue()),_.neutral_chroma_indication_flag=e.u(1),_.field_seq_flag=e.u(1),_.frame_field_info_present_flag=e.u(1),_.default_display_window_flag=e.u(1),_.default_display_window_flag&&(_.def_disp_win_left_offset=e.ue(),_.def_disp_win_right_offset=e.ue(),_.def_disp_win_top_offset=e.ue(),_.def_disp_win_bottom_offset=e.ue()),_.vui_timing_info_present_flag=e.u(1),_.vui_timing_info_present_flag&&(_.vui_num_units_in_tick=e.u(32),_.vui_time_scale=e.u(32),_.vui_poc_proportional_to_timing_flag=e.u(1),_.vui_poc_proportional_to_timing_flag&&(_.vui_num_ticks_poc_diff_one_minus1=e.ue()),_.vui_hrd_parameters_present_flag=e.u(1),_.vui_hrd_parameters_present_flag&&this.hrd_parameters(e,"",1,_.sps_max_sub_layers_minus1,_)),_.bitstream_restriction_flag=e.u(1),_.bitstream_restriction_flag&&(_.tiles_fixed_structure_flag=e.u(1),_.motion_vectors_over_pic_boundaries_flag=e.u(1),_.restricted_ref_pic_lists_flag=e.u(1),_.min_spatial_segmentation_idc=e.ue(),_.max_bytes_per_pic_denom=e.ue(),_.max_bits_per_min_cu_denom=e.ue(),_.log2_max_mv_length_horizontal=e.ue(),_.log2_max_mv_length_vertical=e.ue())),_.sps_extension_flag=e.u(1),_.sps_extension_flag&&(_.sps_range_extension_flag=e.u(1),_.sps_multilayer_extension_flag=e.u(1),_.sps_3d_extension_flag=e.u(1),_.sps_extension_5bits=e.u(5)),_.sps_range_extension_flag&&(_.transform_skip_rotation_enabled_flag=e.u(1),_.transform_skip_context_enabled_flag=e.u(1),_.implicit_rdpcm_enabled_flag=e.u(1),_.explicit_rdpcm_enabled_flag=e.u(1),_.extended_precision_processing_flag=e.u(1),_.intra_smoothing_disabled_flag=e.u(1),_.high_precision_offsets_enabled_flag=e.u(1),_.persistent_rice_adaptation_enabled_flag=e.u(1),_.cabac_bypass_alignment_enabled_flag=e.u(1)),_.sps_multilayer_extension_flag&&(_.inter_view_mv_vert_constraint_flag=e.u(1)),_.sps_3d_extension_flag)for(var r=0;r<=1;r++)_["iv_di_mc_enabled_flag["+r+"]"]=e.u(1),_["iv_mv_scal_enabled_flag["+r+"]"]=e.u(1),0==r?(_.log2_ivmc_sub_pb_size_minus3=e.ue(),_.iv_res_pred_enabled_flag=e.u(1),_.depth_ref_enabled_flag=e.u(1),_.vsp_mc_enabled_flag=e.u(1),_.dbbp_enabled_flag=e.u(1)):(_.tex_mc_enabled_flag=e.u(1),_.log2_texmc_sub_pb_size_minus3=e.ue(),_.intra_contour_enabled_flag=e.u(1),_.intra_dc_only_wedge_enabled_flag=e.u(1),_.cqt_cu_part_pred_enabled_flag=e.u(1),_.inter_dc_only_enabled_flag=e.u(1),_.skip_intra_enabled_flag=e.u(1));if(_.sps_extension_5bits)for(t=0;P(e);t++)_["sps_extension_5bits["+t+"]"]=e.u(1)},J.prototype.colour_mapping_octants=function(e,_,t,r,i,a){if(_<e.cm_octant_depth&&(e["split_octant_flag["+_+"]"]=bs.u(1)),e["split_octant_flag["+_+"]"])for(var s=0;s<2;s++)for(var n=0;n<2;n++)for(var l=0;l<2;l++)this.colour_mapping_octants(e,_+1,t+(PartNumY*s*a>>1),r+(n*a>>1),i+(l*a>>1),a>>1);else for(var o=0;o<1<<e.cm_y_part_num_log2;o++)for(var u=t+(o<<e.cm_octant_depth-_),f=0;f<4;f++){if(e["coded_res_flag["+u+"]["+r+"]["+i+"]["+f+"]"]=bs.u(1))for(var p=0;p<3;p++){var d=e["res_coeff_q["+u+"]["+r+"]["+i+"]["+f+"]["+p+"]"]=bs.ue(),c=e["res_coeff_r["+u+"]["+r+"]["+i+"]["+f+"]["+p+"]"]=bs.ue();(d||c)&&(e["res_coeff_s["+u+"]["+r+"]["+i+"]["+f+"]["+p+"]"]=bs.u(1))}}},J.prototype.delta_dlt=function(e,_){if(e["num_val_delta_dlt["+_+"]"]=bs.u(e.pps_bit_depth_for_depth_layers_minus8+8),0<e["num_val_delta_dlt["+_+"]"]){1<e["num_val_delta_dlt["+_+"]"]&&(e["max_diff["+_+"]"]=bs.u(e.pps_bit_depth_for_depth_layers_minus8+8));var t=e["max_diff["+_+"]"]-1;if(2<e["num_val_delta_dlt["+_+"]"]&&0<e["max_diff["+_+"]"]&&(t=e["min_diff_minus1["+_+"]"]=bs.u(this.cntbits(e["max_diff["+_+"]"]))),e["delta_dlt_val0["+_+"]"]=bs.u(e.pps_bit_depth_for_depth_layers_minus8+8),e["max_diff["+_+"]"]>t+1)for(var r=this.cntbits(e["max_diff["+_+"]"]-t+2),i=1;i<e["num_val_delta_dlt["+_+"]"];i++)e["delta_val_diff_minus_min["+i+"]"]=bs.u(r)}},J.prototype.parse_pps=function(e,_){if(_.pps_pic_parameter_set_id=e.ue(),_.pps_seq_parameter_set_id=e.ue(),_.dependent_slice_segments_enabled_flag=e.u(1),_.output_flag_present_flag=e.u(1),_.num_extra_slice_header_bits=e.u(3),_.sign_data_hiding_enabled_flag=e.u(1),_.cabac_init_present_flag=e.u(1),_.num_ref_idx_l0_default_active_minus1=e.ue(),_.num_ref_idx_l1_default_active_minus1=e.ue(),_.init_qp_minus26=e.se(),_.constrained_intra_pred_flag=e.u(1),_.transform_skip_enabled_flag=e.u(1),_.cu_qp_delta_enabled_flag=e.u(1),_.cu_qp_delta_enabled_flag&&(_.diff_cu_qp_delta_depth=e.ue()),_.pps_cb_qp_offset=e.se(),_.pps_cr_qp_offset=e.se(),_.pps_slice_chroma_qp_offsets_present_flag=e.u(1),_.weighted_pred_flag=e.u(1),_.weighted_bipred_flag=e.u(1),_.transquant_bypass_enabled_flag=e.u(1),_.tiles_enabled_flag=e.u(1),_.entropy_coding_sync_enabled_flag=e.u(1),_.tiles_enabled_flag){if(_.num_tile_columns_minus1=e.ue(),_.num_tile_rows_minus1=e.ue(),_.uniform_spacing_flag=e.u(1),0==_.uniform_spacing_flag){for(var t=0;t<_.num_tile_columns_minus1;t++)_["column_width_minus1["+t+"]"]=e.ue();for(t=0;t<_.num_tile_rows_minus1;t++)_["row_height_minus1["+t+"]"]=e.ue()}_.loop_filter_across_tiles_enabled_flag=e.u(1)}if(_.pps_loop_filter_across_slices_enabled_flag=e.u(1),_.deblocking_filter_control_present_flag=e.u(1),_.deblocking_filter_control_present_flag&&(_.deblocking_filter_override_enabled_flag=e.u(1),_.pps_deblocking_filter_disabled_flag=e.u(1),0==_.pps_deblocking_filter_disabled_flag&&(_.pps_beta_offset_div2=e.se(),_.pps_tc_offset_div2=e.se())),_.pps_scaling_list_data_present_flag=e.u(1),_.pps_scaling_list_data_present_flag&&this.scaling_list_data(e,_),_.lists_modification_present_flag=e.u(1),_.log2_parallel_merge_level_minus2=e.ue(),_.slice_segment_header_extension_present_flag=e.u(1),_.pps_extension_present_flag=e.u(1),_.pps_extension_present_flag&&(_.pps_range_extension_flag=e.u(1),_.pps_multilayer_extension_flag=e.u(1),_.pps_3d_extension_flag=e.u(1),_.pps_extension_5bits=e.u(5)),_.pps_range_extension_flag){if(_.transform_skip_enabled_flag&&(_.log2_max_transform_skip_block_size_minus2=e.ue()),_.cross_component_prediction_enabled_flag=e.u(1),_.chroma_qp_offset_list_enabled_flag=e.u(1),_.chroma_qp_offset_list_enabled_flag){_.diff_cu_chroma_qp_offset_depth=e.ue(),_.chroma_qp_offset_list_len_minus1=e.ue();for(t=0;t<=_.chroma_qp_offset_list_len_minus1;t++)_["cb_qp_offset_list["+t+"]"]=e.se(),_["cr_qp_offset_list["+t+"]"]=e.se()}_.log2_sao_offset_scale_luma=e.ue(),_.log2_sao_offset_scale_chroma=e.ue()}if(_.pps_multilayer_extension_flag){_.poc_reset_info_present_flag=e.u(1),_.pps_infer_scaling_list_flag=e.u(1),_.pps_infer_scaling_list_flag&&(_.pps_scaling_list_ref_layer_id=e.u(6)),_.num_ref_loc_offsets=e.ue();for(t=0;t<_.num_ref_loc_offsets;t++)_["ref_loc_offset_layer_id["+t+"]"]=e.u(6),_["scaled_ref_layer_offset_present_flag["+t+"]"]=e.u(1),_["scaled_ref_layer_offset_present_flag["+t+"]"]&&(_["scaled_ref_layer_left_offset[ ref_loc_offset_layer_id["+t+"]]"]=e.se(),_["scaled_ref_layer_top_offset[ ref_loc_offset_layer_id["+t+"]]"]=e.se(),_["scaled_ref_layer_right_offset[ ref_loc_offset_layer_id["+t+"]]"]=e.se(),_["scaled_ref_layer_bottom_offset[ ref_loc_offset_layer_id["+t+"]]"]=e.se()),_["ref_region_offset_present_flag["+t+"]"]=e.u(1),_["ref_region_offset_present_flag["+t+"]"]&&(_["ref_region_left_offset[ ref_loc_offset_layer_id["+t+"]]"]=e.se(),_["ref_region_top_offset[ ref_loc_offset_layer_id["+t+"]]"]=e.se(),_["ref_region_right_offset[ ref_loc_offset_layer_id["+t+"]]"]=e.se(),_["ref_region_bottom_offset[ ref_loc_offset_layer_id["+t+"]]"]=e.se()),_["resample_phase_set_present_flag["+t+"]"]=e.u(1),_["resample_phase_set_present_flag["+t+"]"]&&(_["phase_hor_luma[ ref_loc_offset_layer_id["+t+"]]"]=e.ue(),_["phase_ver_luma[ ref_loc_offset_layer_id["+t+"]]"]=e.ue(),_["phase_hor_chroma_plus8[ ref_loc_offset_layer_id["+t+"]]"]=e.ue(),_["phase_ver_chroma_plus8[ ref_loc_offset_layer_id["+t+"]]"]=e.ue());if(_.colour_mapping_enabled_flag=e.u(1),_.colour_mapping_enabled_flag){_.num_cm_ref_layers_minus1=e.ue();for(t=0;t<=_.num_cm_ref_layers_minus1;t++)_["cm_ref_layer_id["+t+"]"]=e.u(6);_.cm_octant_depth=e.u(2),_.cm_y_part_num_log2=e.u(2),_.luma_bit_depth_cm_input_minus8=e.ue(),_.chroma_bit_depth_cm_input_minus8=e.ue(),_.luma_bit_depth_cm_output_minus8=e.ue(),_.chroma_bit_depth_cm_output_minus8=e.ue(),_.cm_res_quant_bits=e.u(2),_.cm_delta_flc_bits_minus1=e.u(2),1==_.cm_octant_depth&&(_.cm_adapt_threshold_u_delta=e.se(),_.cm_adapt_threshold_v_delta=e.se()),this.colour_mapping_octants(_,0,0,0,0,1<<_.cm_octant_depth)}}if(_.pps_3d_extension_flag&&(_.dlts_present_flag=e.u(1),_.dlts_present_flag)){_.pps_depth_layers_minus1=e.u(6),_.pps_bit_depth_for_depth_layers_minus8=e.u(4);for(t=0;t<=_.pps_bit_depth_for_depth_layers_minus8;t++)if(_["dlt_flag["+t+"]"]=e.u(1),_["dlt_flag["+t+"]"])if(_["dlt_pred_flag["+t+"]"]=e.u(1),_["dlt_pred_flag["+t+"]"]||(_["dlt_val_flags_present_flag["+t+"]"]=e.u(1)),_["dlt_val_flags_present_flag["+t+"]"])for(var r=0;r<=(1<<_.pps_bit_depth_for_depth_layers_minus8+8)-1;r++)_["dlt_value_flag["+t+"]["+r+"]"]=e.u(1);else this.delta_dlt(_,t)}if(_.pps_extension_5bits)for(t=0;P(e);t++)_["pps_extension_data_flag["+t+"]"]=e.u(1)},J.prototype.slice_segment_header=function(e,_){if(_.first_slice_segment_in_pic_flag=e.u(1),16<=_.nal_unit_type&&_.nal_unit_type<=23&&(_.no_output_of_prior_pics_flag=e.u(1)),_.slice_pic_parameter_set_id=e.ue(),this.pps=this.find_nalu([34],"pps_pic_parameter_set_id",_.slice_pic_parameter_set_id),null==this.pps)return _;if(this.sps=this.find_nalu([33],"sps_seq_parameter_set_id",this.pps.pps_seq_parameter_set_id),0==_.first_slice_segment_in_pic_flag){this.pps.dependent_slice_segments_enabled_flag&&(_.dependent_slice_segment_flag=e.u(1));for(var t=1<<this.sps.log2_min_luma_coding_block_size_minus3+3+this.sps.log2_diff_max_min_luma_coding_block_size,r=Math.floor((this.sps.pic_width_in_luma_samples+t-1)/t)*Math.floor((this.sps.pic_height_in_luma_samples+t-1)/t),i=0;1<<i<r;)i++;_.slice_segment_address=e.u(i)}if(!_.dependent_slice_segment_flag){for(var a=0;a<this.pps.num_extra_slice_header_bits;a++)_["slice_reserved_flag["+a+"]"]=e.u(1);if(_.slice_type=e.ue(),this.pps.output_flag_present_flag&&(_.pic_output_flag=e.u(1)),null==this.sps)return _;this.sps.separate_colour_plane_flag&&(_.colour_plane_id=e.u(2));var s=0;if(19!=_.nal_unit_type&&20!=_.nal_unit_type){if(_.slice_pic_order_cnt_lsb=e.u(this.sps.log2_max_pic_order_cnt_lsb_minus4+4),_.short_term_ref_pic_set_sps_flag=e.u(1),0==_.short_term_ref_pic_set_sps_flag?(this.short_term_ref_pic_set(e,this.sps.num_short_term_ref_pic_sets,this.sps.num_short_term_ref_pic_sets,_,this.sps),s=_["#NumDeltaPocs"]):1<this.sps.num_short_term_ref_pic_sets&&(_.short_term_ref_pic_set_idx=e.u(M(this.sps.num_short_term_ref_pic_sets)),s=this.sps["#NumDeltaPocs["+_.short_term_ref_pic_set_idx+"]"]),this.sps.long_term_ref_pics_present_flag){var n=0;0<this.sps.num_long_term_ref_pics_sps&&(_.num_long_term_sps=n=e.ue()),_.num_long_term_pics=e.ue();var l=M(this.sps.num_long_term_ref_pics_sps);for(a=0;a<n+_.num_long_term_pics;a++)a<n?1<this.sps.num_long_term_ref_pics_sps&&(_["lt_idx_sps["+a+"]"]=e.u(l),s+=this.sps["used_by_curr_pic_lt_sps_flag["+_["lt_idx_sps["+a+"]"]+"]"]):(_["poc_lsb_lt["+a+"]"]=e.u(this.sps.log2_max_pic_order_cnt_lsb_minus4+4),_["used_by_curr_pic_lt_flag["+a+"]"]=e.u(1),s+=_["used_by_curr_pic_lt_flag["+a+"]"]),_["delta_poc_msb_present_flag["+a+"]"]=e.u(1),_["delta_poc_msb_present_flag["+a+"]"]&&(_["delta_poc_msb_cycle_lt["+a+"]"]=e.ue())}this.sps.sps_temporal_mvp_enabled_flag&&(_.slice_temporal_mvp_enabled_flag=e.u(1))}if(this.sps.sample_adaptive_offset_enabled_flag&&(_.slice_sao_luma_flag=e.u(1),0<this.sps.chroma_format_idc&&(_.slice_sao_chroma_flag=e.u(1))),1==_.slice_type||0==_.slice_type){_.num_ref_idx_active_override_flag=e.u(1);var o=this.pps.num_ref_idx_l0_default_active_minus1,u=this.pps.num_ref_idx_l1_default_active_minus1;if(_.num_ref_idx_active_override_flag&&(_.num_ref_idx_l0_active_minus1=o=e.ue(),0==_.slice_type&&(_.num_ref_idx_l1_active_minus1=u=e.ue())),this.pps.lists_modification_present_flag&&1<s){l=M(s);if(_.ref_pic_list_modification_flag_l0=e.u(1),_.ref_pic_list_modification_flag_l0)for(a=0;a<=o;a++)_["list_entry_l0["+a+"]"]=e.u(l);if(0==_.slice_type&&(_.ref_pic_list_modification_flag_l1=e.u(1),_.ref_pic_list_modification_flag_l1))for(a=0;a<=u;a++)_["list_entry_l1["+a+"]"]=e.u(l)}if(0==_.slice_type&&(_.mvd_l1_zero_flag=e.u(1)),this.pps.cabac_init_present_flag&&(_.cabac_init_flag=e.u(1)),_.slice_temporal_mvp_enabled_flag){var f=1;0==_.slice_type&&(_.collocated_from_l0_flag=f=e.u(1)),(f&&0<o||0==f&&0<u)&&(_.collocated_ref_idx=e.ue())}if(this.pps.weighted_pred_flag&&1==_.slice_type||this.pps.weighted_bipred_flag&&0==_.slice_type){_.luma_log2_weight_denom=e.ue(),"chroma_format_idc"in this.sps&&0!=this.sps.chroma_format_idc&&(_.delta_chroma_log2_weight_denom=e.se());for(a=0;a<=o;a++)_["luma_weight_l0_flag["+a+"]"]=e.u(1);if(0!=this.sps.chroma_format_idc)for(a=0;a<=o;a++)_["chroma_weight_l0_flag["+a+"]"]=e.u(1);for(a=0;a<=o;a++)if(_["luma_weight_l0_flag["+a+"]"]&&(_["delta_luma_weight_l0["+a+"]"]=e.se(),_["luma_offset_l0["+a+"]"]=e.se()),_["chroma_weight_l0_flag["+a+"]"])for(var p=0;p<2;p++)_["delta_chroma_weight_l0["+a+"]["+p+"]"]=e.se(),_["delta_chroma_offset_l0["+a+"]["+p+"]"]=e.se();if(0==_.slice_type){for(a=0;a<=u;a++)_["luma_weight_l1_flag["+a+"]"]=e.u(1);if(0!=this.sps.chroma_format_idc)for(a=0;a<=u;a++)_["chroma_weight_l1_flag["+a+"]"]=e.u(1);for(a=0;a<=u;a++)if(_["luma_weight_l1_flag["+a+"]"]&&(_["delta_luma_weight_l1["+a+"]"]=e.se(),_["luma_offset_l1["+a+"]"]=e.se()),_["chroma_weight_l1_flag["+a+"]"])for(p=0;p<2;p++)_["delta_chroma_weight_l1["+a+"]["+p+"]"]=e.se(),_["delta_chroma_offset_l1["+a+"]["+p+"]"]=e.se()}}_.five_minus_max_num_merge_cand=e.ue()}_.slice_qp_delta=e.se(),this.pps.pps_slice_chroma_qp_offsets_present_flag&&(_.slice_cb_qp_offset=e.se(),_.slice_cr_qp_offset=e.se()),this.pps.deblocking_filter_override_enabled_flag&&(_.deblocking_filter_override_flag=e.u(1)),_.deblocking_filter_override_flag&&(_.slice_deblocking_filter_disabled_flag=e.u(1),0==_.slice_deblocking_filter_disabled_flag&&(_.slice_beta_offset_div2=e.se(),_.slice_tc_offset_div2=e.se())),this.pps.pps_loop_filter_across_slices_enabled_flag&&(_.slice_sao_luma_flag||_.slice_sao_chroma_flag||0==(_.slice_deblocking_filter_disabled_flag||0))&&(_.slice_loop_filter_across_slices_enabled_flag=e.u(1))}if((this.pps.tiles_enabled_flag||this.pps.entropy_coding_sync_enabled_flag)&&(_.num_entry_point_offsets=e.ue(),0<_.num_entry_point_offsets)){_.offset_len_minus1=e.ue();for(a=0;a<_.num_entry_point_offsets;a++)_["entry_point_offset_minus1["+a+"]"]=e.u(_.offset_len_minus1+1)}if(this.pps.slice_segment_header_extension_present_flag){_.slice_segment_header_extension_length=e.ue();for(a=0;a<_.slice_segment_header_extension_length;a++)_["slice_segment_header_extension_data_byte["+a+"]"]=e.u(8)}},J.prototype.parse_sei=function(e){return{}};function $(r){s(this,$),this.h264Parser=function(e){return"ivf"==e?new Q:0<=["264","h264","avc"].indexOf(e)?new Y("H264"):0<=["265","h265","hevc","bin"].indexOf(e)?new Y("H265"):null}("h264");var i=null,a=null;r.on("videoData",function(e){var _=S(e);switch(_(4),31&_(1)[0]){case 1:case 5:var t=L(i,a,e);r.emit("videoFrame",t);break;case 7:i=e;break;case 8:a=e}})}function ee(i,e){i.emit("streamStart"),fetch(e,{headers:i.options.headers}).then(function(e){var _=e.body.getReader();i.on("destroy",function(){_.cancel()}),i.on("streamCancel",function(){_.cancel(),i.debug.log("stream-cancel")}),function r(){_.read().then(function(e){var _=e.done,t=e.value;_?i.emit("streamEnd"):(i.emit("streaming",new Uint8Array(t)),r())}).catch(function(e){throw e})}()})}function _e(e,_){e.emit("streamStart");var t=e.events.proxy,r=e.options.headers,i=new XMLHttpRequest;i.open("GET",_,!0),i.responseType="moz-chunked-arraybuffer",Object.keys(r).forEach(function(e){i.setRequestHeader(e,r[e])}),t(i,"readystatechange",function(){e.emit("readystatechange",i)}),t(i,"progress",function(){e.emit("streaming",new Uint8Array(i.response))}),t(i,"loadend",function(){e.emit("streamEnd")}),t(i,"error",function(e){throw e}),e.on("destroy",function(){i.abort()}),e.on("streamCancel",function(){i.abort(),e.debug.log("stream-cancel")}),i.send()}function te(_,e){_.emit("streamStart");var t=_.events.proxy,r=_.options.headers,i=new TextEncoder,a=new XMLHttpRequest;a.open("GET",e,!0),a.responseType="text",Object.keys(r).forEach(function(e){a.setRequestHeader(e,r[e])});var s=0;t(a,"readystatechange",function(){_.emit("readystatechange",a)}),t(a,"progress",function(){var e=a.responseText.substr(s);s=a.responseText.length,_.emit("streaming",i.encode(e,{stream:!0}))}),t(a,"loadend",function(){_.emit("streaming",i.encode("",{stream:!1})),_.emit("streamEnd")}),t(a,"error",function(e){throw e}),_.on("destroy",function(){a.abort()}),_.on("streamCancel",function(){a.abort(),_.debug.log("stream-cancel")}),a.send()}function re(t,e){t.emit("streamStart");var _=t.events.proxy,r=new FileReader;_(r,"load",function(e){var _=e.target.result;t.emit("streamEnd",new Uint8Array(_))}),r.readAsArrayBuffer(e)}var ie=function(){function t(e){s(this,t);var _=e.options.url;this.transportFactory=t.getStreamFactory(_),this.transportFactory(e,_)}return _(t,null,[{key:"getStreamFactory",value:function(e){if(e instanceof File)return re;if("undefined"!=typeof Response&&Object.prototype.hasOwnProperty.call(Response.prototype,"body")&&"function"==typeof Headers)return ee;return function(e){try{var _=new XMLHttpRequest;return _.responseType=e,_.responseType===e}catch(e){return!1}}("moz-chunked-arraybuffer")?_e:te}}]),t}(),ae=0,se=function(e){function t(e){var _;return s(this,t),(_=n(this,l(t).call(this))).options=Object.assign({},t.options,e),function(e){var _=e.options,t=_.container,r=_.url;w(t instanceof HTMLDivElement,"The 'container' option is not a 'HTMLDivElement'"),w(e.constructor.instances.every(function(e){return e.options.container!==t}),"Cannot mount multiple instances on the same div element, please destroy the instance first"),w("string"==typeof r||r instanceof File,"The 'url' option is not a string or file")}(a(_)),_.debug=new A(a(_)),_.player=new E(a(_)),_.decoder=new $(a(_)),_.demuxer=new O(a(_)),_.stream=new ie(a(_)),ae+=1,_.id=ae,t.instances.push(a(_)),_}return u(t,p),_(t,[{key:"destroy",value:function(){t.instances.splice(t.instances.indexOf(this),1),this.emit("destroy")}}],[{key:"options",get:function(){return{url:"",container:null,debug:!1,live:!1,controls:!0,width:400,height:300,workerPath:"openh264_decoder.js",h264Configuration:{}}}},{key:"version",get:function(){return"1.0.0"}},{key:"env",get:function(){return'"production"'}}]),t}();return Object.defineProperty(se,"instances",{value:[]}),se});
