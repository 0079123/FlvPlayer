/*!
 * FlvPlayer.js v1.0.6
 * Github: https://github.com/zhw2590582/FlvPlayer#readme
 * (c) 2017-2019 Harvey Zack
 * Released under the MIT License.
 */

!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e=e||self).FlvPlayer=t()}(this,function(){"use strict";var o=function(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e};var i=function(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter(function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),r.forEach(function(e){o(t,e,n[e])})}return t};var c=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")};function r(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var t=function(e,t,n){return t&&r(e.prototype,t),n&&r(e,n),e};function e(e,t){return e(t={exports:{}},t.exports),t.exports}var n=e(function(t){function n(e){return(n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function r(e){return"function"==typeof Symbol&&"symbol"===n(Symbol.iterator)?t.exports=r=function(e){return n(e)}:t.exports=r=function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":n(e)},r(e)}t.exports=r});var a=function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e};var u=function(e,t){return!t||"object"!==n(t)&&"function"!=typeof t?a(e):t},s=e(function(t){function n(e){return t.exports=n=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},n(e)}t.exports=n}),l=e(function(n){function r(e,t){return n.exports=r=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},r(e,t)}n.exports=r});var f=function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&l(e,t)},d=function(){function e(){c(this,e)}return t(e,[{key:"on",value:function(e,t,n){var r=this.e||(this.e={});return(r[e]||(r[e]=[])).push({fn:t,ctx:n}),this}},{key:"once",value:function(r,o,i){var a=this;function u(){a.off(r,u);for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];o.apply(i,t)}return u._=o,this.on(r,u,i)}},{key:"emit",value:function(e){for(var t=((this.e||(this.e={}))[e]||[]).slice(),n=arguments.length,r=new Array(1<n?n-1:0),o=1;o<n;o++)r[o-1]=arguments[o];for(var i=0;i<t.length;i+=1)t[i].fn.apply(t[i].ctx,r);return this}},{key:"off",value:function(e,t){var n=this.e||(this.e={}),r=n[e],o=[];if(r&&t)for(var i=0,a=r.length;i<a;i+=1)r[i].fn!==t&&r[i].fn._!==t&&o.push(r[i]);return o.length?n[e]=o:delete n[e],this}}]),e}();var p=function(e){return-1!==Function.toString.call(e).indexOf("[native code]")},y=e(function(r){function o(e,t,n){return!function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}()?r.exports=o=function(e,t,n){var r=[null];r.push.apply(r,t);var o=new(Function.bind.apply(e,r));return n&&l(o,n.prototype),o}:r.exports=o=Reflect.construct,o.apply(null,arguments)}r.exports=o}),m=function(e){function r(e,t){var n;return c(this,r),n=u(this,s(r).call(this,e)),"function"==typeof Error.captureStackTrace&&Error.captureStackTrace(a(n),t||n.constructor),n.name="FlvPlayerError",n}return f(r,e),r}(e(function(t){function r(e){var n="function"==typeof Map?new Map:void 0;return t.exports=r=function(e){if(null===e||!p(e))return e;if("function"!=typeof e)throw new TypeError("Super expression must either be null or a function");if(void 0!==n){if(n.has(e))return n.get(e);n.set(e,t)}function t(){return y(e,arguments,s(this).constructor)}return t.prototype=Object.create(e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),l(t,e)},r(e)}t.exports=r})(Error));function h(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];var r=t[0].constructor;return t.reduce(function(e,t){var n=new r((0|e.byteLength)+(0|t.byteLength));return n.set(e,0),n.set(t,0|e.byteLength),n},new r)}function v(e){var t=Math.floor(e/3600),n=Math.floor((e-3600*t)/60),r=Math.floor(e-3600*t-60*n);return(0<t?[t,n,r]:[n,r]).map(function(e){return e<10?"0".concat(e):String(e)}).join(":")}function g(){return performance&&"function"==typeof performance.now?performance.now():Date.now()}function b(o,i){var a,u,c=!1;return function e(){for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];if(c)return a=n,void(u=this);c=!0,o.apply(this,n),setTimeout(function(){c=!1,a&&(e.apply(u,a),u=a=null)},i)}}function w(e,t,n){return Math.max(Math.min(e,Math.max(t,n)),Math.min(t,n))}function S(e,t,n){return e.style[t]=n,e}function x(e,t){var n=!(2<arguments.length&&void 0!==arguments[2])||arguments[2],r=window.getComputedStyle(e,null).getPropertyValue(t);return n?parseFloat(r):r}function O(e){c(this,O);var i=e.options.debug;this.log=function(e){if(i){for(var t,n=arguments.length,r=new Array(1<n?n-1:0),o=1;o<n;o++)r[o-1]=arguments[o];(t=console).log.apply(t,["FlvPlayer: [".concat(e,"]")].concat(r))}},this.warn=function(e){if(!e&&i){for(var t,n=arguments.length,r=new Array(1<n?n-1:0),o=1;o<n;o++)r[o-1]=arguments[o];(t=console).warn.apply(t,r)}},this.error=function(e,t){if(!e)throw new m(t)}}var P=function(){function e(){c(this,e),this.destroyEvents=[],this.proxy=this.proxy.bind(this)}return t(e,[{key:"proxy",value:function(t,e,n){var r=this,o=3<arguments.length&&void 0!==arguments[3]?arguments[3]:{};Array.isArray(e)?e.forEach(function(e){return r.proxy(t,e,n,o)}):(t.addEventListener(e,n,o),this.destroyEvents.push(function(){t.removeEventListener(e,n,o)}))}},{key:"destroy",value:function(){this.destroyEvents.forEach(function(e){return e()})}}]),e}(),A={play:'<svg xmlns="http://www.w3.org/2000/svg" height="22" width="22" viewBox="0 0 22 22">\n  <path d="M17.982 9.275L8.06 3.27A2.013 2.013 0 0 0 5 4.994v12.011a2.017 2.017 0 0 0 3.06 1.725l9.922-6.005a2.017 2.017 0 0 0 0-3.45z"></path>\n</svg>',pause:'<svg xmlns="http://www.w3.org/2000/svg" height="22" width="22" viewBox="0 0 22 22">\n    <path d="M7 3a2 2 0 0 0-2 2v12a2 2 0 1 0 4 0V5a2 2 0 0 0-2-2zM15 3a2 2 0 0 0-2 2v12a2 2 0 1 0 4 0V5a2 2 0 0 0-2-2z"></path>\n</svg>',volume:'<svg xmlns="http://www.w3.org/2000/svg" height="22" width="22" viewBox="0 0 22 22">\n    <path d="M10.188 4.65L6 8H5a2 2 0 0 0-2 2v2a2 2 0 0 0 2 2h1l4.188 3.35a.5.5 0 0 0 .812-.39V5.04a.498.498 0 0 0-.812-.39zM14.446 3.778a1 1 0 0 0-.862 1.804 6.002 6.002 0 0 1-.007 10.838 1 1 0 0 0 .86 1.806A8.001 8.001 0 0 0 19 11a8.001 8.001 0 0 0-4.554-7.222z"></path>\n    <path d="M15 11a3.998 3.998 0 0 0-2-3.465v6.93A3.998 3.998 0 0 0 15 11z"></path>\n</svg>',volumeClose:'<svg xmlns="http://www.w3.org/2000/svg" height="22" width="22" viewBox="0 0 22 22">\n    <path d="M15 11a3.998 3.998 0 0 0-2-3.465v2.636l1.865 1.865A4.02 4.02 0 0 0 15 11z"></path>\n    <path d="M13.583 5.583A5.998 5.998 0 0 1 17 11a6 6 0 0 1-.585 2.587l1.477 1.477a8.001 8.001 0 0 0-3.446-11.286 1 1 0 0 0-.863 1.805zM18.778 18.778l-2.121-2.121-1.414-1.414-1.415-1.415L13 13l-2-2-3.889-3.889-3.889-3.889a.999.999 0 1 0-1.414 1.414L5.172 8H5a2 2 0 0 0-2 2v2a2 2 0 0 0 2 2h1l4.188 3.35a.5.5 0 0 0 .812-.39v-3.131l2.587 2.587-.01.005a1 1 0 0 0 .86 1.806c.215-.102.424-.214.627-.333l2.3 2.3a1.001 1.001 0 0 0 1.414-1.416zM11 5.04a.5.5 0 0 0-.813-.39L8.682 5.854 11 8.172V5.04z"></path>\n</svg>',fullscreen:'<svg xmlns="http://www.w3.org/2000/svg" height="36" width="36" viewBox="0 0 36 36">\n\t<path d="m 10,16 2,0 0,-4 4,0 0,-2 L 10,10 l 0,6 0,0 z"></path>\n\t<path d="m 20,10 0,2 4,0 0,4 2,0 L 26,10 l -6,0 0,0 z"></path>\n\t<path d="m 24,24 -4,0 0,2 L 26,26 l 0,-6 -2,0 0,4 0,0 z"></path>\n\t<path d="M 12,20 10,20 10,26 l 6,0 0,-2 -4,0 0,-4 0,0 z"></path>\n</svg>',loading:'<svg xmlns="http://www.w3.org/2000/svg" width="50px" height="50px" viewBox="0 0 100 100" preserveAspectRatio="xMidYMid" class="uil-default">\n  <rect x="0" y="0" width="100" height="100" fill="none" class="bk"/>\n  <rect x="47" y="40" width="6" height="20" rx="5" ry="5" fill="#ffffff" transform="rotate(0 50 50) translate(0 -30)">\n    <animate attributeName="opacity" from="1" to="0" dur="1s" begin="-1s" repeatCount="indefinite"/>\n  </rect>\n  <rect x="47" y="40" width="6" height="20" rx="5" ry="5" fill="#ffffff" transform="rotate(30 50 50) translate(0 -30)">\n    <animate attributeName="opacity" from="1" to="0" dur="1s" begin="-0.9166666666666666s" repeatCount="indefinite"/>\n  </rect>\n  <rect x="47" y="40" width="6" height="20" rx="5" ry="5" fill="#ffffff" transform="rotate(60 50 50) translate(0 -30)">\n    <animate attributeName="opacity" from="1" to="0" dur="1s" begin="-0.8333333333333334s" repeatCount="indefinite"/>\n  </rect>\n  <rect x="47" y="40" width="6" height="20" rx="5" ry="5" fill="#ffffff" transform="rotate(90 50 50) translate(0 -30)">\n    <animate attributeName="opacity" from="1" to="0" dur="1s" begin="-0.75s" repeatCount="indefinite"/></rect>\n  <rect x="47" y="40" width="6" height="20" rx="5" ry="5" fill="#ffffff" transform="rotate(120 50 50) translate(0 -30)">\n    <animate attributeName="opacity" from="1" to="0" dur="1s" begin="-0.6666666666666666s" repeatCount="indefinite"/>\n  </rect>\n  <rect x="47" y="40" width="6" height="20" rx="5" ry="5" fill="#ffffff" transform="rotate(150 50 50) translate(0 -30)">\n    <animate attributeName="opacity" from="1" to="0" dur="1s" begin="-0.5833333333333334s" repeatCount="indefinite"/>\n  </rect>\n  <rect x="47" y="40" width="6" height="20" rx="5" ry="5" fill="#ffffff" transform="rotate(180 50 50) translate(0 -30)">\n    <animate attributeName="opacity" from="1" to="0" dur="1s" begin="-0.5s" repeatCount="indefinite"/></rect>\n  <rect x="47" y="40" width="6" height="20" rx="5" ry="5" fill="#ffffff" transform="rotate(210 50 50) translate(0 -30)">\n    <animate attributeName="opacity" from="1" to="0" dur="1s" begin="-0.4166666666666667s" repeatCount="indefinite"/>\n  </rect>\n  <rect x="47" y="40" width="6" height="20" rx="5" ry="5" fill="#ffffff" transform="rotate(240 50 50) translate(0 -30)">\n    <animate attributeName="opacity" from="1" to="0" dur="1s" begin="-0.3333333333333333s" repeatCount="indefinite"/>\n  </rect>\n  <rect x="47" y="40" width="6" height="20" rx="5" ry="5" fill="#ffffff" transform="rotate(270 50 50) translate(0 -30)">\n    <animate attributeName="opacity" from="1" to="0" dur="1s" begin="-0.25s" repeatCount="indefinite"/></rect>\n  <rect x="47" y="40" width="6" height="20" rx="5" ry="5" fill="#ffffff" transform="rotate(300 50 50) translate(0 -30)">\n    <animate attributeName="opacity" from="1" to="0" dur="1s" begin="-0.16666666666666666s" repeatCount="indefinite"/>\n  </rect>\n  <rect x="47" y="40" width="6" height="20" rx="5" ry="5" fill="#ffffff" transform="rotate(330 50 50) translate(0 -30)">\n    <animate attributeName="opacity" from="1" to="0" dur="1s" begin="-0.08333333333333333s" repeatCount="indefinite"/>\n  </rect>\n</svg>'},T={};Object.keys(A).forEach(function(e){T[e]='<i class="flv-player-icon flv-player-icon-'.concat(e,'">').concat(A[e],"</i>")});var k=e(function(e){var i,t,o,a,r,n;i="undefined"!=typeof window&&void 0!==window.document?window.document:{},t=e.exports,o="undefined"!=typeof Element&&"ALLOW_KEYBOARD_INPUT"in Element,a=function(){for(var e,t=[["requestFullscreen","exitFullscreen","fullscreenElement","fullscreenEnabled","fullscreenchange","fullscreenerror"],["webkitRequestFullscreen","webkitExitFullscreen","webkitFullscreenElement","webkitFullscreenEnabled","webkitfullscreenchange","webkitfullscreenerror"],["webkitRequestFullScreen","webkitCancelFullScreen","webkitCurrentFullScreenElement","webkitCancelFullScreen","webkitfullscreenchange","webkitfullscreenerror"],["mozRequestFullScreen","mozCancelFullScreen","mozFullScreenElement","mozFullScreenEnabled","mozfullscreenchange","mozfullscreenerror"],["msRequestFullscreen","msExitFullscreen","msFullscreenElement","msFullscreenEnabled","MSFullscreenChange","MSFullscreenError"]],n=0,r=t.length,o={};n<r;n++)if((e=t[n])&&e[1]in i){for(n=0;n<e.length;n++)o[t[0][n]]=e[n];return o}return!1}(),r={change:a.fullscreenchange,error:a.fullscreenerror},n={request:function(r){return new Promise(function(e){var t=a.requestFullscreen,n=function(){this.off("change",n),e()}.bind(this);r=r||i.documentElement,/ Version\/5\.1(?:\.\d+)? Safari\//.test(navigator.userAgent)?r[t]():r[t](o?Element.ALLOW_KEYBOARD_INPUT:{}),this.on("change",n)}.bind(this))},exit:function(){return new Promise(function(e){if(this.isFullscreen){var t=function(){this.off("change",t),e()}.bind(this);i[a.exitFullscreen](),this.on("change",t)}else e()}.bind(this))},toggle:function(e){return this.isFullscreen?this.exit():this.request(e)},onchange:function(e){this.on("change",e)},onerror:function(e){this.on("error",e)},on:function(e,t){var n=r[e];n&&i.addEventListener(n,t,!1)},off:function(e,t){var n=r[e];n&&i.removeEventListener(n,t,!1)},raw:a},a?(Object.defineProperties(n,{isFullscreen:{get:function(){return Boolean(i[a.fullscreenElement])}},element:{enumerable:!0,get:function(){return i[a.fullscreenElement]}},enabled:{enumerable:!0,get:function(){return Boolean(i[a.fullscreenEnabled])}}}),t?(e.exports=n,e.exports.default=n):window.screenfull=n):t?e.exports=!1:window.screenfull=!1});function C(t,i){var e=t.events.proxy;e(i.$play,"click",function(){i.play()}),e(i.$pause,"click",function(){i.pause()});var n=b(function(e){var t=w(e/i.duration,0,1);i.$loaded.style.width="".concat(100*t,"%")},500);t.on("videoLoaded",function(e){t.options.live||n(e)});var r=b(function(e){i.$played.style.width="".concat(e/i.duration*100,"%"),i.$current.innerText=v(e)},500);t.on("timeupdate",function(e){t.options.live||r(e)}),t.on("seeked",function(e){t.options.live||r(e)}),t.on("play",function(){i.$play.style.display="none",i.$pause.style.display="block"}),t.on("ended",function(){i.controls=!0,i.$play.style.display="block",i.$pause.style.display="none"}),t.on("pause",function(){i.$play.style.display="block",i.$pause.style.display="none"}),t.on("scripMeta",function(){t.options.live||(i.$duration.innerText=v(i.duration))}),e(i.$fullscreen,"click",function(){i.fullscreen?i.fullscreen=!1:i.fullscreen=!0});var o=function(r,o,i){var a;function e(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];clearTimeout(a),a=setTimeout(function(){a=null,r.apply(i,t)},o)}return e.clearTimeout=function(){clearTimeout(a)},e}(function(){i.$player.classList.add("flv-player-hide-cursor"),i.controls=!1},5e3);function a(e){var t=i.$volumePanel.getBoundingClientRect(),n=t.left,r=t.width,o=i.$volumeHandle.getBoundingClientRect().width;return 10*(w(e.x-n-o/2,0,r-o/2)/(r-o))}function u(e){if(0===e)S(i.$volumeOn,"display","none"),S(i.$volumeOff,"display","flex"),S(i.$volumeHandle,"left","0");else{var t=((x(i.$volumePanel,"width")||60)-x(i.$volumeHandle,"width"))*e/10;S(i.$volumeOn,"display","flex"),S(i.$volumeOff,"display","none"),S(i.$volumeHandle,"left","".concat(t,"px"))}}if(e(i.$player,"mousemove",function(){o.clearTimeout(),i.$player.classList.remove("flv-player-hide-cursor"),i.controls=!0,i.playing&&o()}),t.options.hasAudio){var c=0,s=!1;u(t.options.volume),t.on("volumechange",function(){u(i.volume)}),e(i.$volumeOn,"click",function(){i.$volumeOn.style.display="none",i.$volumeOff.style.display="block",c=i.volume,i.volume=0}),e(i.$volumeOff,"click",function(){i.$volumeOn.style.display="block",i.$volumeOff.style.display="none",i.volume=c||7}),e(i.$volumePanel,"click",function(e){i.volume=a(e)}),e(i.$volumeHandle,"mousedown",function(){s=!0}),e(i.$volumeHandle,"mousemove",function(e){s&&(i.volume=a(e))}),e(document,"mouseup",function(){s&&(s=!1)})}function l(e){var t=i.$progress,n=t.getBoundingClientRect().left,r=w(e.x-n,0,t.clientWidth),o=r/t.clientWidth*i.duration;return{second:o,time:v(o),width:r,percentage:w(r/t.clientWidth,0,1)}}if(!t.options.live){e(i.$progress,"click",function(e){if(e.target!==i.$indicator){var t=l(e),n=t.second,r=t.percentage;n<=i.loaded&&(i.$played.style.width="".concat(100*r,"%"),i.currentTime=n)}});var f=!1;e(i.$indicator,"mousedown",function(){f=!0}),e(document,"mousemove",function(e){if(f){var t=l(e),n=t.second,r=t.percentage;n<=i.loaded&&(i.$played.style.width="".concat(100*r,"%"),i.currentTime=n)}}),e(document,"mouseup",function(){f&&(f=!1)});var d=!1,p=0,y=0;e(i.$canvas,"touchstart",function(e){d=!0,p=e.targetTouches[0].clientX}),e(i.$canvas,"touchmove",function(e){if(d){var t=i.$progress,n=e.targetTouches[0].clientX-p;y=n/t.clientWidth*i.duration}}),e(i.$canvas,"touchend",function(){d&&(d=!1,y<=i.loaded&&(i.currentTime+=y),y=p=0)})}}function $(e){c(this,$),function(e,t){var n=e.options;n.container.classList.add("flv-player-container"),n.container.innerHTML='\n        <div class="flv-player-inner flv-player-controls-show '.concat(n.live?"flv-player-live":""," ").concat(n.debug?"flv-player-debug":"",'">\n            <canvas class="flv-player-canvas" width="').concat(n.width,'" height="').concat(n.height,'"></canvas>\n            ').concat(n.poster?'<div class="flv-player-poster" style="background-image: url('.concat(n.poster,')"></div>'):"",'\n            <div class="flv-player-loading">').concat(T.loading,"</div>\n            ").concat(n.controls?'\n                <div class="flv-player-controls">\n                    '.concat(n.live?"":'\n                        <div class="flv-player-controls-progress">\n                            <div class="flv-player-loaded"></div>\n                            <div class="flv-player-played">\n                                <div class="flv-player-indicator"></div>\n                            </div>\n                        </div>\n                    ','\n                    <div class="flv-player-controls-bottom">\n                        <div class="flv-player-controls-left">\n                            <div class="flv-player-controls-item flv-player-state">\n                                <div class="flv-player-play">').concat(T.play,'</div>\n                                <div class="flv-player-pause">').concat(T.pause,"</div>\n                            </div>\n                            ").concat(n.hasAudio?'\n                                <div class="flv-player-controls-item flv-player-volume">\n                                    <div class="flv-player-volume-on">'.concat(T.volume,'</div>\n                                    <div class="flv-player-volume-off">').concat(T.volumeClose,'</div>\n                                    <div class="flv-player-volume-panel">\n                                        <div class="flv-player-volume-panel-handle"></div>\n                                    </div>\n                                </div>\n                            '):"","\n                            ").concat(n.live?"":'\n                                <div class="flv-player-controls-item flv-player-time">\n                                    <span class="flv-player-current">00:00</span> / <span class="flv-player-duration">00:00</span>\n                                </div>\n                            ','\n                        </div>\n                        <div class="flv-player-controls-right">\n                            <div class="flv-player-controls-item flv-player-fullscreen">').concat(T.fullscreen,"</div>\n                        </div>\n                    </div>\n                </div>\n            "):"","\n        </div>\n    "),Object.defineProperty(t,"$container",{value:n.container}),Object.defineProperty(t,"$player",{value:n.container.querySelector(".flv-player-inner")}),Object.defineProperty(t,"$canvas",{value:n.container.querySelector(".flv-player-canvas")}),Object.defineProperty(t,"$poster",{value:n.container.querySelector(".flv-player-poster")}),Object.defineProperty(t,"$loading",{value:n.container.querySelector(".flv-player-loading")}),Object.defineProperty(t,"$controls",{value:n.container.querySelector(".flv-player-controls")}),Object.defineProperty(t,"$state",{value:n.container.querySelector(".flv-player-state")}),Object.defineProperty(t,"$play",{value:n.container.querySelector(".flv-player-play")}),Object.defineProperty(t,"$pause",{value:n.container.querySelector(".flv-player-pause")}),Object.defineProperty(t,"$current",{value:n.container.querySelector(".flv-player-current")}),Object.defineProperty(t,"$duration",{value:n.container.querySelector(".flv-player-duration")}),Object.defineProperty(t,"$volumeOn",{value:n.container.querySelector(".flv-player-volume-on")}),Object.defineProperty(t,"$volumeOff",{value:n.container.querySelector(".flv-player-volume-off")}),Object.defineProperty(t,"$volumePanel",{value:n.container.querySelector(".flv-player-volume-panel")}),Object.defineProperty(t,"$volumeHandle",{value:n.container.querySelector(".flv-player-volume-panel-handle")}),Object.defineProperty(t,"$fullscreen",{value:n.container.querySelector(".flv-player-fullscreen")}),Object.defineProperty(t,"$progress",{value:n.container.querySelector(".flv-player-controls-progress")}),Object.defineProperty(t,"$loaded",{value:n.container.querySelector(".flv-player-loaded")}),Object.defineProperty(t,"$played",{value:n.container.querySelector(".flv-player-played")}),Object.defineProperty(t,"$indicator",{value:n.container.querySelector(".flv-player-indicator")})}(e,this),function(n,a){Object.defineProperty(a,"rect",{get:function(){return a.$container.getBoundingClientRect()}}),["bottom","height","left","right","top","width"].forEach(function(e){Object.defineProperty(a,e,{get:function(){return a.rect[e]}})}),Object.defineProperty(a,"currentTime",{get:function(){return n.decoder.currentTime},set:function(e){n.options.live||n.decoder.seeked(w(e,0,a.loaded))}}),Object.defineProperty(a,"streaming",{get:function(){return n.demuxer.streaming}}),Object.defineProperty(a,"demuxed",{get:function(){return n.demuxer.demuxed}}),Object.defineProperty(a,"videoDecoding",{get:function(){return n.decoder.video.decoding}}),Object.defineProperty(a,"audioDecoding",{get:function(){return n.decoder.audio.decoding}}),Object.defineProperty(a,"duration",{get:function(){try{return n.demuxer.scripMeta.amf2.metaData.duration}catch(e){return n.options.duration||0}}}),Object.defineProperty(a,"frameRate",{get:function(){var t=Math.round(n.options.frameRate||30);try{return Math.round(n.demuxer.scripMeta.amf2.metaData.framerate)||t}catch(e){return t}}}),Object.defineProperty(a,"frameDuration",{get:function(){return 1e3/a.frameRate|0}}),Object.defineProperty(a,"isFocus",{value:!1,writable:!0}),Object.defineProperty(a,"volume",{get:function(){try{return n.decoder.audio.gainNode.gain.value}catch(e){return 0}},set:function(t){try{return n.decoder.audio.gainNode.gain.value=w(t,0,10),n.emit("volumechange",a.volume),a.volume}catch(e){return t}}}),Object.defineProperty(a,"loaded",{get:function(){return n.decoder.video.loaded}}),Object.defineProperty(a,"playing",{get:function(){return n.decoder.playing}}),Object.defineProperty(a,"play",{value:function(){a.playing||n.decoder.play()}}),Object.defineProperty(a,"pause",{value:function(){n.decoder.pause()}}),Object.defineProperty(a,"toggle",{value:function(){a.playing?a.pause():a.play()}}),Object.defineProperty(a,"autoSize",{value:function(){var e=a.width,t=a.height,n=e/t,r=a.$canvas.width/a.$canvas.height;if(r<n){var o=(e-t*r)/2;a.$container.style.padding="0 ".concat(o,"px")}else{var i=(t-e/r)/2;a.$container.style.padding="".concat(i,"px 0")}}}),Object.defineProperty(a,"controls",{get:function(){return a.$player.classList.contains("flv-player-controls-show")},set:function(e){e?a.$player.classList.add("flv-player-controls-show"):a.$player.classList.remove("flv-player-controls-show")}}),Object.defineProperty(a,"loading",{get:function(){return a.$player.classList.contains("flv-player-loading-show")},set:function(e){e?a.$player.classList.add("flv-player-loading-show"):a.$player.classList.remove("flv-player-loading-show")}});try{var e=function(){a.fullscreen?a.$container.classList.add("flv-player-fullscreen"):a.$container.classList.remove("flv-player-fullscreen"),a.autoSize()};k.on("change",e),n.events.destroyEvents.push(function(){k.off("change",e)})}catch(e){n.debug.warn(!1,"Does not seem to support full screen events")}Object.defineProperty(a,"fullscreen",{get:function(){return k.isFullscreen||a.$container.classList.contains("flv-player-fullscreen-web")},set:function(e){if(e)try{k.request(a.$container)}catch(e){a.$container.classList.add("flv-player-fullscreen-web")}else try{k.exit()}catch(e){a.$container.classList.remove("flv-player-fullscreen-web")}}})}(e,this),function(e,t){var n=e.events.proxy,r=document.createElement("object");r.setAttribute("aria-hidden","true"),r.setAttribute("tabindex",-1),r.type="text/html",r.data="about:blank";var o=t.width,i=t.height;n(r,"load",function(){n(r.contentDocument.defaultView,"resize",function(){t.width===o&&t.height===i||(o=t.width,i=t.height,e.emit("resize"))})}),t.$container.appendChild(r)}(e,this),function(e,o){var t=e.options.poster,n=e.events.proxy;o.autoSize(),e.on("scripMeta",function(e){var t=e.amf2.metaData,n=t.width,r=t.height;o.$canvas.width=n,o.$canvas.height=r,o.autoSize()}),e.on("resize",function(){o.autoSize()}),n(window,["click","contextmenu"],function(e){-1<e.composedPath().indexOf(o.$container)?o.isFocus=!0:o.isFocus=!1}),n(o.$canvas,"click",function(){o.toggle()}),t&&(e.on("play",function(){o.$poster.style.display="none"}),e.on("seeked",function(){o.$poster.style.display="none"})),e.on("waiting",function(){o.loading=!0}),e.on("ended",function(){o.loading=!1}),e.on("timeupdate",function(){o.loading=!1})}(e,this),e.options.hotkey&&function(e,o){var t=e.events.proxy,i={};function n(e,t){i[e]?i[e].push(t):i[e]=[t]}n(27,function(){o.fullscreen&&(o.fullscreen=!1)}),n(32,function(){o.toggle()}),n(37,function(){o.currentTime-=10}),n(38,function(){o.volume+=1}),n(39,function(){o.currentTime+=10}),n(40,function(){o.volume-=1}),t(window,"keydown",function(e){if(o.isFocus){var t=document.activeElement.tagName.toUpperCase(),n=document.activeElement.getAttribute("contenteditable");if("INPUT"!==t&&"TEXTAREA"!==t&&""!==n&&"true"!==n){var r=i[e.keyCode];r&&(e.preventDefault(),r.forEach(function(e){return e()}))}}})}(e,this),e.options.controls&&C(e,this)}function j(r){var o=this;c(this,j);var t=r.options,i=r.debug;this.size=0,this.header=null,this.streaming=!1,this.demuxed=!1,this.videoDataSize=0,this.audioDataSize=0,this.videoDataLength=0,this.audioDataLength=0,this.streamStartTime=0,this.streamEndTime=0,this.scripMeta=null,this.AudioSpecificConfig=null,this.AVCDecoderConfigurationRecord=null,this.demuxWorker=function(e){return new Worker(URL.createObjectURL(new Blob([e],{type:"application/javascript"})))}('"use strict";function _toConsumableArray(e){return _arrayWithoutHoles(e)||_iterableToArray(e)||_nonIterableSpread()}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance")}function _iterableToArray(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}function _arrayWithoutHoles(e){if(Array.isArray(e)){for(var r=0,t=new Array(e.length);r<e.length;r++)t[r]=e[r];return t}}function _instanceof(e,r){return null!=r&&"undefined"!=typeof Symbol&&r[Symbol.hasInstance]?r[Symbol.hasInstance](e):e instanceof r}function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _classCallCheck(e,r){if(!_instanceof(e,r))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(e,r){return!r||"object"!==_typeof(r)&&"function"!=typeof r?_assertThisInitialized(e):r}function _assertThisInitialized(e){if(void 0===e)throw new ReferenceError("this hasn\'t been initialised - super() hasn\'t been called");return e}function _inherits(e,r){if("function"!=typeof r&&null!==r)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(r&&r.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),r&&_setPrototypeOf(e,r)}function _wrapNativeSuper(e){var r="function"==typeof Map?new Map:void 0;return(_wrapNativeSuper=function(e){if(null===e||!_isNativeFunction(e))return e;if("function"!=typeof e)throw new TypeError("Super expression must either be null or a function");if(void 0!==r){if(r.has(e))return r.get(e);r.set(e,t)}function t(){return _construct(e,arguments,_getPrototypeOf(this).constructor)}return t.prototype=Object.create(e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),_setPrototypeOf(t,e)})(e)}function isNativeReflectConstruct(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}function _construct(e,r,t){return(_construct=isNativeReflectConstruct()?Reflect.construct:function(e,r,t){var n=[null];n.push.apply(n,r);var a=new(Function.bind.apply(e,n));return t&&_setPrototypeOf(a,t.prototype),a}).apply(null,arguments)}function _isNativeFunction(e){return-1!==Function.toString.call(e).indexOf("[native code]")}function _setPrototypeOf(e,r){return(_setPrototypeOf=Object.setPrototypeOf||function(e,r){return e.__proto__=r,e})(e,r)}function _getPrototypeOf(e){return(_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var FlvPlayerError=function(e){function r(e,t){var n;return _classCallCheck(this,r),n=_possibleConstructorReturn(this,_getPrototypeOf(r).call(this,e)),"function"==typeof Error.captureStackTrace&&Error.captureStackTrace(_assertThisInitialized(n),t||n.constructor),n.name="FlvPlayerError",n}return _inherits(r,_wrapNativeSuper(Error)),r}(),debug={warn:function(e){if(!e){for(var r,t=arguments.length,n=new Array(t>1?t-1:0),a=1;a<t;a++)n[a-1]=arguments[a];(r=console).warn.apply(r,n)}},error:function(e,r){if(!e)throw new FlvPlayerError(r)}};function mergeBuffer(){for(var e=arguments.length,r=new Array(e),t=0;t<e;t++)r[t]=arguments[t];var n=r[0].constructor;return r.reduce(function(e,r){var t=new n((0|e.byteLength)+(0|r.byteLength));return t.set(e,0),t.set(r,0|e.byteLength),t},new n)}function readBufferSum(e){var r=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return e.reduce(function(t,n,a){return t+(r?n:n-128)*256**(e.length-a-1)},0)}function readString(e){var r;return(r=String.fromCharCode).call.apply(r,[String].concat(_toConsumableArray(e)))}function readBuffer(e){var r=0;function t(n){for(var a=new Uint8Array(n),o=0;o<n;o+=1)a[o]=e[r],r+=1;return t.index=r,a}return t.index=0,t}function readDouble(e){var r=new DataView(new ArrayBuffer(e.length));return e.forEach(function(e,t){r.setUint8(t,e)}),r.getFloat64(0)}function readBoolean(e){return 0!==e[0]}var index=0,header=null,uint8=new Uint8Array,scripMeta=null,AudioSpecificConfig=null,AVCDecoderConfigurationRecord=null,nalStart=new Uint8Array([0,0,0,1]);function readable(e){return uint8.length-index>=e}function read(e){for(var r=new Uint8Array(e),t=0;t<e;t+=1)r[t]=uint8[index],index+=1;return r}function demuxerScripTag(e){var r=readBuffer(e.body),t=Object.create(null),n=Object.create(null);function a(e){var t=null;if(void 0!==e)switch(e){case 0:t=readDouble(r(8));break;case 1:t=readBoolean(r(1));break;case 2:var n=readBufferSum(r(2));t=readString(r(n));break;case 3:t=Object.create(null);for(var o=-1;9!==o;){var i=readBufferSum(r(2)),u=readString(r(i)),c=r(1)[0];u&&(t[u]=a(c)),o=c}break;case 5:t=null;break;case 6:t=void 0;break;case 7:t="Reference #".concat(r.index),r(2);break;case 8:t=Object.create(null);for(var f=-1;9!==f;){var d=readBufferSum(r(2)),s=readString(r(d)),l=r(1)[0];s&&(t[s]=a(l)),f=l}break;case 10:var p=readBufferSum(r(4));t=[];for(var g=0;g<p;g+=1){var y=r(1)[0];t.push(a(y))}break;case 11:t=readDouble(r(2));break;case 12:var b=readBufferSum(r(4));t=readString(r(b));break;default:debug.error(!1,"AMF: Unknown metaData type: ".concat(e))}return t}for(t.type=r(1)[0],debug.error(2===t.type,"AMF: [amf1] type expect 2, but got ".concat(t.type)),t.size=readBufferSum(r(2)),t.string=readString(r(t.size)),n.type=r(1)[0],debug.error(8===n.type||3===n.type,"AMF: [amf2] type expect 8 or 3, but got ".concat(n.type)),n.size=readBufferSum(r(4)),n.metaData=Object.create(null);r.index<e.body.length;){var o=readBufferSum(r(2)),i=readString(r(o)),u=r(1)[0];i&&(n.metaData[i]=a(u))}debug.error(r.index===e.body.length,"AMF: Seems to be incompletely parsed"),debug.error(n.size===Object.keys(n.metaData).length,"AMF: [amf2] length does not match"),postMessage({type:"scripMeta",data:scripMeta={amf1:t,amf2:n}})}function demuxerVideoTag(e){debug.error(e.body.length>1,"Invalid video packet");var r={frameType:(240&e.body[0])>>4,codecID:15&e.body[0]};debug.error(7===r.codecID,"[videoTrack] Unsupported codec in video frame: ".concat(r.codecID));var t=e.body.slice(1,5);debug.error(t.length>=4,"[H264] Invalid AVC packet, missing AVCPacketType or/and CompositionTime");var n=new DataView(t.buffer),a=n.getUint8(0),o=((16777215&n.getUint32(0))<<8>>8)+e.timestamp,i=e.body.subarray(5);if(0===a){debug.warn(!AVCDecoderConfigurationRecord,"[h264] Find another one AVCDecoderConfigurationRecord"),debug.error(i.length>=7,"[H264] AVCDecoderConfigurationRecord parse length is not enough");var u=readBuffer(i),c={};c.configurationVersion=u(1)[0],debug.error(1===c.configurationVersion,"[H264] Invalid configurationVersion: ".concat(c.configurationVersion)),c.AVCProfileIndication=u(1)[0],debug.error(0!==c.AVCProfileIndication,"[H264] Invalid AVCProfileIndication: ".concat(c.AVCProfileIndication)),c.profile_compatibility=u(1)[0],c.AVCLevelIndication=u(1)[0],c.lengthSizeMinusOne=1+(3&u(1)[0]),debug.error(4===c.lengthSizeMinusOne||3!==c.lengthSizeMinusOne,"[H264] Invalid lengthSizeMinusOne: ".concat(c.lengthSizeMinusOne)),c.numOfSequenceParameterSets=31&u(1)[0],debug.error(0!==c.numOfSequenceParameterSets,"[H264] Invalid numOfSequenceParameterSets: ".concat(c.numOfSequenceParameterSets)),debug.warn(1===c.numOfSequenceParameterSets,"[H264] Strange numOfSequenceParameterSets: ".concat(c.numOfSequenceParameterSets));for(var f=0;f<c.numOfSequenceParameterSets;f+=1)if(c.sequenceParameterSetLength=readBufferSum(u(2)),c.sequenceParameterSetLength>0){var d=u(c.sequenceParameterSetLength);postMessage({type:"videoData",data:mergeBuffer(nalStart,d)})}c.numOfPictureParameterSets=u(1)[0],debug.error(0!==c.numOfPictureParameterSets,"[H264] Invalid numOfPictureParameterSets: ".concat(c.numOfPictureParameterSets)),debug.warn(1===c.numOfPictureParameterSets,"[H264] Strange numOfPictureParameterSets: ".concat(c.numOfPictureParameterSets));for(var s=0;s<c.numOfPictureParameterSets;s+=1)if(c.pictureParameterSetLength=readBufferSum(u(2)),c.pictureParameterSetLength>0){var l=u(c.pictureParameterSetLength);postMessage({type:"videoData",data:mergeBuffer(nalStart,l)})}AVCDecoderConfigurationRecord=c,postMessage({type:"AVCDecoderConfigurationRecord",data:c})}else if(1===a)for(var p=AVCDecoderConfigurationRecord.lengthSizeMinusOne,g=readBuffer(i);g.index<i.length;){var y=readBufferSum(g(p));postMessage({type:"videoData",data:mergeBuffer(nalStart,g(y)),timestamp:o})}else debug.error(2===a,"[H264] Invalid video packet type ".concat(a))}function demuxerAudioTag(e){debug.error(e.body.length>1,"Invalid audio packet");var r={soundFormat:(240&e.body[0])>>4,soundRate:(12&e.body[0])>>2,soundSize:(2&e.body[0])>>1,soundType:(1&e.body[0])>>0};debug.error(10===r.soundFormat,"[audioTrack] unsupported audio format: ".concat(r.soundFormat));var t=e.body.subarray(1);if(0===t[0]){var n=t.subarray(1);debug.warn(!AudioSpecificConfig,"[aac] Find another one AudioSpecificConfig"),debug.error(n.length>=2,"[aac] AudioSpecificConfig parse length is not enough");var a={};a.audioObjectType=(248&n[0])>>3,a.samplingFrequencyIndex=((7&n[0])<<1)+((128&n[1])>>7&1),a.channelConfiguration=(127&n[1])>>3,AudioSpecificConfig=a,postMessage({type:"AudioSpecificConfig",data:a})}else{var o=AudioSpecificConfig,i=o.audioObjectType,u=o.samplingFrequencyIndex,c=o.channelConfiguration,f=e.dataSize-2+7,d=new Uint8Array(7);d[0]=255,d[1]=240,d[1]|=0,d[1]|=0,d[1]|=1,d[2]=i-1<<6,d[2]|=(15&u)<<2,d[2]|=0,d[2]|=(4&c)>>2,d[3]=(3&c)<<6,d[3]|=0,d[3]|=0,d[3]|=0,d[3]|=0,d[3]|=(6144&f)>>11,d[4]=(2040&f)>>3,d[5]=(7&f)<<5,d[5]|=31,d[6]=252;var s=e.body.subarray(2);postMessage({type:"audioData",data:mergeBuffer(d,s),timestamp:e.timestamp})}}onmessage=function(e){if(uint8=mergeBuffer(uint8,e.data),!header&&readable(13)){(header=Object.create(null)).signature=readString(read(3)),header.version=read(1)[0],debug.error("FLV"===header.signature&&1===header.version,"FLV header not found"),header.flags=read(1)[0],header.headersize=readBufferSum(read(4));var r=readBufferSum(read(4));debug.error(0===r,"PrevTagSize0 should be equal to 0, but got ".concat(r)),postMessage({type:"flvHeader",data:header})}for(;index<uint8.length;){var t=Object.create(null),n=index;if(!readable(11))return index=0,void(uint8=uint8.subarray(n));t.tagType=read(1)[0],t.dataSize=readBufferSum(read(3));var a=read(1),o=read(1),i=read(1),u=read(1);if(t.timestamp=i|o<<8|a<<16|u<<24,t.streamID=readBufferSum(read(3)),debug.error(0===t.streamID,"streamID should be equal to 0, but got ".concat(t.streamID)),!readable(t.dataSize+4))return index=0,void(uint8=uint8.subarray(n));t.body=read(t.dataSize);var c=readBufferSum(read(4));switch(debug.error(c===t.dataSize+11,"Invalid PrevTagSize: ".concat(c)),t.tagType){case 18:demuxerScripTag(t);break;case 9:demuxerVideoTag(t);break;case 8:demuxerAudioTag(t);break;default:debug.error(!1,"unknown tag type: ".concat(t.tagType))}}index=0,uint8=new Uint8Array};'),r.on("destroy",function(){o.demuxWorker.terminate()}),r.on("streamStart",function(e){o.streamStartTime=g(),i.log("stream-url",t.url),i.log("stream-request",e)}),r.on("streaming",function(e){o.streaming=!0,o.size+=e.byteLength,o.demuxWorker.postMessage(e)}),r.on("streamEnd",function(e){o.streaming=!1,o.streamEndTime=g(),e&&(o.index=0,o.size=e.byteLength,o.demuxWorker.postMessage(e)),i.log("stream-size","".concat(o.size," byte")),i.log("stream-time","".concat(o.streamEndTime-o.streamStartTime," ms")),o.demuxed=!0,r.emit("demuxDone"),i.log("demux-done")});var a=new Uint8Array,u=new Uint8Array;this.demuxWorker.onmessage=function(e){var t=e.data;switch(t.type){case"flvHeader":o.header=t.data,r.emit("flvHeader",o.header),i.log("flv-header",o.header);break;case"scripMeta":o.scripMeta=t.data,r.emit("scripMeta",o.scripMeta),i.log("scrip-meta",o.scripMeta);break;case"AVCDecoderConfigurationRecord":o.AVCDecoderConfigurationRecord=t.data,r.emit("AVCDecoderConfigurationRecord",o.AVCDecoderConfigurationRecord),i.log("AVCDecoderConfigurationRecord",o.AVCDecoderConfigurationRecord);break;case"AudioSpecificConfig":o.AudioSpecificConfig=t.data,r.emit("AudioSpecificConfig",o.AudioSpecificConfig),i.log("AudioSpecificConfig",o.AudioSpecificConfig);break;case"videoData":o.videoDataLength+=1,o.videoDataSize+=t.data.byteLength;var n=function(r){var o=0;function i(e){for(var t=new Uint8Array(e),n=0;n<e;n+=1)t[n]=r[o],o+=1;return i.index=o,t}return i.index=0,i}(t.data);switch(n(4),31&n(1)[0]){case 1:case 5:r.emit("videoData",h(a,u,t.data),t.timestamp);break;case 7:a=t.data;break;case 8:u=t.data}break;case"audioData":o.audioDataLength+=1,o.audioDataSize+=t.data.byteLength,r.emit("audioData",t.data,t.timestamp)}}}var E=function(){function e(r){var o=this;c(this,e),this.flv=r,this.context=new(window.AudioContext||window.webkitAudioContext),this.gainNode=this.context.createGain(),this.gainNode.gain.value=r.options.volume,this.playing=!1,this.playIndex=0,this.audiobuffers=[],this.timestamps=[],this.audioInputLength=0,this.decoding=!1,this.byteSize=0,this.loaded=0,r.on("destroy",function(){o.audiobuffers=[],o.stop()});var i=[];this.decodeErrorBuffer=new Uint8Array,this.decodeWaitingBuffer=new Uint8Array,r.on("audioData",function(e,t){if(o.decoding=!0,o.audioInputLength+=1,131072<=o.decodeWaitingBuffer.byteLength){o.timestamps.push(i[0]),i=[];var n=h(o.decodeErrorBuffer,o.decodeWaitingBuffer).buffer;o.decodeWaitingBuffer=new Uint8Array,o.context.decodeAudioData(n,function(e){o.loaded+=e.duration,o.byteSize+=e.length,o.audiobuffers.push(e),r.emit("audioLoaded",o.loaded),o.decodeErrorBuffer=new Uint8Array}).catch(function(){o.decodeErrorBuffer=h(o.decodeErrorBuffer,o.decodeWaitingBuffer)})}else i.push(t),o.decodeWaitingBuffer=h(o.decodeWaitingBuffer,e)}),r.on("timeupdate",function(e){o.flv.demuxer.demuxed&&o.decodeWaitingBuffer.length&&(o.timestamps.push(i[0]),i=[],o.context.decodeAudioData(o.decodeWaitingBuffer.buffer,function(e){o.decodeWaitingBuffer=new Uint8Array,o.decodeErrorBuffer=new Uint8Array,o.loaded+=e.duration,o.byteSize+=e.length,o.audiobuffers.push(e),r.emit("audioLoaded",o.loaded),o.decoding=!1}));var t=o.timestamps[o.playIndex];t&&t<=1e3*e&&(o.queue(o.playIndex)?o.playIndex+=1:o.stop())})}return t(e,[{key:"queue",value:function(e){var t=this,n=this.audiobuffers[e];return!!n&&(this.source=this.context.createBufferSource(),this.source.buffer=n,this.source.connect(this.gainNode),this.gainNode.connect(this.context.destination),this.source.onended=function(){t.flv.options.live&&(t.audiobuffers[e]=null)},this.playing=!0,this.source.start(),!0)}},{key:"play",value:function(){var e=this,t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:0;this.stop();var n=0,r=this.audiobuffers.findIndex(function(e){return n+=e.duration,t<=n}),o=this.audiobuffers[r];if(o){var i=t-(n-o.duration);this.source=this.context.createBufferSource(),this.source.connect(this.gainNode),this.gainNode.connect(this.context.destination),this.source.buffer=o,this.source.onended=function(){e.flv.options.live&&(e.audiobuffers[r]=null)},this.playing=!0,this.source.start(0,i),this.playIndex=r+1}else this.stop()}},{key:"stop",value:function(){this.playing=!1,this.source&&(this.source.onended=null,this.source.stop())}}]),e}(),F=function(){function r(t){var n=this;c(this,r),this.flv=t,this.ended=!1,this.playing=!1,this.waiting=!1,this.animationFrameTimer=null,this.waitingTimer=null,this.endedTimer=null,this.currentTime=0,this.lastUpdateTime=0,this.video=new window.VideoDecoder(t,this),t.options.hasAudio?this.audio=new E(t,this):this.audio={play:function(){return null},stop:function(){return null},playing:!0,decoding:!1},t.on("destroy",function(){n.pause()}),t.on("timeupdate",function(e){!t.options.live&&e>=t.player.duration&&n.pause()});var e=!1;t.events.proxy(document,"visibilitychange",function(){document.hidden&&(e=n.playing,n.pause()),!document.hidden&&e&&(e=n.playing,n.play())})}return t(r,[{key:"play",value:function(){this.lastUpdateTime=g(),this.video.play(this.currentTime),this.audio.play(this.currentTime),this.animationFrame(),this.flv.emit("play")}},{key:"animationFrame",value:function(){var t=this,e=this.flv,n=e.options,r=e.player;this.animationFrameTimer=window.requestAnimationFrame(function(){if(t.video.playing&&t.audio.playing){t.ended=!1,t.playing=!0,t.waiting=!1;var e=g();t.currentTime+=(e-t.lastUpdateTime)/1e3,t.lastUpdateTime=e,t.flv.emit("timeupdate",t.currentTime)}else{if(r.streaming||t.video.decoding||t.audio.decoding)return t.ended=!1,t.playing=!1,t.waiting=!0,t.flv.emit("waiting",t.currentTime),void(t.waitingTimer=setTimeout(function(){t.play()},1e3));if(t.ended=!0,t.playing=!1,t.waiting=!1,t.flv.emit("ended",t.currentTime),n.loop&&!n.live)return t.currentTime=0,void(t.endedTimer=setTimeout(function(){t.play(),t.flv.emit("loop")},1e3));t.pause()}t.animationFrame()})}},{key:"pause",value:function(){window.cancelAnimationFrame(this.animationFrameTimer),window.clearTimeout(this.waitingTimer),window.clearTimeout(this.endedTimer),this.animationFrameTimer=null,this.waitingTimer=null,this.endedTimer=null,this.video.stop(),this.audio.stop(),this.ended=!1,this.playing=!1,this.waiting=!1,this.flv.emit("pause")}},{key:"seeked",value:function(e){var t=this.flv.player;window.cancelAnimationFrame(this.animationFrameTimer),window.clearTimeout(this.waitingTimer),window.clearTimeout(this.endedTimer),this.animationFrameTimer=null,this.waitingTimer=null,this.endedTimer=null,this.currentTime=e,this.video.draw(Math.floor(e*t.frameRate)),this.playing&&this.play(),this.flv.emit("seeked",e)}}]),r}();function D(o,e){return o.emit("streamStart","fetch-request"),fetch(e,{headers:o.options.headers}).then(function(e){var t=e.body.getReader();return o.on("destroy",function(){t.cancel()}),function r(){t.read().then(function(e){var t=e.done,n=e.value;t?o.emit("streamEnd"):(o.emit("streaming",new Uint8Array(n)),r())}).catch(function(e){throw e})}(),t})}function M(e,t){e.emit("streamStart","moz-xhr-request");var n=e.events.proxy,r=e.options.headers,o=new XMLHttpRequest;return o.open("GET",t,!0),o.responseType="moz-chunked-arraybuffer",Object.keys(r).forEach(function(e){o.setRequestHeader(e,r[e])}),n(o,"readystatechange",function(){e.emit("readystatechange",o)}),n(o,"progress",function(){e.emit("streaming",new Uint8Array(o.response))}),n(o,"loadend",function(){e.emit("streamEnd")}),n(o,"error",function(e){throw e}),e.on("destroy",function(){o.abort()}),o.send(),o}function L(t,e){t.emit("streamStart","xhr-request");var n=t.events.proxy,r=t.options.headers,o=new TextEncoder,i=new XMLHttpRequest;i.open("GET",e,!0),i.responseType="text",Object.keys(r).forEach(function(e){i.setRequestHeader(e,r[e])});var a=0;return n(i,"readystatechange",function(){t.emit("readystatechange",i)}),n(i,"progress",function(){var e=i.responseText.substr(a);a=i.responseText.length,t.emit("streaming",o.encode(e,{stream:!0}))}),n(i,"loadend",function(){t.emit("streaming",o.encode("",{stream:!1})),t.emit("streamEnd")}),n(i,"error",function(e){throw e}),t.on("destroy",function(){i.abort()}),i.send(),i}function B(t,e){t.emit("streamStart","websocket-request");var n=t.options,r=t.events.proxy,o=new WebSocket(e);return o.binaryType="arraybuffer",r(o,"open",function(){o.send(n.socketSend)}),r(o,"message",function(e){t.emit("streaming",new Uint8Array(e.data))}),r(o,"close",function(){t.emit("streamEnd")}),r(o,"error",function(e){throw e}),t.on("destroy",function(){o.close()}),o}function z(n,e){n.emit("streamStart","FileReader");var t=n.events.proxy,r=new FileReader;return t(r,"load",function(e){var t=e.target.result;n.emit("streamEnd",new Uint8Array(t))}),r.readAsArrayBuffer(e),r}var R=function(){function n(e){c(this,n);var t=e.options.url;this.transportFactory=n.getStreamFactory(t),this.transport=this.transportFactory(e,t)}return t(n,null,[{key:"supportsXhrResponseType",value:function(e){try{var t=new XMLHttpRequest;return t.responseType=e,t.responseType===e}catch(e){return!1}}},{key:"getStreamFactory",value:function(e){if(e instanceof File)return z;if(e.startsWith("ws://"))return B;if("undefined"!=typeof Response&&Object.prototype.hasOwnProperty.call(Response.prototype,"body")&&"function"==typeof Headers)return D;return n.supportsXhrResponseType("moz-chunked-arraybuffer")?M:L}}]),n}(),_=0,q=function(e){function r(e){var t;if(c(this,r),(t=u(this,s(r).call(this))).options=i({},r.options,e),"string"==typeof t.options.container&&(t.options.container=document.querySelector(t.options.container)),t.debug=new O(a(t)),t.events=new P(a(t)),window.VideoDecoder)t.player=new $(a(t)),t.decoder=new F(a(t)),t.demuxer=new j(a(t)),t.stream=new R(a(t));else{var n=document.createElement("script");n.src=t.options.videoDecoder,document.body.appendChild(n),t.events.proxy(n,"load",function(){t.player=new $(a(t)),t.decoder=new F(a(t)),t.demuxer=new j(a(t)),t.stream=new R(a(t))}),t.events.proxy(n,"error",function(){var e=new URL(t.options.videoDecoder,window.location.href).href;t.debug.error(!1,"Video decoder not found: ".concat(e))})}return _+=1,t.id=_,t.isDestroy=!1,t.userAgent=window.navigator.userAgent,t.isMobile=/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(t.userAgent),r.instances.push(a(t)),t}return f(r,d),t(r,[{key:"destroy",value:function(){this.events.destroy(),this.isDestroy=!0,this.options.container.innerHTML="",r.instances.splice(r.instances.indexOf(this),1),this.emit("destroy")}}],[{key:"options",get:function(){return{url:"",poster:"",container:"",debug:!1,live:!1,loop:!1,hotkey:!0,controls:!0,hasAudio:!0,volume:7,frameRate:30,width:400,height:300,socketSend:"",headers:{},videoDecoder:"./baselineProfileDecoder.js"}}},{key:"version",get:function(){return"1.0.6"}},{key:"env",get:function(){return'"production"'}}]),r}();return Object.defineProperty(q,"instances",{value:[]}),q});
