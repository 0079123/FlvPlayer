/*!
 * FlvPlayer.js v1.1.2
 * Github: https://github.com/zhw2590582/FlvPlayer#readme
 * (c) 2017-2019 Harvey Zack
 * Released under the MIT License.
 */

!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e=e||self).FlvPlayer=t()}(this,function(){"use strict";var n=function(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e};var c=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")};function o(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var t=function(e,t,r){return t&&o(e.prototype,t),r&&o(e,r),e};"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self&&self;function e(e,t){return e(t={exports:{}},t.exports),t.exports}var i=e(function(t){function r(e){return(r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function n(e){return"function"==typeof Symbol&&"symbol"===r(Symbol.iterator)?t.exports=n=function(e){return r(e)}:t.exports=n=function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":r(e)},n(e)}t.exports=n});var r=function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e};var a=function(e,t){return!t||"object"!==i(t)&&"function"!=typeof t?r(e):t},u=e(function(t){function r(e){return t.exports=r=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},r(e)}t.exports=r}),s=e(function(r){function n(e,t){return r.exports=n=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},n(e,t)}r.exports=n});var f=function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&s(e,t)},d=e(function(e,t){function r(e){return(r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function n(e){return e.constructor?e.constructor.name:null}function c(e,t){var r=2<arguments.length&&void 0!==arguments[2]?arguments[2]:["option"];return s(e,t,r),f(e,t,r),function(i,a,u){var e=d(a),t=d(i);if("object"===e){if("object"!==t)throw new Error("[Type Error]: '".concat(u.join("."),"' require 'object' type, but got '").concat(t,"'"));Object.keys(a).forEach(function(e){var t=i[e],r=a[e],n=u.slice();n.push(e),s(t,r,n),f(t,r,n),c(t,r,n)})}if("array"===e){if("array"!==t)throw new Error("[Type Error]: '".concat(u.join("."),"' require 'array' type, but got '").concat(t,"'"));i.forEach(function(e,t){var r=i[t],n=a[t]||a[0],o=u.slice();o.push(t),s(r,n,o),f(r,n,o),c(r,n,o)})}}(e,t,r),e}function s(e,t,r){if("string"===d(t)){var n=d(e);if(!(-1<t.indexOf("|")?t.split("|").map(function(e){return e.toLowerCase().trim()}).filter(Boolean).some(function(e){return n===e}):t.toLowerCase().trim()===n))throw new Error("[Type Error]: '".concat(r.join("."),"' require '").concat(t,"' type, but got '").concat(n,"'"))}}function f(e,t,r){if("function"===d(t)){var n=t(e,d(e),r);if(!0!==n){var o=d(n);throw"string"===o?new Error(n):"error"===o?n:new Error("[Validator Error]: The scheme for '".concat(r.join("."),"' validator require return true, but got '").concat(n,"'"))}}}var o,d;e.exports=(o=Object.prototype.toString,c.kindOf=d=function(e){if(void 0===e)return"undefined";if(null===e)return"null";var t=r(e);if("boolean"===t)return"boolean";if("string"===t)return"string";if("number"===t)return"number";if("symbol"===t)return"symbol";if("function"===t)return function(e){return"GeneratorFunction"===n(e)}(e)?"generatorfunction":"function";if(function(e){return Array.isArray?Array.isArray(e):e instanceof Array}(e))return"array";if(function(e){return!(!e.constructor||"function"!=typeof e.constructor.isBuffer)&&e.constructor.isBuffer(e)}(e))return"buffer";if(function(e){try{if("number"==typeof e.length&&"function"==typeof e.callee)return!0}catch(e){if(-1!==e.message.indexOf("callee"))return!0}return!1}(e))return"arguments";if(function(e){return e instanceof Date||"function"==typeof e.toDateString&&"function"==typeof e.getDate&&"function"==typeof e.setDate}(e))return"date";if(function(e){return e instanceof Error||"string"==typeof e.message&&e.constructor&&"number"==typeof e.constructor.stackTraceLimit}(e))return"error";if(function(e){return e instanceof RegExp||"string"==typeof e.flags&&"boolean"==typeof e.ignoreCase&&"boolean"==typeof e.multiline&&"boolean"==typeof e.global}(e))return"regexp";switch(n(e)){case"Symbol":return"symbol";case"Promise":return"promise";case"WeakMap":return"weakmap";case"WeakSet":return"weakset";case"Map":return"map";case"Set":return"set";case"Int8Array":return"int8array";case"Uint8Array":return"uint8array";case"Uint8ClampedArray":return"uint8clampedarray";case"Int16Array":return"int16array";case"Uint16Array":return"uint16array";case"Int32Array":return"int32array";case"Uint32Array":return"uint32array";case"Float32Array":return"float32array";case"Float64Array":return"float64array"}if(function(e){return"function"==typeof e.throw&&"function"==typeof e.return&&"function"==typeof e.next}(e))return"generator";switch(t=o.call(e)){case"[object Object]":return"object";case"[object Map Iterator]":return"mapiterator";case"[object Set Iterator]":return"setiterator";case"[object String Iterator]":return"stringiterator";case"[object Array Iterator]":return"arrayiterator"}return t.slice(8,-1).toLowerCase().replace(/\s/g,"")},c)});function l(){return function(){try{if("object"===i(window.WebAssembly)&&"function"==typeof window.WebAssembly.instantiate){var e=new window.WebAssembly.Module(Uint8Array.of(0,97,115,109,1,0,0,0));if(e instanceof window.WebAssembly.Module)return new window.WebAssembly.Instance(e)instanceof window.WebAssembly.Instance}return!1}catch(e){return!1}}()&&"function"==typeof window.Worker&&"function"==typeof window.fetch&&"function"==typeof window.Blob&&function(){try{return!!new window.Blob}catch(e){return!1}}()&&"function"==typeof window.ArrayBuffer&&window.URL&&"function"==typeof window.URL.createObjectURL&&function(){var e=(new Audio).canPlayType("audio/aac;");return"probably"===e||"maybe"===e}()&&(window.AudioContext||window.webkitAudioContext)&&function(){if(window.WebGLRenderingContext){for(var e=document.createElement("canvas"),t=["webgl2","webgl","experimental-webgl","moz-webgl","webkit-3d"],r=!1,n=0;n<t.length;n+=1)try{if((r=e.getContext(t[n]))&&"function"==typeof r.getParameter)return!0}catch(e){}return!1}return!1}()}var p=function(){function e(){c(this,e)}return t(e,[{key:"on",value:function(e,t,r){var n=this.e||(this.e={});return(n[e]||(n[e]=[])).push({fn:t,ctx:r}),this}},{key:"once",value:function(n,o,i){var a=this;function u(){a.off(n,u);for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];o.apply(i,t)}return u._=o,this.on(n,u,i)}},{key:"emit",value:function(e){for(var t=((this.e||(this.e={}))[e]||[]).slice(),r=arguments.length,n=new Array(1<r?r-1:0),o=1;o<r;o++)n[o-1]=arguments[o];for(var i=0;i<t.length;i+=1)t[i].fn.apply(t[i].ctx,n);return this}},{key:"off",value:function(e,t){var r=this.e||(this.e={}),n=r[e],o=[];if(n&&t)for(var i=0,a=n.length;i<a;i+=1)n[i].fn!==t&&n[i].fn._!==t&&o.push(n[i]);return o.length?r[e]=o:delete r[e],this}}]),e}();function h(e){c(this,h);var i=e.options.debug;this.log=function(e){if(i){for(var t,r=arguments.length,n=new Array(1<r?r-1:0),o=1;o<r;o++)n[o-1]=arguments[o];(t=console).log.apply(t,["FlvPlayer: [".concat(e,"]")].concat(n))}},this.warn=function(e){if(!e&&i){for(var t,r=arguments.length,n=new Array(1<r?r-1:0),o=1;o<r;o++)n[o-1]=arguments[o];(t=console).warn.apply(t,n)}},this.error=function(e,t){if(!e)throw new g(t)}}var y=function(e){return-1!==Function.toString.call(e).indexOf("[native code]")},m=e(function(n){function o(e,t,r){return!function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}()?n.exports=o=function(e,t,r){var n=[null];n.push.apply(n,t);var o=new(Function.bind.apply(e,n));return r&&s(o,r.prototype),o}:n.exports=o=Reflect.construct,o.apply(null,arguments)}n.exports=o}),g=function(e){function r(e){var t;return c(this,r),(t=a(this,u(r).call(this,e))).name="FlvPlayerError",t}return f(r,e),r}(e(function(t){function n(e){var r="function"==typeof Map?new Map:void 0;return t.exports=n=function(e){if(null===e||!y(e))return e;if("function"!=typeof e)throw new TypeError("Super expression must either be null or a function");if(void 0!==r){if(r.has(e))return r.get(e);r.set(e,t)}function t(){return m(e,arguments,u(this).constructor)}return t.prototype=Object.create(e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),s(t,e)},n(e)}t.exports=n})(Error)),b=function(){function r(e){var t=this;c(this,r),this.destroys=[],this.proxy=this.proxy.bind(this),e.on("destroy",function(){t.destroy()})}return t(r,[{key:"proxy",value:function(t,e,r,n){var o=this,i=3<arguments.length&&void 0!==n?n:{};if(Array.isArray(e))return e.map(function(e){return o.proxy(t,e,r,i)});t.addEventListener(e,r,i);function a(){return t.removeEventListener(e,r,i)}return this.destroys.push(a),a}},{key:"destroy",value:function(){this.destroys.forEach(function(e){return e()})}}]),r}();function v(){return/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)}function w(){return/MicroMessenger/i.test(navigator.userAgent)}function S(e,t){return Object.prototype.hasOwnProperty.call(e,t)}function k(n){var o=0;function i(e){for(var t=new Uint8Array(e),r=0;r<e;r+=1)t[r]=n[o],o+=1;return i.index=o,t}return i.index=0,i}function j(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];var n=t[0].constructor;return t.reduce(function(e,t){var r=new n((0|e.byteLength)+(0|t.byteLength));return r.set(e,0),r.set(t,0|e.byteLength),r},new n)}function O(){return performance&&"function"==typeof performance.now?performance.now():Date.now()}function A(o,i){var a,u,c=!1;return function e(){for(var t=arguments.length,r=new Array(t),n=0;n<t;n++)r[n]=arguments[n];if(c)return a=r,void(u=this);c=!0,o.apply(this,r),setTimeout(function(){c=!1,a&&(e.apply(u,a),u=a=null)},i)}}function x(e,t,r){return Math.max(Math.min(e,Math.max(t,r)),Math.min(t,r))}function P(n,o){return new Promise(function(e,t){var r=document.createElement("script");r.type="text/javascript",r.onload=function(){window[o]?e(window[o]):t(new Error("Unable to find global variable '".concat(o,"' from '").concat(n,"'")))},r.onerror=function(){t(new Error("Resource loading failed '".concat(n,"'")))},r.src=n,document.head.appendChild(r)})}function C(e){for(var t=arguments.length,r=new Array(1<t?t-1:0),n=1;n<t;n++)r[n-1]=arguments[n];return r.reduce(function(t,r){return Object.getOwnPropertyNames(r).forEach(function(e){if(S(t,e))throw new Error("Target attribute name is duplicated: ".concat(e));Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))}),t},e)}function T(n){var o=0,i=O();return function(e){o+=e;var t=O(),r=t-i;1e3<=r&&(n(o/r*1e3),i=t,o=0)}}var D=Object.freeze({isMobile:v,isWechat:w,hasOwnProperty:S,readBuffer:k,mergeBuffer:j,createWorker:function(e){return new Worker(URL.createObjectURL(new Blob([e],{type:"application/javascript"})))},secondToTime:function(e){var t=Math.floor(e/3600),r=Math.floor((e-3600*t)/60),n=Math.floor(e-3600*t-60*r);return(0<t?[t,r,n]:[r,n]).map(function(e){return e<10?"0".concat(e):String(e)}).join(":")},getNowTime:O,debounce:function(n,o,i){var a;function e(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];clearTimeout(a),a=setTimeout(function(){a=null,n.apply(i,t)},o)}return e.clearTimeout=function(){clearTimeout(a)},e},throttle:A,clamp:x,setStyle:function t(r,n,e){return"object"===i(n)&&Object.keys(n).forEach(function(e){t(r,e,n[e])}),r.style[n]=e,r},getStyle:function(e,t){var r=!(2<arguments.length&&void 0!==arguments[2])||arguments[2],n=getComputedStyle(e,null).getPropertyValue(t);return r?parseFloat(n):n},loadScript:P,proxyPropertys:C,calculationRate:T});function E(e){c(this,E),function(e,t){var r=e.options,n=r.container.style.cssText;r.container.classList.add("flvplayer-container"),r.container.innerHTML='\n        <div class="flvplayer-player">\n            <canvas class="flvplayer-canvas" width="'.concat(r.width,'" height="').concat(r.height,'"></canvas>\n        </div>\n    '),e.on("destroy",function(){r.container.innerHTML="",r.container.style.cssText=n,r.container.classList.remove("flvplayer-container")}),Object.defineProperty(t,"$container",{value:r.container}),Object.defineProperty(t,"$player",{value:r.container.querySelector(".flvplayer-player")}),Object.defineProperty(t,"$canvas",{value:r.container.querySelector(".flvplayer-canvas")})}(e,this),function(r,n){Object.defineProperty(n,"rect",{get:function(){return n.$container.getBoundingClientRect()}}),["bottom","height","left","right","top","width"].forEach(function(e){Object.defineProperty(n,e,{get:function(){return n.rect[e]}})}),Object.defineProperty(n,"currentTime",{get:function(){return r.decoder.currentTime},set:function(e){r.options.cache&&r.decoder.seeked(x(e,0,n.loaded))}}),Object.defineProperty(n,"streaming",{get:function(){return r.demuxer.streaming}}),Object.defineProperty(n,"demuxed",{get:function(){return r.demuxer.demuxed}}),Object.defineProperty(n,"videoDecoding",{get:function(){return r.decoder.video.decoding}}),Object.defineProperty(n,"audioDecoding",{get:function(){return r.decoder.audio.decoding}}),Object.defineProperty(n,"duration",{get:function(){try{return r.demuxer.scripMeta.amf2.metaData.duration}catch(e){return r.options.duration||0}}}),Object.defineProperty(n,"frameRate",{get:function(){var t=Math.round(r.options.frameRate||30);try{return Math.round(r.demuxer.scripMeta.amf2.metaData.framerate)||t}catch(e){return t}}}),Object.defineProperty(n,"frameDuration",{get:function(){return 1e3/n.frameRate|0}}),Object.defineProperty(n,"muted",{get:function(){return r.decoder.audio.muted},set:function(e){r.decoder.audio.muted=e}}),Object.defineProperty(n,"volume",{get:function(){try{return r.decoder.audio.volume}catch(e){return 0}},set:function(t){try{return r.decoder.audio.volume=x(t,0,1),n.volume}catch(e){return t}}}),Object.defineProperty(n,"loaded",{get:function(){return r.decoder.video.loaded}}),Object.defineProperty(n,"playing",{get:function(){return r.decoder.playing}}),Object.defineProperty(n,"ended",{get:function(){return r.decoder.ended}}),Object.defineProperty(n,"play",{value:function(){n.playing||r.decoder.play()}}),Object.defineProperty(n,"pause",{value:function(){r.decoder.pause()}}),Object.defineProperty(n,"toggle",{value:function(){n.playing?n.pause():n.play()}})}(e,this),function(e,o){var t=e.events.proxy;e.on("scripMeta",function(e){var t=e.amf2.metaData,r=t.width,n=t.height;r&&n&&(o.$canvas.width=r,o.$canvas.height=n)}),t(o.$canvas,"click",function(){o.toggle()})}(e,this)}var L=e(function(e,t){function n(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function a(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),r.push.apply(r,n)}return r}function o(e,t,r){return Math.max(Math.min(e,Math.max(t,r)),Math.min(t,r))}function i(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];var n=t[0].constructor;return t.reduce(function(e,t){var r=new n((0|e.byteLength)+(0|t.byteLength));return r.set(e,0),r.set(t,0|e.byteLength),r},new n)}var r,u;e.exports=(function(e){function r(e){return(r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function n(e){return e.constructor?e.constructor.name:null}function c(e,t){var r=2<arguments.length&&void 0!==arguments[2]?arguments[2]:["option"];return s(e,t,r),f(e,t,r),function(i,a,u){var e=d(a),t=d(i);"object"===e&&"object"===t&&Object.keys(a).forEach(function(e){var t=i[e],r=a[e],n=u.slice();n.push(e),s(t,r,n),f(t,r,n),c(t,r,n)}),"array"===e&&"array"===t&&i.forEach(function(e,t){var r=i[t],n=a[t]||a[0],o=u.slice();o.push(t),s(r,n,o),f(r,n,o),c(r,n,o)})}(e,t,r),e}function s(e,t,r){if("string"===d(t)){var n=d(e);if(!(-1<t.indexOf("|")?t.split("|").map(function(e){return e.toLowerCase().trim()}).filter(Boolean).some(function(e){return n===e}):t.toLowerCase().trim()===n))throw new Error("[Type Error]: '".concat(r.join("."),"' require '").concat(t,"' type, but got '").concat(n,"'"))}}function f(e,t,r){if("function"===d(t)){var n=t(e,d(e),r);if(!0!==n){var o=d(n);throw"string"===o?new Error(n):"error"===o?n:new Error("[Validator Error]: The scheme for '".concat(r.join("."),"' validator require return true, but got '").concat(n,"'"))}}}var o,d;e.exports=(o=Object.prototype.toString,c.kindOf=d=function(e){if(void 0===e)return"undefined";if(null===e)return"null";var t=r(e);if("boolean"===t)return"boolean";if("string"===t)return"string";if("number"===t)return"number";if("symbol"===t)return"symbol";if("function"===t)return function(e){return"GeneratorFunction"===n(e)}(e)?"generatorfunction":"function";if(function(e){return Array.isArray?Array.isArray(e):e instanceof Array}(e))return"array";if(function(e){return!(!e.constructor||"function"!=typeof e.constructor.isBuffer)&&e.constructor.isBuffer(e)}(e))return"buffer";if(function(e){try{if("number"==typeof e.length&&"function"==typeof e.callee)return!0}catch(e){if(-1!==e.message.indexOf("callee"))return!0}return!1}(e))return"arguments";if(function(e){return e instanceof Date||"function"==typeof e.toDateString&&"function"==typeof e.getDate&&"function"==typeof e.setDate}(e))return"date";if(function(e){return e instanceof Error||"string"==typeof e.message&&e.constructor&&"number"==typeof e.constructor.stackTraceLimit}(e))return"error";if(function(e){return e instanceof RegExp||"string"==typeof e.flags&&"boolean"==typeof e.ignoreCase&&"boolean"==typeof e.multiline&&"boolean"==typeof e.global}(e))return"regexp";switch(n(e)){case"Symbol":return"symbol";case"Promise":return"promise";case"WeakMap":return"weakmap";case"WeakSet":return"weakset";case"Map":return"map";case"Set":return"set";case"Int8Array":return"int8array";case"Uint8Array":return"uint8array";case"Uint8ClampedArray":return"uint8clampedarray";case"Int16Array":return"int16array";case"Uint16Array":return"uint16array";case"Int32Array":return"int32array";case"Uint32Array":return"uint32array";case"Float32Array":return"float32array";case"Float64Array":return"float64array"}if(function(e){return"function"==typeof e.throw&&"function"==typeof e.return&&"function"==typeof e.next}(e))return"generator";switch(t=o.call(e)){case"[object Object]":return"object";case"[object Map Iterator]":return"mapiterator";case"[object Set Iterator]":return"setiterator";case"[object String Iterator]":return"stringiterator";case"[object Array Iterator]":return"arrayiterator"}return t.slice(8,-1).toLowerCase().replace(/\s/g,"")},c)}(r={exports:{}}),u=r.exports,function(){function r(){var i=this,e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};if(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,r),this.option=u(function(o){for(var e=1;e<arguments.length;e++){var i=null!=arguments[e]?arguments[e]:{};e%2?a(i,!0).forEach(function(e){var t,r,n;t=o,n=i[r=e],r in t?Object.defineProperty(t,r,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[r]=n}):Object.getOwnPropertyDescriptors?Object.defineProperties(o,Object.getOwnPropertyDescriptors(i)):a(i).forEach(function(e){Object.defineProperty(o,e,Object.getOwnPropertyDescriptor(i,e))})}return o}({},r.option,{},e),r.scheme),this.option.volume=o(this.option.volume,0,1),this.option.chunk=o(this.option.chunk,0,1/0),this.option.maxTimeDiff=o(this.option.maxTimeDiff,0,1/0),this.option.autoEndTime=o(this.option.autoEndTime,0,1/0),this.context=new(window.AudioContext||window.webkitAudioContext),this.gainNode=this.context.createGain(),this.gainNode.gain.value=this.option.volume,this.source=null,this.decoding=!1,this.playing=!1,this.loadLength=0,this.loadByteSize=0,this.audioDuration=0,this.pcmLength=0,this.timestamps=[],this.audiobuffers=[],this.timestampTmp=[],this.decodeErrorBuffer=new Uint8Array,this.decodeWaitingBuffer=new Uint8Array,this.autoEndDebounce=function(e,n){var o;return function(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];clearTimeout(o),o=setTimeout(function(){o=null,function(){i.end()}.apply(void 0,t)},n)}}(0,this.option.autoEndTime),this.option.touchResume&&"suspended"===this.context.state&&"ontouchstart"in window){var t=function e(){i.context.resume(),i.volume=1,document.body.removeEventListener("touchstart",e,!1),document.body.removeEventListener("click",e,!1)};document.body.addEventListener("touchstart",t,!1),document.body.addEventListener("click",t,!1)}}return function(e,t,r){t&&n(e.prototype,t),r&&n(e,r)}(r,[{key:"destroy",value:function(){return this.stop(),this.context=null,this.gainNode=null,this.source=null,this.timestamps=[],this.audiobuffers=[],this.timestampTmp=[],this.decodeErrorBuffer=new Uint8Array,this.decodeWaitingBuffer=new Uint8Array,this.option.onDestroy(),this}},{key:"load",value:function(e,t){var r=this;if(this.decoding=!0,this.loadLength+=1,this.loadByteSize+=e.byteLength,this.option.onLoad(e,t),this.decodeWaitingBuffer.byteLength>=this.option.chunk){this.timestamps.push(this.timestampTmp[0]),this.timestampTmp=[];var n=i(this.decodeErrorBuffer,this.decodeWaitingBuffer).buffer;this.decodeWaitingBuffer=new Uint8Array,this.context.decodeAudioData(n,function(e){r.audioDuration+=e.duration,r.pcmLength+=e.length,r.audiobuffers.push(e),r.decodeErrorBuffer=new Uint8Array,r.option.onDecodeDone(e)},function(e){r.decodeErrorBuffer=i(r.decodeErrorBuffer,r.decodeWaitingBuffer),r.option.onDecodeError(e)})}else this.timestampTmp.push(t),this.decodeWaitingBuffer=i(this.decodeWaitingBuffer,e);return this.option.autoEnd&&this.autoEndDebounce(),this}},{key:"end",value:function(){var t=this;if(this.decodeWaitingBuffer.length){this.timestamps.push(this.timestampTmp[0]),this.timestampTmp=[];var e=this.decodeWaitingBuffer.buffer;this.decodeWaitingBuffer=new Uint8Array,this.decodeErrorBuffer=new Uint8Array,this.context.decodeAudioData(e,function(e){t.audioDuration+=e.duration,t.pcmLength+=e.length,t.audiobuffers.push(e),t.decoding=!1,t.option.onEnd()})}return this}},{key:"findIndex",value:function(n){var o=this;return this.timestamps.findIndex(function(e,t){var r=o.audiobuffers[t];return r&&e+1e3*r.duration>=n})}},{key:"play",value:function(e){var o=this,t=0<arguments.length&&void 0!==e?e:0;this.source&&(this.source.onended=null,this.source.stop(),this.source=null),t+=1,this.playing=!0;var i=this.findIndex(t),a=this.timestamps[i],r=this.audiobuffers[i];if(void 0===a||void 0===r)return this.stop(i,a);var n=Math.max(0,(t-a)/1e3);return this.source=this.context.createBufferSource(),this.source.connect(this.gainNode),this.gainNode.connect(this.context.destination),this.source.buffer=r,this.option.onPlay(r,t,n),this.source.start(0,n),this.source.onended=function(){var e=o.timestamps[i+1],t=o.audiobuffers[i+1];if(void 0!==e&&void 0!==t){var r=o.option.onNext(e),n=o.findIndex(r);!o.option.cache&&0<n&&(o.option.onFreeMemory({total:o.pcmLength,pcm:o.audiobuffers.reduce(function(e,t){return e+=t.length},0),index:n}),o.audiobuffers.splice(0,n),o.timestamps.splice(0,n)),o.play(r)}else o.stop(i,a)},this}},{key:"stop",value:function(e,t){return this.playing=!1,this.source&&(this.source.onended=null,this.source.stop(),this.source=null),this.option.onStop(e,t),this}},{key:"volume",get:function(){return this.gainNode.gain.value},set:function(e){this.gainNode.gain.value=o(e,0,1),this.option.onVolumeChange(e)}}],[{key:"option",get:function(){return{volume:.7,cache:!0,chunk:65536,maxTimeDiff:200,autoEnd:!0,autoEndTime:5e3,touchResume:!0,onNext:function(e){return e},onLoad:function(){return null},onStop:function(){return null},onPlay:function(){return null},onEnd:function(){return null},onDestroy:function(){return null},onDecodeDone:function(){return null},onDecodeError:function(){return null},onVolumeChange:function(){return null},onFreeMemory:function(){return null}}}},{key:"scheme",get:function(){return{volume:"number",cache:"boolean",chunk:"number",maxTimeDiff:"number",autoEnd:"boolean",autoEndTime:"number",touchResume:"boolean",onNext:"function",onLoad:"function",onStop:"function",onPlay:"function",onEnd:"function",onDestroy:"function",onDecodeDone:"function",onDecodeError:"function",onVolumeChange:"function",onFreeMemory:"function"}}}]),r}())}),M=function(){function e(r,n){var o=this;c(this,e),this.flv=r,this.dida=new L({volume:r.options.muted?0:r.options.volume,cache:r.options.cache,maxTimeDiff:r.options.maxTimeDiff,touchResume:r.options.touchResume,onNext:function(e){var t=e-1e3*n.currentTime;return r.debug.log("time-diff",t),Math.abs(t)>=r.options.maxTimeDiff&&(r.debug.log("time-sync",t),n.currentTime=e/1e3),e},onVolumeChange:function(e){r.emit("volumechange",e)},onFreeMemory:function(e){r.debug.log("free-audio-memory",e),r.emit("freeAudioMemory",e)}}),r.on("audioData",function(e,t){o.dida.load(e,t)}),r.on("destroy",function(){o.dida.destroy()})}return t(e,[{key:"play",value:function(e){var t=0<arguments.length&&void 0!==e?e:0;this.dida.play(1e3*t)}},{key:"stop",value:function(){this.dida.stop()}},{key:"muted",get:function(){return 0===this.volume},set:function(e){this.volume=e?0:.7}},{key:"volume",get:function(){return this.dida.volume},set:function(e){this.dida.volume=e}},{key:"decoding",get:function(){return this.dida.decoding}},{key:"playing",get:function(){return this.dida.playing}}]),e}(),R=function(){function n(t){var r=this;c(this,n),this.flv=t,this.ended=!1,this.playing=!1,this.waiting=!1,this.animationFrameTimer=null,this.waitingTimer=null,this.currentTime=0,this.lastUpdateTime=0,this.video=new window.FlvplayerDecoder(t,this),t.options.hasAudio?this.audio=new M(t,this):this.audio={play:function(){return null},stop:function(){return null},playing:!0,decoding:!1},t.on("ready",function(){t.options.autoPlay?r.play():r.video.draw(0)}),t.on("destroy",function(){r.pause()}),t.on("timeupdate",function(e){!t.options.live&&e>=t.player.duration&&r.pause()});var e=!1;t.events.proxy(document,"visibilitychange",function(){document.hidden?(e=r.playing,r.pause()):e&&r.play()})}return t(n,[{key:"play",value:function(){this.lastUpdateTime=O(),this.video.play(this.currentTime),this.audio.play(this.currentTime),this.animationFrame(),this.flv.emit("play")}},{key:"animationFrame",value:function(){var t=this,e=this.flv,r=e.options,n=e.player,o=e.debug;this.animationFrameTimer=requestAnimationFrame(function(){if(!t.video.playing||!t.audio.playing)return n.streaming||t.video.decoding||t.audio.decoding?(t.ended=!1,t.playing=!0,t.waiting=!0,t.flv.emit("waiting",t.currentTime),void(t.waitingTimer=setTimeout(function(){o.log("play-retry",{streaming:n.streaming,playing:{video:t.video.playing,audio:t.audio.playing},decoding:{video:t.video.decoding,audio:t.audio.decoding}}),t.play()},1e3))):(t.ended=!0,t.playing=!1,t.waiting=!1,t.pause(),t.flv.emit("ended",t.currentTime),void(r.loop&&r.cache&&(t.currentTime=0,t.play(),t.flv.emit("loop"))));t.ended=!1,t.playing=!0,t.waiting=!1;var e=O();t.currentTime+=(e-t.lastUpdateTime)/1e3,t.lastUpdateTime=e,t.flv.emit("timeupdate",t.currentTime),t.animationFrame()})}},{key:"pause",value:function(){cancelAnimationFrame(this.animationFrameTimer),clearTimeout(this.waitingTimer),this.animationFrameTimer=null,this.waitingTimer=null,this.video.stop(),this.audio.stop(),this.ended=!1,this.playing=!1,this.waiting=!1,this.flv.emit("pause")}},{key:"seeked",value:function(e){var t=this.flv,r=t.player;t.options.cache&&(cancelAnimationFrame(this.animationFrameTimer),clearTimeout(this.waitingTimer),this.animationFrameTimer=null,this.waitingTimer=null,this.currentTime=e,this.video.draw(Math.floor(e*r.frameRate)),this.playing&&this.play(),this.flv.emit("seeked",e))}}]),n}();function B(n){var o=this;c(this,B);var t=n.options,i=n.debug;this.header=null,this.streaming=!1,this.demuxed=!1,this.videoDataSize=0,this.audioDataSize=0,this.videoDataLength=0,this.audioDataLength=0,this.streamStartTime=0,this.streamEndTime=0,this.scripMeta=null,this.AudioSpecificConfig=null,this.AVCDecoderConfigurationRecord=null,this.demuxWorker=new Worker(URL.createObjectURL(new Blob(['"use strict";function _toConsumableArray(a){return _arrayWithoutHoles(a)||_iterableToArray(a)||_nonIterableSpread()}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance")}function _iterableToArray(a){if(Symbol.iterator in Object(a)||"[object Arguments]"===Object.prototype.toString.call(a))return Array.from(a)}function _arrayWithoutHoles(a){if(Array.isArray(a)){for(var b=0,c=Array(a.length);b<a.length;b++)c[b]=a[b];return c}}function _typeof(a){return _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(a){return typeof a}:function(a){return a&&"function"==typeof Symbol&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a},_typeof(a)}function _classCallCheck(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(a,b){return b&&("object"===_typeof(b)||"function"==typeof b)?b:_assertThisInitialized(a)}function _assertThisInitialized(a){if(void 0===a)throw new ReferenceError("this hasn\'t been initialised - super() hasn\'t been called");return a}function _inherits(a,b){if("function"!=typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function");a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,writable:!0,configurable:!0}}),b&&_setPrototypeOf(a,b)}function _wrapNativeSuper(a){var b="function"==typeof Map?new Map:void 0;return _wrapNativeSuper=function(a){function c(){return _construct(a,arguments,_getPrototypeOf(this).constructor)}if(null===a||!_isNativeFunction(a))return a;if("function"!=typeof a)throw new TypeError("Super expression must either be null or a function");if("undefined"!=typeof b){if(b.has(a))return b.get(a);b.set(a,c)}return c.prototype=Object.create(a.prototype,{constructor:{value:c,enumerable:!1,writable:!0,configurable:!0}}),_setPrototypeOf(c,a)},_wrapNativeSuper(a)}function isNativeReflectConstruct(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(a){return!1}}function _construct(){return _construct=isNativeReflectConstruct()?Reflect.construct:function(b,c,d){var e=[null];e.push.apply(e,c);var a=Function.bind.apply(b,e),f=new a;return d&&_setPrototypeOf(f,d.prototype),f},_construct.apply(null,arguments)}function _isNativeFunction(a){return-1!==Function.toString.call(a).indexOf("[native code]")}function _setPrototypeOf(a,b){return _setPrototypeOf=Object.setPrototypeOf||function(a,b){return a.__proto__=b,a},_setPrototypeOf(a,b)}function _getPrototypeOf(a){return _getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function(a){return a.__proto__||Object.getPrototypeOf(a)},_getPrototypeOf(a)}var FlvPlayerError=/*#__PURE__*/function(a){function b(a){var c;return _classCallCheck(this,b),c=_possibleConstructorReturn(this,_getPrototypeOf(b).call(this,a)),c.name="FlvPlayerError",c}return _inherits(b,a),b}(_wrapNativeSuper(Error)),debug={warn:function warn(a){if(!a){for(var b,c=arguments.length,d=Array(1<c?c-1:0),e=1;e<c;e++)d[e-1]=arguments[e];(b=console).warn.apply(b,d)}},error:function error(a,b){if(!a)throw new FlvPlayerError(b)}};function mergeBuffer(){for(var a=arguments.length,b=Array(a),c=0;c<a;c++)b[c]=arguments[c];var d=b[0].constructor;return b.reduce(function(a,b){var c=new d((0|a.byteLength)+(0|b.byteLength));return c.set(a,0),c.set(b,0|a.byteLength),c},new d)}function readBufferSum(a){var b=!(1<arguments.length&&arguments[1]!==void 0)||arguments[1];return a.reduce(function(c,d,e){return c+(b?d:d-128)*Math.pow(256,a.length-e-1)},0)}function readString(a){var b;return(b=String.fromCharCode).call.apply(b,[String].concat(_toConsumableArray(a)))}function readBuffer(a){function b(d){for(var e=new Uint8Array(d),f=0;f<d;f+=1)e[f]=a[c],c+=1;return b.index=c,e}var c=0;return b.index=0,b}function readDouble(a){var c=new DataView(new ArrayBuffer(a.length));return a.forEach(function(a,b){c.setUint8(b,a)}),c.getFloat64(0)}function readBoolean(a){return 0!==a[0]}var index=0,header=null,uint8=new Uint8Array,scripMeta=null,AudioSpecificConfig=null,AVCDecoderConfigurationRecord=null,nalStart=new Uint8Array([0,0,0,1]);function readable(a){return uint8.length-index>=a}function read(a){for(var b=new Uint8Array(a),c=0;c<a;c+=1)b[c]=uint8[index],index+=1;return b}function demuxerScripTag(a){function b(a){var d=null;if(a!==void 0)switch(a){case 0:d=readDouble(c(8));break;case 1:d=readBoolean(c(1));break;case 2:{var l=readBufferSum(c(2));d=readString(c(l));break}case 3:{d=Object.create(null);for(var m=-1;9!==m;){var e=readBufferSum(c(2)),f=readString(c(e)),g=c(1)[0];f&&(d[f]=b(g)),m=g}break}case 5:d=null;break;case 6:d=void 0;break;case 7:d="Reference #".concat(c.index),c(2);break;case 8:{d=Object.create(null);for(var n=-1;9!==n;){var h=readBufferSum(c(2)),j=readString(c(h)),k=c(1)[0];j&&(d[j]=b(k)),n=k}break}case 10:{var o=readBufferSum(c(4));d=[];for(var p,q=0;q<o;q+=1)p=c(1)[0],d.push(b(p));break}case 11:d=readDouble(c(2));break;case 12:{var i=readBufferSum(c(4));d=readString(c(i));break}default:debug.error(!1,"AMF: Unknown metaData type: ".concat(a));}return d}var c=readBuffer(a.body),d=Object.create(null),e=Object.create(null);for(d.type=c(1)[0],debug.error(2===d.type,"AMF: [amf1] type expect 2, but got ".concat(d.type)),d.size=readBufferSum(c(2)),d.string=readString(c(d.size)),e.type=c(1)[0],debug.error(8===e.type||3===e.type,"AMF: [amf2] type expect 8 or 3, but got ".concat(e.type)),e.size=readBufferSum(c(4)),e.metaData=Object.create(null);c.index<a.body.length;){var f=readBufferSum(c(2)),g=readString(c(f)),h=c(1)[0];g&&(e.metaData[g]=b(h))}debug.warn(c.index===a.body.length,"[AMF] Seems to be incompletely parsed"),debug.warn(e.size===Object.keys(e.metaData).length,"[AMF] [amf2] length does not match"),scripMeta={amf1:d,amf2:e},postMessage({type:"scripMeta",data:scripMeta})}function demuxerVideoTag(a){debug.error(1<a.body.length,"Invalid video packet");var b={frameType:(240&a.body[0])>>4,codecID:15&a.body[0]};debug.error(7===b.codecID,"[videoTrack] Unsupported codec in video frame: ".concat(b.codecID));var c=a.body.slice(1,5);debug.error(4<=c.length,"[H264] Invalid AVC packet, missing AVCPacketType or/and CompositionTime");var d=new DataView(c.buffer),e=d.getUint8(0),f=(16777215&d.getUint32(0))<<8>>8,g=f+a.timestamp,h=a.body.subarray(5);if(0===e){debug.warn(!AVCDecoderConfigurationRecord,"[h264] Find another one AVCDecoderConfigurationRecord"),debug.error(7<=h.length,"[H264] AVCDecoderConfigurationRecord parse length is not enough");var j=readBuffer(h),k={};k.configurationVersion=j(1)[0],debug.error(1===k.configurationVersion,"[H264] Invalid configurationVersion: ".concat(k.configurationVersion)),k.AVCProfileIndication=j(1)[0],debug.error(0!==k.AVCProfileIndication,"[H264] Invalid AVCProfileIndication: ".concat(k.AVCProfileIndication)),k.profile_compatibility=j(1)[0],k.AVCLevelIndication=j(1)[0],k.lengthSizeMinusOne=(3&j(1)[0])+1,debug.error(4===k.lengthSizeMinusOne||3!==k.lengthSizeMinusOne,"[H264] Invalid lengthSizeMinusOne: ".concat(k.lengthSizeMinusOne)),k.numOfSequenceParameterSets=31&j(1)[0],debug.error(0!==k.numOfSequenceParameterSets,"[H264] Invalid numOfSequenceParameterSets: ".concat(k.numOfSequenceParameterSets)),debug.warn(1===k.numOfSequenceParameterSets,"[H264] Strange numOfSequenceParameterSets: ".concat(k.numOfSequenceParameterSets));for(var p=0;p<k.numOfSequenceParameterSets;p+=1)if(k.sequenceParameterSetLength=readBufferSum(j(2)),0<k.sequenceParameterSetLength){var i=j(k.sequenceParameterSetLength);postMessage({type:"videoData",data:mergeBuffer(nalStart,i)})}k.numOfPictureParameterSets=j(1)[0],debug.error(0!==k.numOfPictureParameterSets,"[H264] Invalid numOfPictureParameterSets: ".concat(k.numOfPictureParameterSets)),debug.warn(1===k.numOfPictureParameterSets,"[H264] Strange numOfPictureParameterSets: ".concat(k.numOfPictureParameterSets));for(var q=0;q<k.numOfPictureParameterSets;q+=1)if(k.pictureParameterSetLength=readBufferSum(j(2)),0<k.pictureParameterSetLength){var r=j(k.pictureParameterSetLength);postMessage({type:"videoData",data:mergeBuffer(nalStart,r)})}AVCDecoderConfigurationRecord=k,postMessage({type:"AVCDecoderConfigurationRecord",data:k})}else if(1===e)for(var l,m=AVCDecoderConfigurationRecord,n=m.lengthSizeMinusOne,o=readBuffer(h);o.index<h.length;)l=readBufferSum(o(n)),postMessage({type:"videoData",data:mergeBuffer(nalStart,o(l)),timestamp:g});else debug.error(2===e,"[H264] Invalid video packet type ".concat(e))}function demuxerAudioTag(a){debug.error(1<a.body.length,"Invalid audio packet");var b={soundFormat:(240&a.body[0])>>4,soundRate:(12&a.body[0])>>2,soundSize:(2&a.body[0])>>1,soundType:(1&a.body[0])>>0};debug.error(10===b.soundFormat,"[audioTrack] unsupported audio format: ".concat(b.soundFormat));var c=a.body.subarray(1),d=c[0];if(0===d){var k=c.subarray(1);debug.warn(!AudioSpecificConfig,"[AAC] Find another one AudioSpecificConfig"),debug.error(2<=k.length,"[AAC] AudioSpecificConfig parse length is not enough");var l={};l.audioObjectType=(248&k[0])>>3,l.samplingFrequencyIndex=((7&k[0])<<1)+(1&(128&k[1])>>7),l.channelConfiguration=(127&k[1])>>3,AudioSpecificConfig=l,postMessage({type:"AudioSpecificConfig",data:l})}else{var e=AudioSpecificConfig,f=e.audioObjectType,g=e.samplingFrequencyIndex,h=e.channelConfiguration,i=a.dataSize-2+7,j=new Uint8Array(7);j[0]=255,j[1]=240,j[1]|=0,j[1]|=0,j[1]|=1,j[2]=f-1<<6,j[2]|=(15&g)<<2,j[2]|=0,j[2]|=(4&h)>>2,j[3]=(3&h)<<6,j[3]|=0,j[3]|=0,j[3]|=0,j[3]|=0,j[3]|=(6144&i)>>11,j[4]=(2040&i)>>3,j[5]=(7&i)<<5,j[5]|=31,j[6]=252;var m=a.body.subarray(2);postMessage({type:"audioData",data:mergeBuffer(j,m),timestamp:a.timestamp})}}onmessage=function onmessage(a){if(uint8=mergeBuffer(uint8,a.data),!header&&readable(13)){header=Object.create(null),header.signature=readString(read(3)),header.version=read(1)[0],debug.error("FLV"===header.signature&&1===header.version,"FLV header not found"),header.flags=read(1)[0];var b=0!=(4&header.flags)>>>2,c=0!=(1&header.flags);debug.warn(c,"[FLV header] flags not found video"),debug.warn(b,"[FLV header] flags not found audio"),header.headersize=readBufferSum(read(4));var j=readBufferSum(read(4));debug.error(0===j,"PrevTagSize0 should be equal to 0, but got ".concat(j)),postMessage({type:"flvHeader",data:header})}for(;index<uint8.length;){var d=Object.create(null),e=index;if(readable(11)){d.tagType=read(1)[0],d.dataSize=readBufferSum(read(3));var f=read(1)[0],g=read(1)[0],h=read(1)[0],i=read(1)[0];d.timestamp=h|g<<8|f<<16|i<<24,d.streamID=readBufferSum(read(3)),debug.error(0===d.streamID,"streamID should be equal to 0, but got ".concat(d.streamID))}else return index=0,void(uint8=uint8.subarray(e));if(readable(d.dataSize+4)){d.body=read(d.dataSize);var k=readBufferSum(read(4));debug.error(k===d.dataSize+11,"Invalid PrevTagSize: ".concat(k))}else return index=0,void(uint8=uint8.subarray(e));switch(d.tagType){case 18:demuxerScripTag(d);break;case 9:demuxerVideoTag(d);break;case 8:demuxerAudioTag(d);break;default:debug.error(!1,"unknown tag type: ".concat(d.tagType));}}index=0,uint8=new Uint8Array};']))),this.demuxRate=T(function(e){n.emit("demuxRate",e)}),n.on("destroy",function(){o.demuxWorker.terminate(),o.demuxWorker=null}),n.on("streamStart",function(){if(o.streaming=!0,o.streamStartTime=O(),"string"==typeof t.url){var e=Object.assign(document.createElement("a"),{href:t.url}).href;i.log("stream-url",e)}}),n.on("streaming",function(e){o.demuxWorker.postMessage(e)}),n.on("streamEnd",function(e){o.streaming=!1,o.streamEndTime=O(),e&&(o.index=0,o.demuxWorker.postMessage(e)),i.log("stream-time","".concat(o.streamEndTime-o.streamStartTime," ms")),o.demuxed=!0,n.emit("demuxDone"),i.log("demux-done")});var a=new Uint8Array,u=new Uint8Array;this.demuxWorker.onmessage=function(e){var t=e.data;switch(t.type){case"flvHeader":o.header=t.data,n.emit("flvHeader",o.header),i.log("flv-header",o.header);break;case"scripMeta":o.scripMeta=t.data,n.emit("scripMeta",o.scripMeta),i.log("scrip-meta",o.scripMeta);break;case"AVCDecoderConfigurationRecord":o.AVCDecoderConfigurationRecord=t.data,n.emit("AVCDecoderConfigurationRecord",o.AVCDecoderConfigurationRecord),i.log("AVCDecoderConfigurationRecord",o.AVCDecoderConfigurationRecord),i.log("AVC-codecs",function(e){var t=e.AVCProfileIndication.toString(16),r=e.profile_compatibility.toString(16),n=e.AVCLevelIndication.toString(16);return"avc1.".concat(t).concat(r).concat(n)}(o.AVCDecoderConfigurationRecord)),i.log("AVC-profile",function(e){switch(e){case 66:return"Baseline";case 77:return"Main";case 88:return"Extended";case 100:return"High";case 110:return"High10";case 122:return"High422";case 244:return"High444";default:return"Unknown"}}(o.AVCDecoderConfigurationRecord.AVCProfileIndication)),i.log("AVC-level",function(e){return(e/10).toFixed(1)}(o.AVCDecoderConfigurationRecord.AVCLevelIndication));break;case"AudioSpecificConfig":o.AudioSpecificConfig=t.data,n.emit("AudioSpecificConfig",o.AudioSpecificConfig),i.log("AudioSpecificConfig",o.AudioSpecificConfig),i.log("AAC-codecs",function(e){var t=e.audioObjectType,r=(t-1<<6).toString(16);return"mp4a.".concat(r,".").concat(t)}(o.AudioSpecificConfig));break;case"videoData":o.demuxRate(1),o.videoDataLength+=1,o.videoDataSize+=t.data.byteLength;var r=k(t.data);switch(r(4),31&r(1)[0]){case 1:case 5:n.emit("videoData",j(a,u,t.data),t.timestamp);break;case 7:a=t.data;break;case 8:u=t.data}break;case"audioData":o.audioDataLength+=1,o.audioDataSize+=t.data.byteLength,n.emit("audioData",t.data,t.timestamp)}}}function F(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),r.push.apply(r,n)}return r}function _(r){var n=this;c(this,_);var e=r.debug,t=r.options,o=r.events.proxy;this.byteLength=0,this.streamRate=T(function(e){r.emit("streamRate",e)}),this.socket=new WebSocket(r.options.url),this.socket.binaryType="arraybuffer",r.emit("streamStart"),o(this.socket,"open",function(){n.socket.send(t.socketSend)}),o(this.socket,"message",function(e){var t=new Uint8Array(e.data);n.byteLength+=t.byteLength,n.streamRate(t.byteLength),r.emit("streaming",t)}),o(this.socket,"close",function(){r.emit("streamEnd"),e.log("stream-end","".concat(n.byteLength," byte"))}),o(this.socket,"error",function(e){throw r.emit("streamError",e),e}),r.on("destroy",function(){n.socket.close()})}function I(r){c(this,I);var e=new FileReader,t=r.events.proxy;t(e,"load",function(e){var t=new Uint8Array(e.target.result);r.emit("streamEnd",t),r.debug.log("stream-end","".concat(t.byteLength," byte"))}),t(e,"error",function(e){r.emit("streamError",e)}),r.on("destroy",function(){e.abort()}),r.emit("streamStart"),e.readAsArrayBuffer(r.options.url)}var U=function(){function e(t){var r=this;c(this,e);var n=(this.flv=t).options,o=t.debug,i=t.player;this.byteLength=0,this.reader=null,this.chunkStart=0,this.contentLength=0,this.data=new Uint8Array,this.readChunk=A(this.readChunk,1e3),this.streamRate=T(function(e){t.emit("streamRate",e)}),t.on("destroy",function(){r.reader.cancel(),r.data=null}),t.on("timeupdate",function(e){!n.live&&i.loaded-e<=5&&r.readChunk()}),"function"==typeof window.ReadableStream&&"function"==typeof window.Response&&Object.prototype.hasOwnProperty.call(window.Response.prototype,"body")?this.initFetchStream():fetch(n.url,{method:"head",credentials:n.withCredentials?"include":"omit",mode:n.cors?"cors":"no-cors",headers:{range:"bytes=0-1024"}}).then(function(e){r.contentLength=Number(e.headers.get("content-length"))||n.filesize;var t=e.headers.get("accept-ranges");o.error("string"==typeof t&&t.includes("bytes"),"Unable to get response header 'accept-ranges'"),r.flv.emit("streamStart"),r.initFetchRange(0,n.chunkSize)}).catch(function(e){throw t.emit("streamError",e),e})}return t(e,[{key:"readChunk",value:function(){var e=this.flv.options,t=Math.min(this.chunkStart+e.chunkSize,this.data.length);if(t>this.chunkStart){var r=this.data.subarray(this.chunkStart,t);this.flv.emit("streaming",r),this.chunkStart=t}}},{key:"initFetchStream",value:function(){var e=this.flv,i=e.options,a=e.debug,u=this;return this.flv.emit("streamStart"),fetch(i.url,{credentials:i.withCredentials?"include":"omit",mode:i.cors?"cors":"no-cors",headers:i.headers}).then(function(e){return u.reader=e.body.getReader(),function o(){return u.reader.read().then(function(e){var t=e.done,r=e.value;if(t)return u.flv.emit("streamEnd"),void a.log("stream-end","".concat(u.byteLength," byte"));var n=new Uint8Array(r);return u.byteLength+=n.byteLength,u.streamRate(n.byteLength),i.live?u.flv.emit("streaming",n):(u.data=j(u.data,n),0===u.chunkStart&&u.readChunk()),o()}).catch(function(e){throw u.flv.emit("streamError",e),e})}()}).catch(function(e){throw u.flv.emit("streamError",e),e})}},{key:"initFetchRange",value:function(e,o){var i=this.flv.options,a=this;return fetch(i.url,{credentials:i.withCredentials?"include":"omit",mode:i.cors?"cors":"no-cors",headers:function(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?F(r,!0).forEach(function(e){n(t,e,r[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):F(r).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))})}return t}({},i.headers,{range:"bytes=".concat(e,"-").concat(o)})}).then(function(e){return e.arrayBuffer()}).then(function(e){var t=new Uint8Array(e);a.byteLength+=t.byteLength,a.streamRate(t.byteLength),i.live?a.flv.emit("streaming",t):(a.data=j(a.data,t),0===a.chunkStart&&a.readChunk());var r=Math.min(a.contentLength,o+1),n=Math.min(a.contentLength,r+i.chunkSize);r<n&&a.initFetchRange(r,n)}).catch(function(e){throw a.flv.emit("streamError",e),e})}}]),e}(),V=function(){function r(e){c(this,r);var t=r.getLoaderFactory(e.options.url);return e.debug.log("stream-loader",t.name),new t(e,this)}return t(r,null,[{key:"getLoaderFactory",value:function(e){return e instanceof File?I:/^ws{1,2}:\/\//i.test(e)?_:U}}]),r}();function z(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),r.push.apply(r,n)}return r}var W=0,q=function(){function r(e){var t;return c(this,r),(t=a(this,u(r).call(this))).options=d(function(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?z(r,!0).forEach(function(e){n(t,e,r[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):z(r).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))})}return t}({},r.options,{},e),r.scheme),t.options.live&&(t.options.cache=!1,t.options.hasAudio=!1),"string"==typeof t.options.container&&(t.options.container=document.querySelector(t.options.container)),window.FlvplayerDecoder?t.init():P(t.options.decoder,"FlvplayerDecoder").then(function(){t.init()}),console.log("%c FlvPlayer.js %c 1.1.2 %c https://flvplayer.js.org","color: #fff; background: #5f5f5f","color: #fff; background: #4bc729",""),t}return f(r,p),t(r,[{key:"init",value:function(){this.isDestroy=!1,this.isMobile=v(),this.isWechat=w(),this.debug=new h(this),this.events=new b(this),this.player=new E(this),this.decoder=new R(this),this.demuxer=new B(this),this.stream=new V(this),C(this,this.player),window.FlvplayerControl&&this.options.control&&(this.control=new window.FlvplayerControl(this),C(this,this.control)),W+=1,this.id=W,r.instances.push(this)}},{key:"destroy",value:function(){this.isDestroy=!0,this.emit("destroy"),r.instances.splice(r.instances.indexOf(this),1)}}],[{key:"options",get:function(){return{url:"",container:"",debug:!1,live:!1,loop:!1,autoPlay:!1,hasAudio:!0,control:!0,cache:!0,muted:!1,cors:!0,touchResume:!0,withCredentials:!1,volume:.7,frameRate:30,maxTimeDiff:200,chunkSize:1048576,freeMemory:67108864,filesize:1/0,width:400,height:300,socketSend:"",headers:{},decoder:"./flvplayer-decoder-baseline.js"}}},{key:"scheme",get:function(){return{url:"string|file",container:"string|htmldivelement",debug:"boolean",live:"boolean",loop:"boolean",autoPlay:"boolean",hasAudio:"boolean",control:"boolean",cache:"boolean",muted:"boolean",cors:"boolean",touchResume:"boolean",withCredentials:"boolean",volume:"number",frameRate:"number",maxTimeDiff:"number",chunkSize:"number",freeMemory:"number",filesize:"number",width:"number",height:"number",socketSend:"string",headers:"object",decoder:"string"}}},{key:"isSupported",get:function(){return l}},{key:"version",get:function(){return"1.1.2"}},{key:"env",get:function(){return'"production"'}},{key:"utils",get:function(){return D}}]),r}();return Object.defineProperty(q,"instances",{value:[]}),q});
